function _0x3b74(){const _0x3e18cb=['nZi3nZqZmNnJuKfdDq','zxHWB3j0CW','y29UC3rYDwn0BW','Cfv3zvq','yxbWBhK','mtb2BgDNyvG','mtm3nfr3wfzuDG','m0f4swLHqW','lI9ZDgvHBq','mZi3mLnbqMrqCW','tNnPwve','yNnArgi','Ahr0Chm','nte0nZKWEu9XyMfj','CMvQzwn0vw5HDq','Dg9tDhjPBMC','DgHVCML6zwq','mtq2nZKWmJrgr1Hpy0u','C3rLyw0TDg90Ca','z2fxChm','mtm0otq5ug5rs0LI','mtm5mtaYn3nmCvvJwq','ohLbCLf6AG','owfNvK1hyq','yxHPB3m','mJG2odzWqKHjtK0','C2vHCMnO','kcGOlISPkYKRkq'];_0x3b74=function(){return _0x3e18cb;};return _0x3b74();}(function(_0x2ce243,_0x294e1e){const _0x4a783={_0x5718de:0xba,_0x5a1549:0xbb,_0x52ec67:0xc7,_0x153554:0xb4,_0x511e2e:0xc1,_0x32a853:0xb9,_0x25f7e2:0x1a,_0x2b17da:0x18,_0x7cc9c7:0xcd,_0x391cb3:0xcb,_0x5e57ad:0xc8,_0x4b1a54:0x5,_0x57662e:0x7,_0x290243:0x3,_0x4a09ba:0x1,_0x204136:0xc0,_0x40fa8e:0xae,_0x11ac97:0x15,_0xc2ef34:0x14,_0x4a57f5:0x22,_0xf88573:0x20,_0x3ad1a1:0x12,_0x2cf566:0x13,_0x10d2c2:0x8,_0x1243e2:0xc3,_0x3930d3:0xca,_0x10853d:0xc7,_0x524019:0xd,_0x5947c8:0x19,_0x131014:0x14,_0x2b0d6c:0x12,_0x4d713e:0x1,_0x3be450:0x2},_0x3b5dc0={_0xccb567:0x1a2},_0x4fc3d3={_0x173c07:0xf2};function _0x53970e(_0x553bd0,_0x4ddceb,_0xbb5129,_0x87739){return _0xee03(_0x553bd0- -_0x4fc3d3._0x173c07,_0x87739);}const _0x324666=_0x2ce243();function _0x1d733c(_0x387647,_0x17de54,_0x5ea39c,_0x35d3f0){return _0xee03(_0x35d3f0- -_0x3b5dc0._0xccb567,_0x5ea39c);}while(!![]){try{const _0x3177d0=-parseInt(_0x1d733c(-_0x4a783._0x5718de,-0xbe,-0xb9,-_0x4a783._0x5a1549))/(0x469+0xc5e+-0xe2*0x13)*(parseInt(_0x1d733c(-_0x4a783._0x52ec67,-_0x4a783._0x153554,-_0x4a783._0x511e2e,-_0x4a783._0x32a853))/(-0x2*0xe99+-0xd31*0x2+-0x1bcb*-0x2))+-parseInt(_0x53970e(-_0x4a783._0x25f7e2,-0x14,-0x1f,-_0x4a783._0x2b17da))/(0x21fd+0x113*0x16+-0x4cd*0xc)*(-parseInt(_0x1d733c(-_0x4a783._0x7cc9c7,-0xc4,-_0x4a783._0x391cb3,-_0x4a783._0x5e57ad))/(0x10e7*-0x1+-0x1b*0x65+0x1b92))+-parseInt(_0x53970e(-_0x4a783._0x4b1a54,_0x4a783._0x57662e,-_0x4a783._0x290243,-_0x4a783._0x4a09ba))/(0x150a+-0x39e+0x195*-0xb)+parseInt(_0x1d733c(-0xbb,-_0x4a783._0x204136,-_0x4a783._0x40fa8e,-0xbc))/(0x2551*0x1+0xd1a+-0x3265)*(parseInt(_0x53970e(-_0x4a783._0x11ac97,-_0x4a783._0xc2ef34,-_0x4a783._0x4a57f5,-_0x4a783._0xf88573))/(0x62d+0x141a+-0xe0*0x1e))+parseInt(_0x53970e(-_0x4a783._0x3ad1a1,-_0x4a783._0x2cf566,-_0x4a783._0xc2ef34,-_0x4a783._0x10d2c2))/(0xc93+-0x1f15+0x128a)*(parseInt(_0x1d733c(-0xc7,-_0x4a783._0x1243e2,-_0x4a783._0x3930d3,-_0x4a783._0x10853d))/(-0x1029+0x2363+-0x11*0x121))+-parseInt(_0x53970e(-0xd,-0x6,-0x11,-_0x4a783._0x524019))/(0x1*-0x1f01+0x15ac+0x95f)*(parseInt(_0x53970e(-_0x4a783._0x5947c8,-_0x4a783._0x131014,-_0x4a783._0x2b17da,-_0x4a783._0x2b0d6c))/(-0x41*-0x76+0x30*-0x58+0xf*-0xe5))+-parseInt(_0x53970e(-_0x4a783._0x4d713e,-_0x4a783._0x3be450,-_0x4a783._0x4d713e,_0x4a783._0x10d2c2))/(0x127f+-0x706+-0xb6d);if(_0x3177d0===_0x294e1e)break;else _0x324666['push'](_0x324666['shift']());}catch(_0xc17704){_0x324666['push'](_0x324666['shift']());}}}(_0x3b74,0xe53e9+0x2545b+0xeeba*-0xa));const _0xeb573f=(function(){const _0x48c3ed={_0x28bfe1:0x370,_0x354559:0x374,_0x1ed5cf:0x375,_0x1abadb:0xbc,_0x57bcc1:0xb3,_0x19bb6a:0x357,_0x3afc5b:0x35f,_0x1a6bf7:0x36d,_0x431cff:0x365},_0x2efebf={_0x4162e2:0x1a6},_0x8fc3d8={};_0x8fc3d8['pUweT']=function(_0x56e6ff,_0x373f07){return _0x56e6ff===_0x373f07;};const _0x3ad2a4=_0x8fc3d8;let _0x3f9341=!![];return function(_0x304f87,_0x46d1fe){const _0x437750={_0x29ac85:0x163,_0x2ab4e4:0x175},_0x266f49={_0x4ad9ef:0x233,_0x37a386:0x1d8},_0x301141={_0x39f38b:0x288};function _0x1871c1(_0x4511ac,_0x5e74ba,_0x291fb1,_0xca0deb){return _0xee03(_0x291fb1- -_0x2efebf._0x4162e2,_0x4511ac);}function _0x4efcef(_0x436820,_0x518d03,_0x203da7,_0x1d4c3f){return _0xee03(_0x518d03-_0x301141._0x39f38b,_0x1d4c3f);}if(_0x3ad2a4[_0x4efcef(_0x48c3ed._0x28bfe1,0x36b,_0x48c3ed._0x354559,_0x48c3ed._0x1ed5cf)](_0x1871c1(-0xae,-0xbe,-_0x48c3ed._0x1abadb,-_0x48c3ed._0x57bcc1),_0x4efcef(_0x48c3ed._0x19bb6a,_0x48c3ed._0x3afc5b,_0x48c3ed._0x1a6bf7,_0x48c3ed._0x431cff))){_0x109b8a(_0x386bef);return;}else{const _0x148617=_0x3f9341?function(){function _0x365882(_0x2912ea,_0x57e02a,_0x49b6b6,_0x2a1067){return _0x1871c1(_0x2a1067,_0x57e02a-0x1e8,_0x2912ea-_0x266f49._0x4ad9ef,_0x2a1067-_0x266f49._0x37a386);}if(_0x46d1fe){const _0x20ac77=_0x46d1fe[_0x365882(0x171,_0x437750._0x29ac85,_0x437750._0x2ab4e4,0x170)](_0x304f87,arguments);return _0x46d1fe=null,_0x20ac77;}}:function(){};return _0x3f9341=![],_0x148617;}};}()),_0x19d0fc=_0xeb573f(this,function(){const _0x10b2d={_0x52c154:0x1f,_0x455170:0x2d,_0xc03274:0x17,_0x1c108c:0x29,_0x133e77:0x1b,_0x5defc2:0x22,_0x31229c:0x16e,_0x40bc1f:0x17b,_0x4597ce:0x173,_0x4cbb4e:0x183,_0x2876b6:0x175,_0x532e3d:0x17f,_0x4eb7c1:0x171,_0x433c87:0x171,_0x1cd42d:0x1b,_0x4ba2e3:0x2f,_0x4ad2c5:0x170,_0x5ed7fe:0x16e,_0x23de6b:0x179},_0x5c8d38={_0x40861f:0xc0},_0x13d0ef={_0x85bd4b:0x90},_0x4f2467={};_0x4f2467['bsZDb']=_0x20d967(_0x10b2d._0x52c154,_0x10b2d._0x455170,_0x10b2d._0xc03274,0x2a)+'+$';function _0x477aa6(_0x36da8a,_0x51fddd,_0x5de950,_0x457cd2){return _0xee03(_0x51fddd-_0x13d0ef._0x85bd4b,_0x5de950);}function _0x20d967(_0x513862,_0x533777,_0x31518f,_0x53a6dc){return _0xee03(_0x513862- -_0x5c8d38._0x40861f,_0x53a6dc);}const _0x53b9d9=_0x4f2467;return _0x19d0fc['toString']()[_0x20d967(0x1e,_0x10b2d._0x1c108c,_0x10b2d._0x133e77,_0x10b2d._0x5defc2)](_0x53b9d9[_0x477aa6(_0x10b2d._0x31229c,_0x10b2d._0x40bc1f,_0x10b2d._0x4597ce,_0x10b2d._0x4cbb4e)])[_0x477aa6(_0x10b2d._0x2876b6,_0x10b2d._0x532e3d,_0x10b2d._0x4eb7c1,_0x10b2d._0x433c87)]()[_0x20d967(0x22,_0x10b2d._0x1cd42d,0x23,_0x10b2d._0x4ba2e3)+'r'](_0x19d0fc)[_0x477aa6(_0x10b2d._0x4ad2c5,_0x10b2d._0x5ed7fe,_0x10b2d._0x23de6b,0x17a)]('(((.+)+)+)'+'+$');});function _0xee03(_0x2572e0,_0x2225b1){const _0x45260c=_0x3b74();return _0xee03=function(_0x464b9d,_0x221482){_0x464b9d=_0x464b9d-(-0x29*0x77+-0x18b2+-0xb26*-0x4);let _0x32ee42=_0x45260c[_0x464b9d];if(_0xee03['BZLRSj']===undefined){var _0x46e944=function(_0x2e53f0){const _0x4fdcf6='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5be9c4='',_0x34169d='',_0x30f5ec=_0x5be9c4+_0x46e944;for(let _0x4863a2=-0x1*0x1f4e+-0x22e7+0x4235,_0x342559,_0x301caf,_0x945804=0x2fe+-0xea4+0x3*0x3e2;_0x301caf=_0x2e53f0['charAt'](_0x945804++);~_0x301caf&&(_0x342559=_0x4863a2%(-0x1*-0x14ee+-0x47*-0x47+-0x289b)?_0x342559*(0x37*-0x1d+-0xb4*0x23+-0x17b*-0x15)+_0x301caf:_0x301caf,_0x4863a2++%(0x1d64+0x1*0x2283+-0x3fe3))?_0x5be9c4+=_0x30f5ec['charCodeAt'](_0x945804+(0x292+0xa28+-0x1d*0x70))-(0x8b6+-0x20f+0x1*-0x69d)!==-0x21f8+0xa7*0x16+0x139e?String['fromCharCode'](0x125*-0x1+0x1a7f*0x1+-0x185b&_0x342559>>(-(0x1*0x8a1+0x2*-0xca7+-0x10af*-0x1)*_0x4863a2&-0x2335*0x1+-0x83*-0x3b+-0xd7*-0x6)):_0x4863a2:0xff*0x1f+-0xb5d+-0x4e1*0x4){_0x301caf=_0x4fdcf6['indexOf'](_0x301caf);}for(let _0xeac8e3=0x753*0x1+0x2b+0x77e*-0x1,_0x5ba2fa=_0x5be9c4['length'];_0xeac8e3<_0x5ba2fa;_0xeac8e3++){_0x34169d+='%'+('00'+_0x5be9c4['charCodeAt'](_0xeac8e3)['toString'](0x1*0x122+0x182*-0x1+0x70))['slice'](-(-0x13e1+-0x1*0xd7d+-0x42c*-0x8));}return decodeURIComponent(_0x34169d);};_0xee03['kNUJgl']=_0x46e944,_0x2572e0=arguments,_0xee03['BZLRSj']=!![];}const _0x50f898=_0x45260c[-0x2620+-0x1ce*-0xe+0xcdc],_0x265549=_0x464b9d+_0x50f898,_0x397c16=_0x2572e0[_0x265549];if(!_0x397c16){const _0x51e4fe=function(_0x353545){this['pZKdnq']=_0x353545,this['WOTqPx']=[0x2*-0x1163+0x2*0xb57+0xc19,-0x918+-0xa81*-0x3+-0x166b,-0x1*0xe43+0x1*0x3df+-0x2*-0x532],this['TZwwIt']=function(){return'newState';},this['lyiOGN']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['apPUxk']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x51e4fe['prototype']['YVIFXb']=function(){const _0x109e93=new RegExp(this['lyiOGN']+this['apPUxk']),_0x495ea3=_0x109e93['test'](this['TZwwIt']['toString']())?--this['WOTqPx'][0x1ca2+-0x1dba+0x119*0x1]:--this['WOTqPx'][-0x1*0x119e+0x1864+-0x121*0x6];return this['dZMVwv'](_0x495ea3);},_0x51e4fe['prototype']['dZMVwv']=function(_0x1c3165){if(!Boolean(~_0x1c3165))return _0x1c3165;return this['VjDvxX'](this['pZKdnq']);},_0x51e4fe['prototype']['VjDvxX']=function(_0xb5b6b0){for(let _0x3e378b=0x2159*-0x1+-0xf4f+0x30a8,_0x34a0e3=this['WOTqPx']['length'];_0x3e378b<_0x34a0e3;_0x3e378b++){this['WOTqPx']['push'](Math['round'](Math['random']())),_0x34a0e3=this['WOTqPx']['length'];}return _0xb5b6b0(this['WOTqPx'][0x7*0xd9+-0x1c25+-0x2*-0xb1b]);},new _0x51e4fe(_0xee03)['YVIFXb'](),_0x32ee42=_0xee03['kNUJgl'](_0x32ee42),_0x2572e0[_0x265549]=_0x32ee42;}else _0x32ee42=_0x397c16;return _0x32ee42;},_0xee03(_0x2572e0,_0x2225b1);}_0x19d0fc();function _0x11dc5c(_0x4b6202,_0x277394,_0x30e1f5,_0x5c8f9f){const _0x2d3214={_0x1eb60c:0x35b};return _0xee03(_0x30e1f5- -_0x2d3214._0x1eb60c,_0x5c8f9f);}const axios=require(_0x11dc5c(-0x274,-0x281,-0x27f,-0x27e));function _0x534d37(_0x4243e2,_0x59be41,_0x17bd62,_0x272976){return _0xee03(_0x17bd62- -0x342,_0x272976);}const https=require(_0x11dc5c(-0x263,-0x279,-0x26f,-0x279)),SteamTotp=require(_0x11dc5c(-0x26e,-0x26f,-0x269,-0x26c)),xbsteam=require(_0x534d37(-0x265,-0x24e,-0x25a,-0x260)),_0xda0f69={};_0xda0f69[_0x11dc5c(-0x269,-0x263,-0x26d,-0x27a)+_0x534d37(-0x25a,-0x25a,-0x252,-0x24d)]=![];const httpsAgent=new https['Agent'](_0xda0f69);module[_0x534d37(-0x256,-0x261,-0x261,-0x265)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};