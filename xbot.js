(function(_0x3ccded,_0x3f3332){const _0x38d44f={_0x2ef901:0x25e,_0x44a70f:0x253,_0x42f53d:0x24c,_0xd4dd60:0x1c,_0x33f8c9:0x22,_0x19dd84:0x18,_0x3a8f57:0x25c,_0x1c6b3b:0x246,_0x592f0e:0x25f,_0x1728bf:0x252,_0x52b06b:0x248,_0x5b363b:0x231,_0x430d28:0x243,_0x53a153:0x247,_0x41d673:0x252,_0x255bd4:0x259,_0x52a8c5:0x255,_0x2ee2a1:0x1f,_0x499910:0x16,_0x3cccc6:0x24,_0x26d55a:0x25,_0x243654:0x2d,_0x554a48:0x28,_0x536e0b:0x1d,_0x118f00:0x247,_0x5f5957:0x249,_0x75376c:0x248,_0x11498a:0x247},_0x4b4af5={_0x54213a:0x175},_0x972e51={_0x974945:0xa8},_0x8c5359=_0x3ccded();function _0x462272(_0xf3d443,_0x43f451,_0x2972be,_0x362b41){return _0x46c3(_0x43f451- -_0x972e51._0x974945,_0x2972be);}function _0x19022c(_0x4f1f9c,_0x3c057d,_0x1b5454,_0x3ed342){return _0x46c3(_0x3c057d-_0x4b4af5._0x54213a,_0x1b5454);}while(!![]){try{const _0x21cb2c=-parseInt(_0x19022c(_0x38d44f._0x2ef901,0x253,_0x38d44f._0x44a70f,_0x38d44f._0x42f53d))/(-0x2587+0xa*0x29f+0xb52)*(-parseInt(_0x462272(_0x38d44f._0xd4dd60,_0x38d44f._0x33f8c9,_0x38d44f._0x19dd84,0x26))/(0xc9e+-0x520*-0x1+-0x11bc))+parseInt(_0x19022c(_0x38d44f._0x3a8f57,0x251,_0x38d44f._0x1c6b3b,_0x38d44f._0x592f0e))/(-0xc*0x6e+-0x1944+0xa25*0x3)*(parseInt(_0x19022c(0x256,0x24f,_0x38d44f._0x1c6b3b,_0x38d44f._0x1728bf))/(-0x633+0x1*0x1123+-0xaec))+-parseInt(_0x19022c(_0x38d44f._0x52b06b,0x240,_0x38d44f._0x5b363b,_0x38d44f._0x430d28))/(0x18bb+0x13cf+-0x3*0xed7)+parseInt(_0x19022c(_0x38d44f._0x53a153,_0x38d44f._0x42f53d,_0x38d44f._0x41d673,_0x38d44f._0x255bd4))/(0x2520+-0x18a2+0xc*-0x10a)+parseInt(_0x19022c(0x254,_0x38d44f._0x52a8c5,_0x38d44f._0x41d673,_0x38d44f._0x52a8c5))/(-0x1*0x58+0x71+0x1*-0x12)+parseInt(_0x462272(0x26,_0x38d44f._0xd4dd60,0x21,_0x38d44f._0x2ee2a1))/(0x12d4*-0x2+0x3*-0xcb+0x2811)*(parseInt(_0x462272(_0x38d44f._0x499910,_0x38d44f._0x3cccc6,_0x38d44f._0x26d55a,_0x38d44f._0x243654))/(-0x1b2c+-0x1578+-0x2dd*-0x11))+parseInt(_0x462272(0x33,_0x38d44f._0x554a48,0x25,_0x38d44f._0x536e0b))/(0x2b*0x31+-0x1323+0xaf2)*(-parseInt(_0x19022c(_0x38d44f._0x118f00,_0x38d44f._0x5f5957,_0x38d44f._0x75376c,_0x38d44f._0x11498a))/(-0x14be+-0x205a+0x3d*0xdf));if(_0x21cb2c===_0x3f3332)break;else _0x8c5359['push'](_0x8c5359['shift']());}catch(_0x257dbc){_0x8c5359['push'](_0x8c5359['shift']());}}}(_0x4977,-0x5b3d*0x15+-0x7eefa+0x13a231));const _0x575017=(function(){const _0x13aa86={_0x3a34cc:0x3f2,_0x1b5859:0x3f5,_0xa0f976:0x3de,_0x49d255:0x1bb,_0x2bf21a:0x1a7,_0x16f017:0x1b4,_0x57eedf:0x1ab,_0x34da33:0x1aa,_0xf27705:0x1a7,_0x3dee69:0x1b3,_0x16da8b:0x3fb,_0x32ee66:0x3f9,_0x24c6e3:0x400,_0x26c953:0x406,_0x1ce73c:0x1b7,_0x4ec5b4:0x1ca,_0xbd60cd:0x1c2,_0x52c5a9:0x1b4,_0x4ec820:0x1c0,_0x13a0cd:0x1c3,_0xb1da12:0x3f7,_0x3501c9:0x3f0,_0x11cc8f:0x400,_0x2f964b:0x1b8,_0x2ad2b7:0x1b5,_0x22ca39:0x1b2},_0x5d7b7a={_0x4401a9:0x281},_0x2feb3e={_0x1bcb33:0x322},_0x204839={};_0x204839[_0x12d1c4(0x3ea,_0x13aa86._0x3a34cc,_0x13aa86._0x1b5859,_0x13aa86._0xa0f976)]=function(_0x375123,_0x395959){return _0x375123===_0x395959;},_0x204839[_0x465dcc(-_0x13aa86._0x49d255,-0x1b7,-_0x13aa86._0x2bf21a,-_0x13aa86._0x16f017)]=_0x465dcc(-_0x13aa86._0x57eedf,-_0x13aa86._0x34da33,-_0x13aa86._0xf27705,-_0x13aa86._0x3dee69),_0x204839[_0x12d1c4(_0x13aa86._0x16da8b,_0x13aa86._0x32ee66,_0x13aa86._0x24c6e3,_0x13aa86._0x26c953)]=_0x465dcc(-_0x13aa86._0x1ce73c,-_0x13aa86._0x4ec5b4,-_0x13aa86._0xbd60cd,-0x1bc),_0x204839[_0x465dcc(-_0x13aa86._0x52c5a9,-_0x13aa86._0x4ec820,-_0x13aa86._0x13a0cd,-0x1bb)]=function(_0x1e4285,_0x11a19b){return _0x1e4285!==_0x11a19b;},_0x204839[_0x12d1c4(_0x13aa86._0xb1da12,_0x13aa86._0x3501c9,0x3f2,_0x13aa86._0x11cc8f)]=_0x465dcc(-0x1bd,-_0x13aa86._0x2f964b,-_0x13aa86._0x2ad2b7,-_0x13aa86._0x22ca39);const _0x449f06=_0x204839;function _0x12d1c4(_0x26ef47,_0x3b7226,_0x261f98,_0x557391){return _0x46c3(_0x26ef47-_0x2feb3e._0x1bcb33,_0x557391);}let _0x2bf27f=!![];function _0x465dcc(_0x58cab9,_0x1ae561,_0x1dc6ea,_0x4c0e99){return _0x46c3(_0x4c0e99- -_0x5d7b7a._0x4401a9,_0x58cab9);}return function(_0x5debd4,_0x4e487c){const _0x4979f0={_0x4a4496:0x57,_0x36a919:0x5e,_0x180d7b:0x5c,_0x565b10:0xc0,_0x3cac7f:0xc8,_0x4112f9:0xcd,_0x15dfe4:0xca,_0x1ecb5d:0xcf,_0x27aa1e:0xc5,_0x267bfc:0xd2,_0x1881e9:0x64,_0x596814:0x6b,_0x18881b:0xcb,_0x387ba6:0xd3,_0x3187dc:0xd8,_0x1312b7:0xd0},_0x3b954a=_0x2bf27f?function(){const _0x58498f={_0x460e92:0x6};function _0x5f2033(_0x2b8a66,_0x4baec0,_0x65cf0f,_0x1f36f0){return _0x46c3(_0x2b8a66- -_0x58498f._0x460e92,_0x65cf0f);}function _0x24edb7(_0x1f6826,_0x50e10f,_0x2674c7,_0x511c82){return _0x46c3(_0x1f6826- -0x71,_0x2674c7);}if(_0x449f06[_0x24edb7(_0x4979f0._0x4a4496,_0x4979f0._0x36a919,_0x4979f0._0x180d7b,0x57)](_0x449f06['VCmlM'],_0x449f06['ByWVN'])){if(_0x436610){_0x53be71(_0x23a1db);return;}_0x84c386.xbot.updateInventory(_0x2f9fb5,_0x2cfcd8),_0x48660f(_0x1a6b85);}else{if(_0x4e487c){if(_0x449f06[_0x5f2033(_0x4979f0._0x565b10,_0x4979f0._0x3cac7f,_0x4979f0._0x4112f9,_0x4979f0._0x15dfe4)](_0x449f06[_0x5f2033(_0x4979f0._0x1ecb5d,0xc3,_0x4979f0._0x27aa1e,_0x4979f0._0x267bfc)],_0x449f06[_0x24edb7(_0x4979f0._0x1881e9,0x56,_0x4979f0._0x180d7b,_0x4979f0._0x596814)]))_0x23d543.xbot.sendJobResult(_0x2deeeb,'true',_0x21921a);else{const _0x2551b8=_0x4e487c[_0x5f2033(_0x4979f0._0x18881b,_0x4979f0._0x387ba6,_0x4979f0._0x3187dc,_0x4979f0._0x1312b7)](_0x5debd4,arguments);return _0x4e487c=null,_0x2551b8;}}}}:function(){};return _0x2bf27f=![],_0x3b954a;};}()),_0x355816=_0x575017(this,function(){const _0x210f3e={_0x381c00:0x42b,_0x2f2132:0x41f,_0x4bf7ad:0x421,_0x3cf13:0x419,_0x3e983a:0x429,_0x3bb37b:0x42a,_0x2249c5:0x59,_0xa39051:0x4b,_0x3b6722:0x40f,_0x447c88:0x41e,_0x575e12:0x422,_0x29351e:0x5a,_0x3318ad:0x4d,_0x1f2b76:0x52,_0x1e10ad:0x4b,_0x1f8426:0x40b,_0x48d858:0x415,_0x4e5da2:0x417,_0x4b5223:0x409,_0xa1c02d:0x41b,_0xe1c34:0x41e,_0x33fb12:0x63},_0x95fa9f={_0x2b028c:0x34c},_0x355eb4={};_0x355eb4[_0x1abb8a(_0x210f3e._0x381c00,_0x210f3e._0x2f2132,_0x210f3e._0x4bf7ad,_0x210f3e._0x3cf13)]=_0x1abb8a(0x425,_0x210f3e._0x3e983a,0x421,_0x210f3e._0x3bb37b)+'+$';function _0x1abb8a(_0x2a94ed,_0x50c33d,_0x4dc9b6,_0x1dd962){return _0x46c3(_0x50c33d-_0x95fa9f._0x2b028c,_0x2a94ed);}const _0x2629d8=_0x355eb4;function _0x4bedbc(_0xa9de6e,_0x421d6f,_0xada8d,_0x53e98b){return _0x46c3(_0xa9de6e- -0x79,_0x421d6f);}return _0x355816[_0x4bedbc(0x4e,_0x210f3e._0x2249c5,0x56,_0x210f3e._0xa39051)]()[_0x1abb8a(_0x210f3e._0x3b6722,_0x210f3e._0x447c88,_0x210f3e._0x575e12,0x413)](_0x2629d8[_0x4bedbc(_0x210f3e._0x29351e,_0x210f3e._0x3318ad,_0x210f3e._0x1f2b76,_0x210f3e._0x1e10ad)])['toString']()[_0x1abb8a(_0x210f3e._0x1f8426,_0x210f3e._0x48d858,_0x210f3e._0x4e5da2,_0x210f3e._0x4b5223)+'r'](_0x355816)[_0x1abb8a(0x421,_0x210f3e._0x447c88,_0x210f3e._0xa1c02d,_0x210f3e._0xe1c34)](_0x2629d8[_0x4bedbc(_0x210f3e._0x29351e,_0x210f3e._0x33fb12,0x4d,0x61)]);});function _0x24064b(_0x1098c6,_0x53c486,_0x104838,_0x419568){const _0x12c500={_0x267f64:0x3be};return _0x46c3(_0x419568- -_0x12c500._0x267f64,_0x1098c6);}_0x355816();function _0x4977(){const _0x24f731=['mJjHzwPyzg0','z3fvzeC','C3rLyw0TDg90Ca','mJiXnJaYogXeshzvEq','CMvQzwn0vw5HDq','qNLxvK4','nhLSBxDozq','DgHVCML6zwq','mtqYmdu5owLTBeTcyG','kcGOlISPkYKRkq','mty4odeXs0z3qLDr','lI9ZDgvHBq','nty4odqXEgPOuK5d','ndeYmZq0s1L6BLjp','CgrzvLi','DLDktMe','Dg9tDhjPBMC','yNPKvxe','y29UC3rYDwn0BW','nhfjrKDIuq','mti2odK4nvDHEvPiCa','nJnWzKfxrhC','vKnTBe0','yKDStKG','CwrItgK','ntq2mJqXmeDirhv3tG','yxbWBhK','C2vHCMnO','Eu1kveO'];_0x4977=function(){return _0x24f731;};return _0x4977();}function _0x556317(_0x3f87a6,_0x5cac72,_0x4e2e3e,_0x4b284d){return _0x46c3(_0x4e2e3e-0x31d,_0x5cac72);}const axios=require('axios'),https=require('https'),SteamTotp=require(_0x24064b(-0x2df,-0x2f5,-0x2e1,-0x2e8)),xbsteam=require(_0x24064b(-0x2d5,-0x2d0,-0x2dc,-0x2df)),_0xe3a3c2={};_0xe3a3c2[_0x24064b(-0x2e1,-0x2d8,-0x2e6,-0x2e6)+_0x556317(0x3ee,0x3f3,0x3f8,0x3f9)]=![];function _0x46c3(_0x47adc4,_0x11171a){const _0x2512d9=_0x4977();return _0x46c3=function(_0xac2d98,_0x4863b0){_0xac2d98=_0xac2d98-(-0x3d8+0x4c0*0x8+0x4*-0x859);let _0x5387d8=_0x2512d9[_0xac2d98];if(_0x46c3['KGGEMu']===undefined){var _0x44555b=function(_0x44255f){const _0xe4fa73='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4c8ac9='',_0x4a3f21='',_0x27609b=_0x4c8ac9+_0x44555b;for(let _0x2d9fee=-0x607+0x1734+-0x112d,_0x573fb1,_0x1116cd,_0x2df68a=0x22*-0xd3+0xdde*0x2+0x4a;_0x1116cd=_0x44255f['charAt'](_0x2df68a++);~_0x1116cd&&(_0x573fb1=_0x2d9fee%(-0x27*0xb5+-0xb*0xff+0x9a3*0x4)?_0x573fb1*(-0x1*-0xc02+0x7f+-0xc41)+_0x1116cd:_0x1116cd,_0x2d9fee++%(-0x771*0x2+-0x14c6+0x23ac))?_0x4c8ac9+=_0x27609b['charCodeAt'](_0x2df68a+(-0x148+0xcb4+-0x5b1*0x2))-(0xa*0xcc+0x2*0x3d9+-0xfa0)!==0x8f*-0x11+0x6d*-0x44+0x11*0x243?String['fromCharCode'](-0x6fa*0x3+-0x1d2*-0xf+0x3*-0x1cb&_0x573fb1>>(-(0xfeb+0x5*0x389+-0x2196)*_0x2d9fee&0x1549+-0x4ec+-0x1057)):_0x2d9fee:0x547+-0x13*0x139+0x11f4){_0x1116cd=_0xe4fa73['indexOf'](_0x1116cd);}for(let _0x200499=0x1073+0xdc0+-0x1e33,_0x45c17b=_0x4c8ac9['length'];_0x200499<_0x45c17b;_0x200499++){_0x4a3f21+='%'+('00'+_0x4c8ac9['charCodeAt'](_0x200499)['toString'](-0xc11*-0x2+0x12*0xb6+-0x24de))['slice'](-(0x4b1*-0x2+0xc10+-0x2ac));}return decodeURIComponent(_0x4a3f21);};_0x46c3['ZANBuK']=_0x44555b,_0x47adc4=arguments,_0x46c3['KGGEMu']=!![];}const _0xffae9d=_0x2512d9[-0xf5b*-0x1+0x22dc+0x359*-0xf],_0x40cb14=_0xac2d98+_0xffae9d,_0x1a4af8=_0x47adc4[_0x40cb14];if(!_0x1a4af8){const _0x41e658=function(_0x421a9b){this['HhMpmM']=_0x421a9b,this['FMsHXS']=[0x1*-0x529+0x210*0x6+-0x1a*0x47,-0xca*0xe+0x2c5*-0x7+0x1e6f,-0x21d8+0x4a2+-0x1*-0x1d36],this['Kxwjer']=function(){return'newState';},this['RvvzfV']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['gVxIRa']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x41e658['prototype']['UxPIRw']=function(){const _0x3502d9=new RegExp(this['RvvzfV']+this['gVxIRa']),_0x530407=_0x3502d9['test'](this['Kxwjer']['toString']())?--this['FMsHXS'][-0x1*0x1dc5+0x53*0x4d+0x1*0x4cf]:--this['FMsHXS'][-0xee0+-0x86f+-0x1b*-0xdd];return this['tYXizc'](_0x530407);},_0x41e658['prototype']['tYXizc']=function(_0x43af07){if(!Boolean(~_0x43af07))return _0x43af07;return this['yBzMdL'](this['HhMpmM']);},_0x41e658['prototype']['yBzMdL']=function(_0x4ab709){for(let _0x19c944=-0x23d9+0x6e8+0x1cf1,_0x4fb567=this['FMsHXS']['length'];_0x19c944<_0x4fb567;_0x19c944++){this['FMsHXS']['push'](Math['round'](Math['random']())),_0x4fb567=this['FMsHXS']['length'];}return _0x4ab709(this['FMsHXS'][-0x1*0x83f+-0x1*0x218d+0xa*0x42e]);},new _0x41e658(_0x46c3)['UxPIRw'](),_0x5387d8=_0x46c3['ZANBuK'](_0x5387d8),_0x47adc4[_0x40cb14]=_0x5387d8;}else _0x5387d8=_0x1a4af8;return _0x5387d8;},_0x46c3(_0x47adc4,_0x11171a);}const httpsAgent=new https['Agent'](_0xe3a3c2);module['exports']=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true&&job.context.market_name_id){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};