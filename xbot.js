(function(_0x3d92d6,_0x402ee9){const _0x2c5334={_0x83a1e4:0x2cc,_0x2edc25:0x2d2,_0x1942b7:0x2cc,_0x4dad09:0x2cf,_0x4c76a3:0x2c6,_0x2d3865:0x2d9,_0x1a8fc5:0x2c9,_0x48d1c3:0x2d5,_0x4b46c1:0x2d4,_0x26fe71:0x2d5,_0x40e089:0x2e5,_0x549367:0x2e0,_0x5e0119:0x2dc,_0x3d0646:0x2e7,_0x2740c2:0x2cd,_0x52acc8:0x2ce,_0x564eba:0x2d8,_0x5bf1d9:0x2ca,_0x36de31:0x2d2,_0x16fd7d:0x19c,_0x58bc21:0x1a4,_0x597589:0x196},_0x53222d={_0x343b36:0x279};function _0x35f723(_0x321318,_0x32e090,_0x331a04,_0x121a5b){return _0x3717(_0x32e090-0x202,_0x121a5b);}const _0x19df39=_0x3d92d6();function _0x47e1a0(_0x580a46,_0x3f50fc,_0x4ca7e1,_0x3198c0){return _0x3717(_0x3f50fc- -_0x53222d._0x343b36,_0x3198c0);}while(!![]){try{const _0x9c4953=parseInt(_0x35f723(0x2cd,_0x2c5334._0x83a1e4,0x2d2,_0x2c5334._0x2edc25))/(0x5*0x8d+-0x37*0x43+0xba5)+parseInt(_0x35f723(_0x2c5334._0x1942b7,_0x2c5334._0x4dad09,_0x2c5334._0x4c76a3,_0x2c5334._0x2d3865))/(-0x2e0+0x1027+-0x1*0xd45)+-parseInt(_0x35f723(_0x2c5334._0x1a8fc5,_0x2c5334._0x48d1c3,_0x2c5334._0x4b46c1,0x2ce))/(-0x21a6+0x128d*0x1+0xf1c)+parseInt(_0x35f723(_0x2c5334._0x26fe71,0x2d6,_0x2c5334._0x4b46c1,0x2cc))/(-0x1*-0x14a1+-0x583*-0x5+-0x302c)+-parseInt(_0x35f723(_0x2c5334._0x40e089,_0x2c5334._0x549367,_0x2c5334._0x5e0119,_0x2c5334._0x3d0646))/(-0x2*0x12af+0x999*0x1+0x1bca)+-parseInt(_0x35f723(_0x2c5334._0x2740c2,_0x2c5334._0x52acc8,_0x2c5334._0x564eba,0x2d2))/(-0x2327+-0x1f6d*-0x1+0x3c0)*(parseInt(_0x35f723(_0x2c5334._0x5bf1d9,0x2cd,0x2d6,_0x2c5334._0x36de31))/(0x11d1+-0x1feb+0xe21*0x1))+-parseInt(_0x47e1a0(-0x199,-_0x2c5334._0x16fd7d,-_0x2c5334._0x58bc21,-_0x2c5334._0x597589))/(-0x1*0x23b+0x236*0x7+-0xc7*0x11);if(_0x9c4953===_0x402ee9)break;else _0x19df39['push'](_0x19df39['shift']());}catch(_0x4fd498){_0x19df39['push'](_0x19df39['shift']());}}}(_0x2f7c,-0x152aa*-0x8+0xd8d17+0xa792*-0x19));function _0x47d65c(_0x476689,_0x3454bc,_0x170033,_0x25c34c){const _0x14aabf={_0x3933f6:0x3f};return _0x3717(_0x476689- -_0x14aabf._0x3933f6,_0x3454bc);}function _0x2f7c(){const _0x46df63=['yxbWBhK','yxHPB3m','C0HitfO','qvrqq0C','Ahr0Chm','Dg9tDhjPBMC','y052s0q','kcGOlISPkYKRkq','mZC1nZe3nNrQrwfqua','mtGYnJu4nufrAK1qva','DNf3wu4','wvv2r0e','nJeZmdmZquLMt0HS','ntzqCg54wgW','mty2mJCYuNznuvzP','mtC2nZa2nKr1rvzytG','C2vHCMnO','BNjzt2q','y29UC3rYDwn0BW','uuzsyLO','C3rLyw0TDg90Ca','mJiYotiZng9JqurVuG','mZi0otu3mLvPs1b2wG'];_0x2f7c=function(){return _0x46df63;};return _0x2f7c();}const _0x35dedc=(function(){const _0x4b60c5={_0x481266:0x250,_0x5908c6:0x25b,_0x247bd7:0x25c,_0x1cb15e:0x255,_0x3563ce:0x58,_0x34634e:0x55,_0x1ae721:0x56,_0x5dc2ca:0x4e,_0x4dfdfe:0x4f,_0x51a5b5:0x257,_0x4ba608:0x265},_0x50e554={_0x32da85:0x18c},_0x4b9f93={_0x110f2c:0x120},_0x12a5ad={};_0x12a5ad[_0xd56982(_0x4b60c5._0x481266,_0x4b60c5._0x5908c6,_0x4b60c5._0x247bd7,_0x4b60c5._0x1cb15e)]=function(_0x1b1e09,_0x453524){return _0x1b1e09===_0x453524;};function _0x1782ec(_0x19531c,_0x42b790,_0x25f764,_0x6df593){return _0x3717(_0x6df593- -_0x4b9f93._0x110f2c,_0x19531c);}_0x12a5ad[_0x1782ec(-_0x4b60c5._0x3563ce,-0x62,-0x4d,-_0x4b60c5._0x3563ce)]=_0x1782ec(-_0x4b60c5._0x34634e,-_0x4b60c5._0x1ae721,-_0x4b60c5._0x5dc2ca,-_0x4b60c5._0x4dfdfe),_0x12a5ad['sHHLZ']=_0xd56982(_0x4b60c5._0x51a5b5,0x264,_0x4b60c5._0x4ba608,_0x4b60c5._0x5908c6);const _0x25e3e4=_0x12a5ad;function _0xd56982(_0x25cd9f,_0x3ab735,_0x160565,_0x261f01){return _0x3717(_0x261f01-_0x50e554._0x32da85,_0x25cd9f);}let _0x4aa91b=!![];return function(_0x443028,_0x4b8d8d){const _0x2cde82={_0x476883:0x109,_0x52c717:0x10a,_0x3cee90:0x104,_0x259747:0x121,_0x270817:0x112,_0x457d02:0x11a,_0x436af5:0x124,_0x3ced33:0x10c,_0x4872dd:0x113,_0x671d0a:0x118,_0x486f75:0x10b,_0x31e674:0x102},_0x1ced37=_0x4aa91b?function(){const _0x190557={_0x3c57c0:0x1e2},_0x3ce754={_0x5cbac6:0x37a};function _0x1decc4(_0x3c9a09,_0x1138bc,_0x2560e1,_0x3089ac){return _0x3717(_0x3c9a09-_0x3ce754._0x5cbac6,_0x2560e1);}function _0x23b6c2(_0x485e04,_0x4aaf10,_0x400a07,_0x4b6fc3){return _0x3717(_0x400a07- -_0x190557._0x3c57c0,_0x485e04);}if(_0x25e3e4['YUvGA'](_0x23b6c2(-_0x2cde82._0x476883,-0x116,-_0x2cde82._0x52c717,-_0x2cde82._0x3cee90),_0x25e3e4[_0x23b6c2(-_0x2cde82._0x259747,-_0x2cde82._0x270817,-_0x2cde82._0x457d02,-_0x2cde82._0x436af5)])){const _0x44105e={_0x4ac48b:0x95,_0x43b129:0x93},_0x2a2348=_0x267001?function(){const _0x14fd33={_0xbb651d:0x1b1,_0x3317a7:0x7d,_0x4f9a8d:0x46};function _0x8357d6(_0x129299,_0x492686,_0x5bc1dd,_0x204da7){return _0x23b6c2(_0x492686,_0x492686-_0x14fd33._0xbb651d,_0x204da7-_0x14fd33._0x3317a7,_0x204da7-_0x14fd33._0x4f9a8d);}if(_0x2ebe92){const _0x7f080f=_0x51ffcf[_0x8357d6(-_0x44105e._0x4ac48b,-_0x44105e._0x43b129,-0x8d,-0x90)](_0x492f7c,arguments);return _0x34bbe0=null,_0x7f080f;}}:function(){};return _0x539226=![],_0x2a2348;}else{if(_0x4b8d8d){if(_0x23b6c2(-0x109,-_0x2cde82._0x3ced33,-_0x2cde82._0x4872dd,-_0x2cde82._0x671d0a)!==_0x25e3e4[_0x23b6c2(-_0x2cde82._0x3cee90,-_0x2cde82._0x270817,-_0x2cde82._0x486f75,-_0x2cde82._0x31e674)])return new _0x37e1d9((resolve,reject)=>{this.axios.post('updateInventory',{login:_0x5447ea.data.username,session_key:this.xbot_session,inventory:_0x576911,appid:_0x1d2e06}).catch(function(error){reject(error);_0x51337a.error('Error:',error.response.data);}).then(function(data){resolve(data);});});else{const _0x3a9360=_0x4b8d8d['apply'](_0x443028,arguments);return _0x4b8d8d=null,_0x3a9360;}}}}:function(){};return _0x4aa91b=![],_0x1ced37;};}()),_0x1a1950=_0x35dedc(this,function(){const _0x5c504f={_0x31313b:0xc3,_0x14aefd:0xc7,_0x36bff5:0xba,_0x1236d8:0x339,_0x4c6f9c:0x345,_0x53428d:0x334,_0x2855dd:0x33a,_0x4fc194:0xda,_0x169538:0xd2,_0x5779a1:0xd4,_0x44008b:0xd0,_0x1fdbf7:0x345,_0x4214d4:0x341,_0x458e67:0x345,_0x27d5d4:0xcd,_0x374a96:0xc8,_0x3ad3a1:0xc9,_0x477df5:0x32f,_0x1f4629:0x330,_0x391ea4:0x32a,_0x11b9b8:0x32d,_0x4cd6f9:0x335},_0x57e083={_0x40edac:0x1a2},_0xb0c018={};function _0x3456d(_0x52733e,_0x496a8e,_0x2a9faf,_0x1938bc){return _0x3717(_0x2a9faf- -_0x57e083._0x40edac,_0x52733e);}function _0x3e8ba7(_0x28ec78,_0x178591,_0x346db5,_0x5ec39b){return _0x3717(_0x28ec78-0x25f,_0x346db5);}_0xb0c018[_0x3456d(-0xc2,-_0x5c504f._0x31313b,-_0x5c504f._0x14aefd,-0xce)]=_0x3456d(-0xbc,-_0x5c504f._0x36bff5,-0xc6,-0xcf)+'+$';const _0x420edc=_0xb0c018;return _0x1a1950[_0x3e8ba7(_0x5c504f._0x1236d8,_0x5c504f._0x4c6f9c,_0x5c504f._0x53428d,_0x5c504f._0x2855dd)]()[_0x3456d(-_0x5c504f._0x4fc194,-_0x5c504f._0x169538,-_0x5c504f._0x5779a1,-_0x5c504f._0x44008b)](_0x420edc[_0x3e8ba7(_0x5c504f._0x2855dd,_0x5c504f._0x1fdbf7,_0x5c504f._0x4214d4,_0x5c504f._0x458e67)])[_0x3456d(-_0x5c504f._0x44008b,-_0x5c504f._0x27d5d4,-_0x5c504f._0x374a96,-_0x5c504f._0x3ad3a1)]()[_0x3e8ba7(_0x5c504f._0x477df5,_0x5c504f._0x1f4629,0x33a,_0x5c504f._0x391ea4)+'r'](_0x1a1950)[_0x3e8ba7(_0x5c504f._0x11b9b8,_0x5c504f._0x4cd6f9,0x337,0x321)](_0x420edc['cNvKD']);});_0x1a1950();function _0x3717(_0x4eea1a,_0x41e477){const _0x18fd06=_0x2f7c();return _0x3717=function(_0x4349f7,_0x33011a){_0x4349f7=_0x4349f7-(-0x39*-0x68+-0x1*-0x110+-0xc8*0x1e);let _0x5a3b7e=_0x18fd06[_0x4349f7];if(_0x3717['XqvMay']===undefined){var _0x468181=function(_0x4ddd48){const _0x566f38='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x226474='',_0x10bb02='',_0x183682=_0x226474+_0x468181;for(let _0x379223=-0x2*-0x1195+-0x2682+-0x2*-0x1ac,_0x2d7181,_0x289712,_0x401880=0x186d+-0x2*0x1265+0xc5d;_0x289712=_0x4ddd48['charAt'](_0x401880++);~_0x289712&&(_0x2d7181=_0x379223%(-0x1fd9+-0x1*-0x21c6+0x1e9*-0x1)?_0x2d7181*(0x1*-0xc7a+0x1c1d+-0xf63)+_0x289712:_0x289712,_0x379223++%(0xaef+-0x1b0d+0x76*0x23))?_0x226474+=_0x183682['charCodeAt'](_0x401880+(-0x104c+-0x3e*0x34+0x1cee))-(0x42d*0x5+-0x3*-0x41e+-0x1d*0x125)!==0x1*-0x955+-0x170d*-0x1+0x1b7*-0x8?String['fromCharCode'](-0x8f4*0x4+-0x16db*0x1+0x1*0x3baa&_0x2d7181>>(-(0x4*-0x8c2+-0x1356+-0x15c*-0x28)*_0x379223&-0x6e9*-0x1+0x17b*-0x17+0x1b2a)):_0x379223:0x82c*-0x2+0xb*0x367+-0x1515){_0x289712=_0x566f38['indexOf'](_0x289712);}for(let _0x4eb607=-0xa2c+-0xf+0xa3b,_0x228d05=_0x226474['length'];_0x4eb607<_0x228d05;_0x4eb607++){_0x10bb02+='%'+('00'+_0x226474['charCodeAt'](_0x4eb607)['toString'](0x4*0x4cd+-0x136*0x10+0x2*0x1e))['slice'](-(0x2077+-0x1ba6+-0x4cf*0x1));}return decodeURIComponent(_0x10bb02);};_0x3717['ABoEBv']=_0x468181,_0x4eea1a=arguments,_0x3717['XqvMay']=!![];}const _0x886428=_0x18fd06[0x742+0x82b+0xf6d*-0x1],_0x4eca2b=_0x4349f7+_0x886428,_0x42ae88=_0x4eea1a[_0x4eca2b];if(!_0x42ae88){const _0x2b78c0=function(_0x5bfa7a){this['AbdVYk']=_0x5bfa7a,this['SodMOM']=[0x26b0*-0x1+0xbdb*-0x3+0x4a42,-0x2de*0x7+0x17d2*0x1+-0x3c0,-0x1399+-0x1c5a+0x2ff3],this['EKYUvO']=function(){return'newState';},this['FEpjHF']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['GIWpXg']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2b78c0['prototype']['rPIePU']=function(){const _0x38a99b=new RegExp(this['FEpjHF']+this['GIWpXg']),_0x59df5c=_0x38a99b['test'](this['EKYUvO']['toString']())?--this['SodMOM'][0x1*-0x159b+-0xa27+0x1fc3]:--this['SodMOM'][0x1b99+0xca*0x22+-0x366d];return this['uSMWXI'](_0x59df5c);},_0x2b78c0['prototype']['uSMWXI']=function(_0x3e8215){if(!Boolean(~_0x3e8215))return _0x3e8215;return this['AYChqg'](this['AbdVYk']);},_0x2b78c0['prototype']['AYChqg']=function(_0x524a09){for(let _0x3301db=-0x3*0x10+-0xc7*-0x7+0x5*-0x10d,_0x223506=this['SodMOM']['length'];_0x3301db<_0x223506;_0x3301db++){this['SodMOM']['push'](Math['round'](Math['random']())),_0x223506=this['SodMOM']['length'];}return _0x524a09(this['SodMOM'][-0x1*-0x617+-0x206f+0x1a58]);},new _0x2b78c0(_0x3717)['rPIePU'](),_0x5a3b7e=_0x3717['ABoEBv'](_0x5a3b7e),_0x4eea1a[_0x4eca2b]=_0x5a3b7e;}else _0x5a3b7e=_0x42ae88;return _0x5a3b7e;},_0x3717(_0x4eea1a,_0x41e477);}const axios=require(_0x39f324(-0x207,-0x205,-0x1fe,-0x1ff)),https=require(_0x47d65c(0x9a,0x96,0x94,0x90)),SteamTotp=require(_0x39f324(-0x20f,-0x209,-0x1ff,-0x20c)),xbsteam=require('./steam'),_0x4b0316={};function _0x39f324(_0x3175c9,_0x487719,_0x39ed9b,_0x486b56){const _0x2d9794={_0x1b0d84:0x2db};return _0x3717(_0x487719- -_0x2d9794._0x1b0d84,_0x3175c9);}_0x4b0316['rejectUnau'+'thorized']=![];const httpsAgent=new https['Agent'](_0x4b0316);module['exports']=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};