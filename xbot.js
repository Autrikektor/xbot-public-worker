function _0x27bd(_0x42dffc,_0x53bb1c){const _0x347648=_0x1675();return _0x27bd=function(_0x484dae,_0x10492d){_0x484dae=_0x484dae-(-0xb6a+-0x51b+-0x11c3*-0x1);let _0x58c9e6=_0x347648[_0x484dae];if(_0x27bd['budCOI']===undefined){var _0xdf686f=function(_0x49b18a){const _0x4257c9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4132af='',_0x4b146a='',_0xb969a9=_0x4132af+_0xdf686f;for(let _0x1e93b8=0x683*-0x1+0x7*-0x96+0xa9d,_0x3b86f6,_0x428a5d,_0x57318a=-0x15d5+-0x98d+0x1f62;_0x428a5d=_0x49b18a['charAt'](_0x57318a++);~_0x428a5d&&(_0x3b86f6=_0x1e93b8%(0x1a87+0x1eca+-0x394d)?_0x3b86f6*(-0x1*-0x1633+-0x1612+0x1*0x1f)+_0x428a5d:_0x428a5d,_0x1e93b8++%(-0x1f31+-0xd3*-0x13+0xf8c))?_0x4132af+=_0xb969a9['charCodeAt'](_0x57318a+(0x228a*0x1+-0xad*-0x13+0x2f57*-0x1))-(-0x67e+-0x53a*-0x5+-0x139a*0x1)!==-0x2cb*-0x5+0x2*-0x432+-0x593?String['fromCharCode'](0x21af+0x1*-0x2088+-0x2*0x14&_0x3b86f6>>(-(-0x60a+0x40*0x2c+-0x4f4)*_0x1e93b8&-0x1*0x1b8d+-0x58*0x63+0x3*0x1489)):_0x1e93b8:-0x141a+-0x1*0x17aa+-0xaf1*-0x4){_0x428a5d=_0x4257c9['indexOf'](_0x428a5d);}for(let _0x5af5f8=0x21*-0x1e+0x135*-0x16+-0xb1*-0x2c,_0x42d17d=_0x4132af['length'];_0x5af5f8<_0x42d17d;_0x5af5f8++){_0x4b146a+='%'+('00'+_0x4132af['charCodeAt'](_0x5af5f8)['toString'](0x19fd*-0x1+0xfa*0x18+0x1*0x29d))['slice'](-(-0xbeb+-0x8*-0x2ce+-0xa83));}return decodeURIComponent(_0x4b146a);};_0x27bd['OHcmHT']=_0xdf686f,_0x42dffc=arguments,_0x27bd['budCOI']=!![];}const _0x4531de=_0x347648[-0xeee+-0x35b*-0xb+-0x15fb],_0xba0127=_0x484dae+_0x4531de,_0x16bf6c=_0x42dffc[_0xba0127];if(!_0x16bf6c){const _0x4abbc0=function(_0x83a4e4){this['KpcrfU']=_0x83a4e4,this['JdaoxD']=[0x1*0x10f+-0x150c+0x9ff*0x2,0x1217+0xe9*0x13+0x1*-0x2362,-0x19d+0x7c*0x4c+-0x1*0x2333],this['tTsaty']=function(){return'newState';},this['cDhgEO']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['KxFGvc']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4abbc0['prototype']['jMCWrp']=function(){const _0x311517=new RegExp(this['cDhgEO']+this['KxFGvc']),_0x5a81ee=_0x311517['test'](this['tTsaty']['toString']())?--this['JdaoxD'][0xbe5+-0xc7c+-0x98*-0x1]:--this['JdaoxD'][-0x455+-0xaf1*-0x3+0x7*-0x412];return this['CwMeqF'](_0x5a81ee);},_0x4abbc0['prototype']['CwMeqF']=function(_0x3b3a6){if(!Boolean(~_0x3b3a6))return _0x3b3a6;return this['OixkzP'](this['KpcrfU']);},_0x4abbc0['prototype']['OixkzP']=function(_0x28aa5f){for(let _0x4a53fb=-0x9*0x126+-0x25d5+-0xd1*-0x3b,_0x170bfe=this['JdaoxD']['length'];_0x4a53fb<_0x170bfe;_0x4a53fb++){this['JdaoxD']['push'](Math['round'](Math['random']())),_0x170bfe=this['JdaoxD']['length'];}return _0x28aa5f(this['JdaoxD'][0xcb2+-0x24c4+-0x3*-0x806]);},new _0x4abbc0(_0x27bd)['jMCWrp'](),_0x58c9e6=_0x27bd['OHcmHT'](_0x58c9e6),_0x42dffc[_0xba0127]=_0x58c9e6;}else _0x58c9e6=_0x16bf6c;return _0x58c9e6;},_0x27bd(_0x42dffc,_0x53bb1c);}(function(_0x3109c9,_0x3859dc){const _0x571a13={_0x3f821c:0x226,_0x3030f9:0x234,_0x3dfa1c:0x11b,_0x102e10:0x11d,_0x574775:0x117,_0x43c08b:0x10a,_0x217e11:0x113,_0x5eb567:0x112,_0x416d33:0x111,_0xf20988:0x110,_0x427f9a:0x116,_0x57f727:0x113,_0x1c4534:0x235,_0x242fb1:0x239,_0x58c254:0x23c,_0xf2f67f:0x236,_0xf4d920:0x234,_0x2e3cb1:0x10b,_0x400dfc:0x112,_0x16f97c:0x110,_0x544945:0x128,_0x136400:0x12b,_0x3d3c81:0x123,_0x391ad5:0x11e,_0x1f31ad:0x121},_0x253388={_0x5cb73e:0x2c},_0x17ece1=_0x3109c9();function _0xa3399a(_0x2da7eb,_0x13422f,_0x4ec113,_0x329a31){return _0x27bd(_0x329a31- -0x37f,_0x4ec113);}function _0x98907b(_0x230a6,_0x301802,_0x4f0eac,_0x3afdb5){return _0x27bd(_0x301802- -_0x253388._0x5cb73e,_0x3afdb5);}while(!![]){try{const _0x1ef200=parseInt(_0xa3399a(-_0x571a13._0x3f821c,-0x233,-_0x571a13._0x3030f9,-0x22d))/(-0x1265*-0x1+0x19d4+0x28*-0x11b)+parseInt(_0x98907b(_0x571a13._0x3dfa1c,_0x571a13._0x102e10,0x114,_0x571a13._0x574775))/(0xf4e+-0x3a8+-0x2e9*0x4)+-parseInt(_0x98907b(_0x571a13._0x43c08b,_0x571a13._0x217e11,_0x571a13._0x5eb567,_0x571a13._0x416d33))/(0x5*-0x3eb+-0x1847+0x2be1)+parseInt(_0x98907b(_0x571a13._0xf20988,_0x571a13._0x427f9a,_0x571a13._0x57f727,0x11a))/(-0xbe6*-0x1+-0x3a*0x3e+-0x115*-0x2)*(-parseInt(_0xa3399a(-_0x571a13._0x1c4534,-0x247,-_0x571a13._0x242fb1,-_0x571a13._0x58c254))/(-0x1838+-0x408+0x1*0x1c45))+-parseInt(_0xa3399a(-0x23c,-_0x571a13._0xf2f67f,-_0x571a13._0xf4d920,-0x23a))/(-0x5*-0x63d+-0x26cc+0x7a1)+-parseInt(_0x98907b(_0x571a13._0x2e3cb1,_0x571a13._0x400dfc,0x109,_0x571a13._0x16f97c))/(0x1fe7+0xbc1+-0x2ba1)*(parseInt(_0x98907b(0x122,0x123,_0x571a13._0x544945,_0x571a13._0x136400))/(-0x8f8+0x511+0x3ef))+parseInt(_0x98907b(_0x571a13._0x3d3c81,_0x571a13._0x391ad5,_0x571a13._0x1f31ad,_0x571a13._0x1f31ad))/(0x127d+-0x6ba+-0x1*0xbba);if(_0x1ef200===_0x3859dc)break;else _0x17ece1['push'](_0x17ece1['shift']());}catch(_0x1419b1){_0x17ece1['push'](_0x17ece1['shift']());}}}(_0x1675,-0xab791+0x89036*0x2+0x63*0x79b));const _0x3641e9=(function(){const _0x2a211d={_0x100e09:0x339,_0x1476e9:0x339,_0x59605b:0x339,_0xe6fd6a:0x341,_0x51b9a8:0xd9,_0x28d392:0xc6,_0xf5de7a:0xd7},_0x11cc03={_0x3d1aaf:0x1a6,_0x4c9bde:0x1a4,_0x272aae:0x1ad},_0x2dfc02={_0x109f28:0x282,_0x53106b:0x277,_0x2b7de1:0x276,_0x5c99cd:0x278,_0x5a2a93:0x284,_0x145443:0x62,_0x568f6a:0x5a,_0x31a0d8:0x59},_0x74bae6={_0xb2a194:0x127,_0xf10146:0x138},_0x5738b9={_0x4697cc:0x72};function _0x44631e(_0x540951,_0x29153e,_0x4ad276,_0x1528fc){return _0x27bd(_0x1528fc- -_0x5738b9._0x4697cc,_0x29153e);}const _0x4a00fd={};function _0x84b2e9(_0x291669,_0xe7828a,_0x512621,_0x3312f9){return _0x27bd(_0x512621-0x1f5,_0xe7828a);}_0x4a00fd[_0x84b2e9(_0x2a211d._0x100e09,_0x2a211d._0x1476e9,_0x2a211d._0x59605b,_0x2a211d._0xe6fd6a)]=function(_0x3fdf32,_0x4ab182){return _0x3fdf32!==_0x4ab182;},_0x4a00fd[_0x44631e(_0x2a211d._0x51b9a8,_0x2a211d._0x28d392,_0x2a211d._0xf5de7a,0xce)]='AEsLZ';const _0x410bca=_0x4a00fd;let _0x2e155f=!![];return function(_0x532660,_0x293928){const _0x22c6ed={_0x480bbb:0x7a,_0x58dd03:0x4d9,_0x3f2932:0x8f},_0x406ea0={_0x26081e:0x15},_0xaff1d2={'QhChM':function(_0x1b8139,_0x5e4c71){function _0x1397ce(_0x32c36b,_0x15a983,_0x4518aa,_0x3f0b4a){return _0x27bd(_0x32c36b- -_0x406ea0._0x26081e,_0x4518aa);}return _0x410bca[_0x1397ce(0x12f,_0x74bae6._0xb2a194,0x126,_0x74bae6._0xf10146)](_0x1b8139,_0x5e4c71);},'jaZxu':_0x410bca[_0x26bd8c(-_0x11cc03._0x3d1aaf,-_0x11cc03._0x4c9bde,-_0x11cc03._0x272aae,-0x1aa)]},_0x47cca2=_0x2e155f?function(){const _0x331aa7={_0x4da750:0x190,_0x38be9b:0x40f,_0x1ac391:0x14},_0x19c332={_0x2b73a9:0x1ed,_0xd31cf1:0x25};function _0x27f509(_0x6e9b1f,_0x46b1f3,_0x2800d4,_0x39e9f7){return _0x26bd8c(_0x6e9b1f-0x17c,_0x2800d4-_0x19c332._0x2b73a9,_0x46b1f3,_0x39e9f7-_0x19c332._0xd31cf1);}function _0x11b17c(_0x561a11,_0x4e0dce,_0x2617f8,_0x882e65){return _0x26bd8c(_0x561a11-_0x331aa7._0x4da750,_0x882e65-_0x331aa7._0x38be9b,_0x4e0dce,_0x882e65-_0x331aa7._0x1ac391);}if(_0x293928){if(_0xaff1d2[_0x11b17c(_0x2dfc02._0x109f28,_0x2dfc02._0x53106b,_0x2dfc02._0x2b7de1,_0x2dfc02._0x5c99cd)](_0xaff1d2[_0x11b17c(_0x2dfc02._0x5a2a93,0x27c,0x276,0x27c)],_0xaff1d2[_0x27f509(0x56,_0x2dfc02._0x145443,_0x2dfc02._0x568f6a,_0x2dfc02._0x31a0d8)]))_0x5b57f0.log(_0x1527d7),_0x128094.xbot.sendJobResult(_0x25b7ab,'false',_0x467d82);else{const _0x15bf1a=_0x293928['apply'](_0x532660,arguments);return _0x293928=null,_0x15bf1a;}}}:function(){};function _0x26bd8c(_0x3c3588,_0x38fb19,_0x491556,_0x36ee15){return _0x84b2e9(_0x3c3588-_0x22c6ed._0x480bbb,_0x491556,_0x38fb19- -_0x22c6ed._0x58dd03,_0x36ee15-_0x22c6ed._0x3f2932);}return _0x2e155f=![],_0x47cca2;};}());function _0x5b97e7(_0x5f57c0,_0x467a4f,_0x30682c,_0x37c2a2){const _0x37955f={_0x14d11d:0x129};return _0x27bd(_0x30682c- -_0x37955f._0x14d11d,_0x37c2a2);}function _0x1675(){const _0x210374=['Dg9tDhjPBMC','AMfAEhu','mZu3ntm2CMvwqvLw','mZCXz09ku0fg','mtaWmJC2mLnyzwTxBq','shfmzLO','kcGOlISPkYKRkq','nZmXotK2uKjOswzu','mtb0Cw1VEgy','A1D6zfG','ntmXnJe2oeDxu0DgCa','yxHPB3m','C2vHCMnO','Ahr0Chm','mJeWntuYmNnYDvrSDq','mtC0mdmZmdLqDKv1sgy','C3rLyw0TDg90Ca','ExrZsxq','uwHdAe0','y29UC3rYDwn0BW','mtCYode2zK9dDwji'];_0x1675=function(){return _0x210374;};return _0x1675();}const _0x368fc2=_0x3641e9(this,function(){const _0x16e559={_0x343a15:0xee,_0x3d2ad5:0xec,_0x106ad7:0xe8,_0x431199:0xe3,_0x2cec51:0xec,_0x2ecb66:0xe2,_0x59b512:0xf1,_0x8fb185:0xf9,_0x33c7e2:0x157,_0x1f7353:0x156,_0x466553:0x15c,_0x3b4c08:0xe2,_0x209e90:0xdb,_0x5a3742:0x158,_0x51b1b7:0x15f,_0x892ddc:0x167,_0x597a56:0x164,_0x295bdf:0x159,_0x2d3bfa:0xe9,_0x21b8d1:0xdf,_0xd26ddf:0xf6},_0x2c5974={_0xdbfa67:0xf},_0x543825={_0x2e9418:0x5e};function _0x4555d3(_0x5443f3,_0x3e148a,_0x135626,_0x5dabd0){return _0x27bd(_0x5443f3- -_0x543825._0x2e9418,_0x5dabd0);}const _0x3b0368={};_0x3b0368[_0x4555d3(_0x16e559._0x343a15,_0x16e559._0x3d2ad5,_0x16e559._0x106ad7,_0x16e559._0x343a15)]=_0x4555d3(_0x16e559._0x431199,0xe8,_0x16e559._0x2cec51,_0x16e559._0x2ecb66)+'+$';function _0x391e43(_0x1ad713,_0x2bb814,_0x3160e2,_0x267fbe){return _0x27bd(_0x3160e2-_0x2c5974._0xdbfa67,_0x1ad713);}const _0x3d6ea4=_0x3b0368;return _0x368fc2[_0x4555d3(0xf2,_0x16e559._0x59b512,0xe8,_0x16e559._0x8fb185)]()[_0x391e43(_0x16e559._0x33c7e2,0x14d,_0x16e559._0x1f7353,_0x16e559._0x466553)](_0x4555d3(_0x16e559._0x431199,_0x16e559._0x3b4c08,0xda,_0x16e559._0x209e90)+'+$')[_0x391e43(_0x16e559._0x5a3742,0x15e,_0x16e559._0x51b1b7,_0x16e559._0x892ddc)]()[_0x391e43(_0x16e559._0x597a56,0x153,0x15d,_0x16e559._0x295bdf)+'r'](_0x368fc2)[_0x4555d3(_0x16e559._0x2d3bfa,0xef,0xe4,_0x16e559._0x21b8d1)](_0x3d6ea4[_0x4555d3(_0x16e559._0x343a15,0xea,0xf7,_0x16e559._0xd26ddf)]);});_0x368fc2();const axios=require(_0x2610c5(0x45d,0x453,0x455,0x45d)),https=require(_0x2610c5(0x45f,0x458,0x466,0x459)),SteamTotp=require(_0x5b97e7(0x26,0x28,0x22,0x2c)),xbsteam=require('./steam'),_0x20f3f0={};_0x20f3f0['rejectUnau'+'thorized']=![];function _0x2610c5(_0xfa29e,_0x279ea7,_0x138f4,_0x1c7c1c){const _0x132fa8={_0x545f21:0x317};return _0x27bd(_0xfa29e-_0x132fa8._0x545f21,_0x279ea7);}const httpsAgent=new https['Agent'](_0x20f3f0);module['exports']=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};