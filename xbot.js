(function(_0x3fceb4,_0x222325){const _0x45a250={_0x5e2a0a:0xc9,_0x566564:0xce,_0x1beefc:0x30,_0x136091:0x36,_0x438f8e:0x2f,_0x51a853:0xc3,_0x3e8043:0xce,_0x2fed33:0xcd,_0x1e7e1a:0xce,_0x2d67e9:0xca,_0x3ceb9c:0xc4,_0x37a89e:0xbb,_0x131ccc:0xcf,_0x351102:0xd5,_0x3fa929:0xd4,_0x180ce3:0xde,_0xcaf7c1:0x32,_0x1b141d:0x2c,_0x5b2840:0x36,_0x54c4dc:0x20,_0xd0a17f:0xc5,_0x57d6c3:0xd0,_0xbdf69d:0xdb,_0x1759e4:0xcb,_0x2a6d78:0x3d,_0x2162fe:0x31,_0x552d68:0x43,_0x12e3e0:0xd3,_0x982f65:0xcc,_0x4930be:0xd7,_0x36de6e:0x27,_0x428957:0x2a,_0x4f442e:0x34},_0x52ffdb={_0x1191e2:0x2b8},_0x4847cc={_0x3aeddf:0x21f};function _0x2e718(_0x22c5a3,_0xe4bb3d,_0x5bb81f,_0x2b7ee6){return _0x500b(_0xe4bb3d- -_0x4847cc._0x3aeddf,_0x2b7ee6);}function _0x3cb1ab(_0x5f5868,_0x133ea3,_0x283cce,_0x4aef47){return _0x500b(_0x133ea3- -_0x52ffdb._0x1191e2,_0x283cce);}const _0x4acd46=_0x3fceb4();while(!![]){try{const _0x2b9ce6=parseInt(_0x3cb1ab(-_0x45a250._0x5e2a0a,-0xcd,-_0x45a250._0x566564,-_0x45a250._0x5e2a0a))/(0x1cfa+0x22*0x43+-0x25df)*(parseInt(_0x2e718(-_0x45a250._0x1beefc,-_0x45a250._0x136091,-_0x45a250._0x438f8e,-0x3f))/(-0x1a37+-0x1ccd+0x2*0x1b83))+-parseInt(_0x3cb1ab(-_0x45a250._0x51a853,-_0x45a250._0x3e8043,-_0x45a250._0x2fed33,-_0x45a250._0x1e7e1a))/(0x416*-0x5+-0x16e+0x15df)*(-parseInt(_0x3cb1ab(-_0x45a250._0x2d67e9,-_0x45a250._0x3ceb9c,-0xc7,-_0x45a250._0x37a89e))/(0xf3*-0xd+-0x1145+-0x3*-0x9e0))+parseInt(_0x3cb1ab(-_0x45a250._0x131ccc,-_0x45a250._0x351102,-_0x45a250._0x3fa929,-_0x45a250._0x180ce3))/(-0x1428+-0x3*0x642+0x26f3)*(parseInt(_0x2e718(-_0x45a250._0xcaf7c1,-_0x45a250._0x1b141d,-_0x45a250._0x5b2840,-_0x45a250._0x54c4dc))/(-0x4d0*0x1+-0x2*0xae7+-0x26c*-0xb))+-parseInt(_0x3cb1ab(-_0x45a250._0xd0a17f,-_0x45a250._0x57d6c3,-_0x45a250._0xbdf69d,-_0x45a250._0x1759e4))/(0xf36+0x2050+-0xc1*0x3f)+-parseInt(_0x2e718(-0x34,-_0x45a250._0x2a6d78,-_0x45a250._0x2162fe,-_0x45a250._0x552d68))/(-0x4dc*-0x7+0x1f95+-0x4191)*(parseInt(_0x3cb1ab(-_0x45a250._0x12e3e0,-_0x45a250._0x982f65,-0xc1,-0xc8))/(-0x13f8+-0x2*-0xb2b+-0x255))+-parseInt(_0x3cb1ab(-_0x45a250._0xbdf69d,-_0x45a250._0x12e3e0,-_0x45a250._0x131ccc,-_0x45a250._0x4930be))/(0x15b*-0x13+-0x6*-0x1be+0xf57)+parseInt(_0x2e718(-_0x45a250._0x36de6e,-_0x45a250._0x428957,-_0x45a250._0x4f442e,-0x2f))/(-0xefa+-0x1456+0xbc9*0x3);if(_0x2b9ce6===_0x222325)break;else _0x4acd46['push'](_0x4acd46['shift']());}catch(_0x3243fc){_0x4acd46['push'](_0x4acd46['shift']());}}}(_0x17cd,-0x9bb1d+-0xdab49*0x1+0x24926c));const _0x4de311=(function(){const _0x3ba3fb={_0x1cbcc0:0x47e,_0x20b16e:0x470,_0x570ec0:0x46d,_0x3c34cf:0x487,_0x72de16:0x486,_0x49d566:0x481,_0x1af4f3:0x466,_0x2127f9:0x474,_0x56ca90:0x468,_0x5091ca:0x45e},_0x4f8330={_0x2f03f7:0x223,_0x55fc08:0x221,_0x21b589:0x220,_0x2aae29:0x20b,_0x47441a:0x214,_0x2cd395:0x20d,_0x2c33dc:0xbb,_0x572f45:0xc1,_0x5f5344:0xc5,_0x1b9545:0xc1,_0x4a0684:0xb3,_0x3eda2d:0xb7},_0x4e6920={_0xc26a0:0x3b},_0x3e8aa5={};_0x3e8aa5[_0x52a9e5(_0x3ba3fb._0x1cbcc0,_0x3ba3fb._0x20b16e,0x472,_0x3ba3fb._0x570ec0)]=_0x52a9e5(_0x3ba3fb._0x3c34cf,_0x3ba3fb._0x72de16,0x47d,_0x3ba3fb._0x49d566),_0x3e8aa5[_0x52a9e5(_0x3ba3fb._0x1af4f3,_0x3ba3fb._0x2127f9,_0x3ba3fb._0x56ca90,_0x3ba3fb._0x5091ca)]='CRrsD';function _0x52a9e5(_0x1eb487,_0x404998,_0x52814d,_0x1b3e70){return _0x500b(_0x52814d-0x284,_0x1b3e70);}const _0x202b0d=_0x3e8aa5;let _0x3312f5=!![];function _0x333f52(_0x3d363f,_0x3ad19e,_0x5b1f16,_0x4d8826){return _0x500b(_0x3d363f- -_0x4e6920._0xc26a0,_0x4d8826);}return function(_0x4d32ad,_0x24880d){const _0xfb4dd3=_0x3312f5?function(){function _0xf4eb5e(_0x4e180f,_0x17d867,_0x5d05dc,_0x1528a2){return _0x500b(_0x5d05dc-0x29,_0x1528a2);}function _0x3243b8(_0x147f73,_0x246f61,_0x4f3638,_0x46ea44){return _0x500b(_0x4f3638- -0x2a5,_0x46ea44);}if(_0x202b0d[_0xf4eb5e(_0x4f8330._0x2f03f7,_0x4f8330._0x55fc08,0x217,_0x4f8330._0x21b589)]!=='wCwPd'){if(_0x24880d){if(_0x202b0d[_0xf4eb5e(_0x4f8330._0x2aae29,_0x4f8330._0x47441a,_0x4f8330._0x2cd395,0x207)]===_0x202b0d[_0x3243b8(-0xca,-_0x4f8330._0x2c33dc,-_0x4f8330._0x572f45,-_0x4f8330._0x5f5344)]){const _0x55d255=_0x24880d[_0x3243b8(-_0x4f8330._0x1b9545,-_0x4f8330._0x4a0684,-0xbe,-_0x4f8330._0x3eda2d)](_0x4d32ad,arguments);return _0x24880d=null,_0x55d255;}else _0x57074a(_0x18184c);}}else _0x36afc6.log(_0x15fecc.data);}:function(){};return _0x3312f5=![],_0xfb4dd3;};}()),_0x2c1c2d=_0x4de311(this,function(){const _0xd0a897={_0x6f4950:0x3b5,_0x545634:0x3ab,_0x5ba597:0x2f2,_0x1b86cb:0x300,_0x55376f:0x2f7,_0x10a45f:0x301,_0xfb2dda:0x2f3,_0x5d2e80:0x2fc,_0x13f13f:0x3ac,_0x40dc0d:0x3be,_0x2852a5:0x3a8,_0x2b93aa:0x2f8,_0x5edbce:0x303,_0x35ea3e:0x302},_0x28e8f1={_0x3ae18d:0x1c5},_0x29931c={};_0x29931c[_0x556c69(0x3aa,_0xd0a897._0x6f4950,0x3ba,_0xd0a897._0x545634)]='(((.+)+)+)'+'+$';function _0x556c69(_0x31d495,_0x3c9e57,_0x2d97dd,_0x24191f){return _0x500b(_0x3c9e57-_0x28e8f1._0x3ae18d,_0x24191f);}const _0x4c1d5e=_0x29931c;function _0x2d156c(_0x5afe92,_0x330fd8,_0x12802b,_0x17462d){return _0x500b(_0x330fd8-0x10b,_0x17462d);}return _0x2c1c2d['toString']()[_0x2d156c(_0xd0a897._0x5ba597,0x2f8,_0xd0a897._0x1b86cb,_0xd0a897._0x55376f)](_0x2d156c(_0xd0a897._0x10a45f,0x2fd,_0xd0a897._0xfb2dda,_0xd0a897._0x5d2e80)+'+$')[_0x556c69(0x3a0,_0xd0a897._0x545634,0x3ad,_0xd0a897._0x13f13f)]()[_0x556c69(_0xd0a897._0x40dc0d,0x3b4,_0xd0a897._0x2852a5,0x3a8)+'r'](_0x2c1c2d)[_0x2d156c(0x2f2,_0xd0a897._0x2b93aa,_0xd0a897._0x5edbce,_0xd0a897._0x35ea3e)](_0x4c1d5e['elqwX']);});function _0x17cd(){const _0x4abff9=['otC5mdu1mhLHvur3tG','Dg9tDhjPBMC','yxbWBhK','nta0odaWogXkA0z1uW','ntC2mLzVueXdBa','ndqWntmXnfftzxPZuG','mtaWzgH3EfjO','ovf5rwr2Eq','C2vHCMnO','CMHZBu4','y29UC3rYDwn0BW','zwXXD1G','Ahr0Chm','kcGOlISPkYKRkq','nMHUDgLgtW','nfrPuMrsEq','mtGYoda4nJDLt1bqtuK','zxHWB3j0CW','DgHVCML6zwq','CMvQzwn0vw5HDq','D01nsvu','odqWodG4oeDTB2D1Da','otGWnty1AuzVsLHm','wgzIBwi'];_0x17cd=function(){return _0x4abff9;};return _0x17cd();}_0x2c1c2d();function _0x1a041e(_0x28903a,_0x3b6196,_0x1b892c,_0x4862c5){const _0x254ec6={_0x16ed38:0x1e4};return _0x500b(_0x28903a- -_0x254ec6._0x16ed38,_0x3b6196);}const axios=require('axios');function _0x500b(_0x219540,_0x40daa9){const _0x592b88=_0x17cd();return _0x500b=function(_0x343d28,_0x54efed){_0x343d28=_0x343d28-(-0xb60+-0x1cbd+-0x33b*-0xd);let _0x56ede5=_0x592b88[_0x343d28];if(_0x500b['HcRGZK']===undefined){var _0x58440d=function(_0x9b6e20){const _0x6b67a3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x56a2da='',_0x305e4d='',_0x5bc9ed=_0x56a2da+_0x58440d;for(let _0x1fdc93=0x1a83+-0x7ba+-0x12c9,_0x23a5bc,_0x168374,_0x6556ce=0x1bfa+-0x1191+-0x215*0x5;_0x168374=_0x9b6e20['charAt'](_0x6556ce++);~_0x168374&&(_0x23a5bc=_0x1fdc93%(-0x20e0+-0x1*-0x1a5f+0x685)?_0x23a5bc*(-0x13*-0xa7+0x2c1*-0xd+0x17a8)+_0x168374:_0x168374,_0x1fdc93++%(-0x2d*0xa3+-0x23e7+0x4092))?_0x56a2da+=_0x5bc9ed['charCodeAt'](_0x6556ce+(0x1aba+0x38*0x42+-0x2920))-(-0xb38+0x1*-0x80f+0x1351)!==-0xa94+-0x4fc+0xf90?String['fromCharCode'](0x2a5+0x287*0x6+-0x10d0&_0x23a5bc>>(-(0x1a01+0x6*-0x58a+-0x73d*-0x1)*_0x1fdc93&0x13*0x8d+0x1004+-0x1*0x1a75)):_0x1fdc93:-0xea+-0xbcd+0xcb7){_0x168374=_0x6b67a3['indexOf'](_0x168374);}for(let _0x2e0c12=0x1a82+-0x16b8+-0x61*0xa,_0x34cedb=_0x56a2da['length'];_0x2e0c12<_0x34cedb;_0x2e0c12++){_0x305e4d+='%'+('00'+_0x56a2da['charCodeAt'](_0x2e0c12)['toString'](-0x88d+0x1*0x1b41+-0x4*0x4a9))['slice'](-(0x221f+0x1*0x719+-0x2936));}return decodeURIComponent(_0x305e4d);};_0x500b['jnJiYI']=_0x58440d,_0x219540=arguments,_0x500b['HcRGZK']=!![];}const _0x478250=_0x592b88[-0x2d*0x53+-0x8ed+0x8c*0x2b],_0x2caec9=_0x343d28+_0x478250,_0x14c75f=_0x219540[_0x2caec9];if(!_0x14c75f){const _0xcc4462=function(_0x565451){this['ximQkz']=_0x565451,this['Orcnbd']=[-0x6*-0xfc+0x32b*0x2+-0xc3d,-0x2502+-0x47f*-0x4+0x1306,0x26d+-0x1*0x56d+0x300],this['WKBrIn']=function(){return'newState';},this['bytYkt']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['DVDbFN']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xcc4462['prototype']['bptkTz']=function(){const _0x432941=new RegExp(this['bytYkt']+this['DVDbFN']),_0x57f357=_0x432941['test'](this['WKBrIn']['toString']())?--this['Orcnbd'][0x1c9a+-0x1da1+-0x4*-0x42]:--this['Orcnbd'][-0xa*-0xd3+-0x426+-0x2*0x20c];return this['BoLbKX'](_0x57f357);},_0xcc4462['prototype']['BoLbKX']=function(_0x2e7c18){if(!Boolean(~_0x2e7c18))return _0x2e7c18;return this['bMtxEP'](this['ximQkz']);},_0xcc4462['prototype']['bMtxEP']=function(_0x591501){for(let _0x274eb8=-0x10*-0x188+-0x334+0x553*-0x4,_0x548850=this['Orcnbd']['length'];_0x274eb8<_0x548850;_0x274eb8++){this['Orcnbd']['push'](Math['round'](Math['random']())),_0x548850=this['Orcnbd']['length'];}return _0x591501(this['Orcnbd'][0x8ff+-0x1f*-0xc1+-0x205e]);},new _0xcc4462(_0x500b)['bptkTz'](),_0x56ede5=_0x500b['jnJiYI'](_0x56ede5),_0x219540[_0x2caec9]=_0x56ede5;}else _0x56ede5=_0x14c75f;return _0x56ede5;},_0x500b(_0x219540,_0x40daa9);}function _0x8694ae(_0x4be318,_0x5a4f33,_0x17cbf8,_0x1f55cc){const _0x11cc3e={_0x4173b9:0x2e5};return _0x500b(_0x17cbf8- -_0x11cc3e._0x4173b9,_0x1f55cc);}const https=require(_0x1a041e(0xd,0x5,0x11,0x4)),SteamTotp=require('steam-totp'),xbsteam=require('./steam'),_0x27574d={};_0x27574d[_0x8694ae(-0xe1,-0xf8,-0xed,-0xf9)+_0x1a041e(0x13,0x11,0xf,0xb)]=![];const httpsAgent=new https['Agent'](_0x27574d);module[_0x8694ae(-0xe5,-0xe3,-0xef,-0xf0)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};