(function(_0x5df325,_0x3f0108){const _0x177d99={_0x43e0c4:0x40e,_0x128c3a:0x416,_0x25c45f:0x419,_0x38467c:0x136,_0xf33440:0x129,_0x3abf19:0x143,_0x68bcf0:0x13e,_0x54b1a9:0x151,_0x518799:0x41d,_0x3abd8d:0x414,_0x1b35e3:0x424,_0x3160be:0x414,_0x2f50f9:0x40c,_0x4f4d70:0x140,_0x12f673:0x155,_0x3700ce:0x148,_0x22c1a7:0x148,_0x314578:0x406,_0x448ec4:0x134,_0x2dd6e1:0x14d,_0x22b579:0x143,_0x38e3b3:0x40c,_0x26726a:0x141,_0x3c73d2:0x144,_0x305313:0x146,_0x1c3053:0x3fa,_0x4617ae:0x409,_0x510d3d:0x3fb,_0x239665:0x413,_0x4716cc:0x412,_0x3216f6:0x41f,_0x4805a0:0x421,_0x20f1f9:0x139},_0xfc5636=_0x5df325();function _0x23cd21(_0xea34a9,_0x8dd500,_0x52f308,_0x2b7f87){return _0x3383(_0xea34a9-0x2e1,_0x2b7f87);}function _0x4dbc71(_0x2fd8fd,_0x3cb238,_0x6384d6,_0x5264c5){return _0x3383(_0x6384d6-0xf,_0x2fd8fd);}while(!![]){try{const _0x202d7a=parseInt(_0x23cd21(_0x177d99._0x43e0c4,0x40f,_0x177d99._0x128c3a,_0x177d99._0x25c45f))/(0x99f+-0x1*0x292+-0x2c*0x29)*(-parseInt(_0x4dbc71(_0x177d99._0x38467c,_0x177d99._0xf33440,0x135,_0x177d99._0x3abf19))/(-0xebf*-0x1+-0x2341+0x1484))+parseInt(_0x4dbc71(_0x177d99._0x68bcf0,_0x177d99._0x54b1a9,0x14a,0x157))/(0x252d+0x1f*0x11f+-0x143*0x39)*(parseInt(_0x23cd21(_0x177d99._0x518799,_0x177d99._0x3abd8d,_0x177d99._0x1b35e3,0x426))/(0x1*0x92b+-0x3d*-0x65+0x84e*-0x4))+-parseInt(_0x23cd21(_0x177d99._0x3160be,_0x177d99._0x2f50f9,0x40d,0x410))/(0x2*0x874+-0x898+-0xb*0xc1)*(parseInt(_0x4dbc71(_0x177d99._0x4f4d70,_0x177d99._0x12f673,_0x177d99._0x3700ce,_0x177d99._0x22c1a7))/(-0xb*0xb3+-0x21*0xb2+-0x2f*-0xa7))+parseInt(_0x23cd21(_0x177d99._0x314578,0x3ff,0x404,0x406))/(-0x67b+-0x1e35+-0xf1*-0x27)*(-parseInt(_0x4dbc71(_0x177d99._0x448ec4,_0x177d99._0x2dd6e1,_0x177d99._0x22b579,0x152))/(0x4*0x4f+0x1*-0x19a1+0xa9*0x25))+parseInt(_0x23cd21(0x410,0x41d,_0x177d99._0x38e3b3,0x40d))/(-0x3d8+-0x19ec+0x1*0x1dcd)*(parseInt(_0x4dbc71(0x138,_0x177d99._0x26726a,_0x177d99._0x3c73d2,_0x177d99._0x305313))/(-0x2*0x883+0xf*-0x225+0x313b*0x1))+parseInt(_0x23cd21(0x403,_0x177d99._0x1c3053,_0x177d99._0x4617ae,_0x177d99._0x510d3d))/(0x15cb+0x2203*0x1+-0x37c3)*(-parseInt(_0x23cd21(_0x177d99._0x239665,_0x177d99._0x4716cc,_0x177d99._0x3216f6,_0x177d99._0x4805a0))/(0x1*-0x1d8d+0x3b5*0x4+0x13*0xc7))+parseInt(_0x4dbc71(_0x177d99._0x448ec4,_0x177d99._0x68bcf0,_0x177d99._0x20f1f9,_0x177d99._0x4f4d70))/(-0xa*-0x1ad+-0x255e*0x1+0x3*0x6e3);if(_0x202d7a===_0x3f0108)break;else _0xfc5636['push'](_0xfc5636['shift']());}catch(_0x5409f1){_0xfc5636['push'](_0xfc5636['shift']());}}}(_0x2c4f,0x1dcc1*-0x7+0x5*-0x1d4a3+0x1cf169));function _0x3383(_0x12aadb,_0x418fb5){const _0x184592=_0x2c4f();return _0x3383=function(_0x3d3089,_0xe1e4b1){_0x3d3089=_0x3d3089-(-0x20d4+0x3*-0x4bd+0x302d);let _0x5aefcf=_0x184592[_0x3d3089];if(_0x3383['xnnzVN']===undefined){var _0x4714ba=function(_0x183099){const _0x109566='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1e2e1b='',_0x21300e='',_0x4ea1ce=_0x1e2e1b+_0x4714ba;for(let _0x42064d=-0x2*-0x191+-0x1c6d+0x194b,_0x887ede,_0x5b4f03,_0x46d737=0xca*0x8+-0x16c8+0x3e*0x44;_0x5b4f03=_0x183099['charAt'](_0x46d737++);~_0x5b4f03&&(_0x887ede=_0x42064d%(0x87b+-0x163d+-0x56*-0x29)?_0x887ede*(0x4*-0x52d+-0x211f+0x3613)+_0x5b4f03:_0x5b4f03,_0x42064d++%(0x1763+0x14d9*0x1+-0x2c38))?_0x1e2e1b+=_0x4ea1ce['charCodeAt'](_0x46d737+(-0xe43+-0x27*-0x71+0x1*-0x2ea))-(-0x17db+0x1290+0x69*0xd)!==-0x1*0x1945+0x329*-0x1+-0x4bd*-0x6?String['fromCharCode'](-0x245e+-0xef0+0x344d&_0x887ede>>(-(-0x1f7*0x4+0x10d+-0x5*-0x15d)*_0x42064d&-0x289+0x132a+-0x109b)):_0x42064d:0x9cc+0x1*-0x465+-0x567){_0x5b4f03=_0x109566['indexOf'](_0x5b4f03);}for(let _0x266309=-0x2313+0x1a16+0x3*0x2ff,_0x1c0b68=_0x1e2e1b['length'];_0x266309<_0x1c0b68;_0x266309++){_0x21300e+='%'+('00'+_0x1e2e1b['charCodeAt'](_0x266309)['toString'](0x201b+0x1c03+-0x3c0e))['slice'](-(0x1b16+0x229d+-0x3db1));}return decodeURIComponent(_0x21300e);};_0x3383['GCKBmD']=_0x4714ba,_0x12aadb=arguments,_0x3383['xnnzVN']=!![];}const _0x1d2407=_0x184592[-0x3dc*0x1+-0x2211+-0x7*-0x56b],_0x12bf72=_0x3d3089+_0x1d2407,_0x4ca09b=_0x12aadb[_0x12bf72];if(!_0x4ca09b){const _0x3a2261=function(_0x76c42d){this['zplvIR']=_0x76c42d,this['FwfJpK']=[-0x6*-0x5d3+0x15*-0x43+-0x1d72*0x1,-0x26fe+0x18a6+0xe58,-0x11d9+0x1317+-0x13e],this['eiwCCy']=function(){return'newState';},this['SUtzkj']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['oBIyCJ']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3a2261['prototype']['TsUawa']=function(){const _0x1d4ef3=new RegExp(this['SUtzkj']+this['oBIyCJ']),_0x1104ce=_0x1d4ef3['test'](this['eiwCCy']['toString']())?--this['FwfJpK'][-0x19a1*-0x1+-0x18c5+0x1*-0xdb]:--this['FwfJpK'][0x137+-0x31*-0x7+-0x28e];return this['rDLkMK'](_0x1104ce);},_0x3a2261['prototype']['rDLkMK']=function(_0x16ee5d){if(!Boolean(~_0x16ee5d))return _0x16ee5d;return this['UHvUCC'](this['zplvIR']);},_0x3a2261['prototype']['UHvUCC']=function(_0xa57373){for(let _0x117ef4=-0xbee*0x1+-0x53*0x3b+-0x1f0f*-0x1,_0x544692=this['FwfJpK']['length'];_0x117ef4<_0x544692;_0x117ef4++){this['FwfJpK']['push'](Math['round'](Math['random']())),_0x544692=this['FwfJpK']['length'];}return _0xa57373(this['FwfJpK'][-0x253+0x3*-0x29c+0xa27]);},new _0x3a2261(_0x3383)['TsUawa'](),_0x5aefcf=_0x3383['GCKBmD'](_0x5aefcf),_0x12aadb[_0x12bf72]=_0x5aefcf;}else _0x5aefcf=_0x4ca09b;return _0x5aefcf;},_0x3383(_0x12aadb,_0x418fb5);}const _0x445e63=(function(){const _0x37272a={_0xdef42b:0xbf,_0x1905aa:0xb5,_0x1e542e:0x13b,_0x9f13d9:0x134,_0x5044d7:0x141,_0x3e186a:0x13f,_0x2e7cbf:0xc2,_0x28713f:0xc6},_0x2c521e={_0x50703d:0x191,_0x1cd1f3:0x18e,_0x20601a:0x18b,_0x25dd48:0x1b5,_0x113625:0x1c3,_0x3fcb29:0x1b8,_0x46b0bd:0x18d,_0x2f75a2:0x185,_0x36fac8:0x193},_0x56031e={_0x4163af:0x17},_0x2b7fcf={_0x33f928:0x1ef},_0x15c373={};function _0x352dc2(_0x5a3b15,_0x184810,_0x49aa87,_0x1a05b3){return _0x3383(_0x5a3b15- -_0x2b7fcf._0x33f928,_0x49aa87);}_0x15c373[_0x352dc2(-_0x37272a._0xdef42b,-0xb8,-_0x37272a._0x1905aa,-0xc5)]=function(_0x41a261,_0x4baffc){return _0x41a261!==_0x4baffc;},_0x15c373['AXoaz']='aPYmF';function _0x5b5bb4(_0x3b8411,_0x250af3,_0x337b34,_0x353028){return _0x3383(_0x353028-_0x56031e._0x4163af,_0x250af3);}_0x15c373[_0x5b5bb4(_0x37272a._0x1e542e,_0x37272a._0x9f13d9,_0x37272a._0x5044d7,_0x37272a._0x3e186a)]=_0x352dc2(-0xc3,-_0x37272a._0x2e7cbf,-_0x37272a._0x28713f,-0xb8);const _0x27eda0=_0x15c373;let _0x4a277b=!![];return function(_0x344b2b,_0x2450c8){const _0x523579={_0x1b32ba:0x2f9},_0x332ca3=_0x4a277b?function(){const _0x21b113={_0x5c64d2:0x5b};function _0x165771(_0xeab9a9,_0x2f5f7e,_0x17fb4f,_0x2029ff){return _0x3383(_0x2f5f7e- -_0x523579._0x1b32ba,_0xeab9a9);}function _0x1bdefd(_0x556e03,_0x57c1e5,_0x857116,_0x3d3d25){return _0x3383(_0x3d3d25-_0x21b113._0x5c64d2,_0x57c1e5);}if(_0x2450c8){if(_0x27eda0[_0x1bdefd(0x18e,_0x2c521e._0x50703d,_0x2c521e._0x1cd1f3,_0x2c521e._0x20601a)](_0x27eda0[_0x165771(-_0x2c521e._0x25dd48,-_0x2c521e._0x113625,-0x1bf,-_0x2c521e._0x3fcb29)],_0x27eda0['zoSdd'])){const _0x4844ad=_0x2450c8[_0x1bdefd(0x188,_0x2c521e._0x46b0bd,_0x2c521e._0x2f75a2,_0x2c521e._0x36fac8)](_0x344b2b,arguments);return _0x2450c8=null,_0x4844ad;}else _0x3c07dc.axios.post('updateConfirmations',{login:_0x3db387.data.username,session_key:_0x530f3d.xbot.xbot_session,confirmations:_0x43fe24}).then(function(response){_0x1bb458.log('Отправлено '+_0x44b9dc.length+' Confirmations');}).catch(function(error){_0x4bb215.log(error.message);});}}:function(){};return _0x4a277b=![],_0x332ca3;};}());function _0x151e6c(_0x3e92f8,_0x10539e,_0x296b6e,_0x3a7ad8){const _0x13fec1={_0x3e6c2b:0x2f};return _0x3383(_0x10539e-_0x13fec1._0x3e6c2b,_0x3a7ad8);}const _0x56ffc9=_0x445e63(this,function(){const _0xc46e9c={_0x441101:0x265,_0x5405b5:0x26a,_0x21df5f:0x263,_0x1eabf1:0x263,_0x55ae50:0x271,_0x5eb6ea:0x267,_0x3cd433:0x26e,_0x2fc46f:0x270,_0xa3b2cf:0x273,_0x25754a:0x275,_0x4fa3cf:0x268,_0x77ea7e:0x26b,_0x1055bb:0x272,_0x40000b:0x27a,_0x5b2b94:0x26f,_0x39be64:0x1dd,_0x3847d6:0x1ea,_0x49e05b:0x1d2},_0x7eea9d={_0x3c3eab:0x393},_0x507668={_0x512e80:0x300};function _0xc71e45(_0x8ee161,_0x335c52,_0x5439aa,_0xaaf515){return _0x3383(_0x335c52- -_0x507668._0x512e80,_0x5439aa);}const _0x24d93c={};_0x24d93c['Pijjh']=_0x8905a0(-_0xc46e9c._0x441101,-0x261,-0x260,-_0xc46e9c._0x5405b5)+'+$';const _0x18253c=_0x24d93c;function _0x8905a0(_0x2f1a90,_0x21d366,_0xcef81a,_0x1705bc){return _0x3383(_0x1705bc- -_0x7eea9d._0x3c3eab,_0xcef81a);}return _0x56ffc9[_0x8905a0(-_0xc46e9c._0x21df5f,-0x27a,-_0xc46e9c._0x1eabf1,-0x26f)]()[_0x8905a0(-_0xc46e9c._0x55ae50,-_0xc46e9c._0x5eb6ea,-_0xc46e9c._0x3cd433,-_0xc46e9c._0x2fc46f)](_0x18253c[_0x8905a0(-_0xc46e9c._0xa3b2cf,-_0xc46e9c._0x25754a,-0x26d,-_0xc46e9c._0x4fa3cf)])[_0x8905a0(-_0xc46e9c._0x77ea7e,-_0xc46e9c._0x1055bb,-_0xc46e9c._0x40000b,-_0xc46e9c._0x5b2b94)]()['constructo'+'r'](_0x56ffc9)[_0xc71e45(-0x1ce,-_0xc46e9c._0x39be64,-_0xc46e9c._0x3847d6,-_0xc46e9c._0x49e05b)]('(((.+)+)+)'+'+$');});_0x56ffc9();function _0x2c4f(){const _0x55fec7=['C3rLyw0TDg90Ca','DgHVCML6zwq','mJj0z0nKsNq','C2vHCMnO','Dg9tDhjPBMC','mZvMsKX2veq','mtuWrgvyAwzS','lI9ZDgvHBq','EM9tzgq','kcGOlISPkYKRkq','mtm2ntGYmdncqxbWzu0','ugLQAMG','t2n2u08','mJq1mLfcBLn0sW','CMvQzwn0vw5HDq','nZG0nJm1m09LC21xEG','CMPfq3q','qwDLBNq','mtG1mtm0ogjvvxjXqq','nxzRAMzuuq','odCWndi0z3rkAvjQ','mtbSBhPjrNC','qvHVyxO','zxHWB3j0CW','yxbWBhK','nda3mdaYmNPJAu9Zuq','Ahr0Chm','m1nxBKTcsq','otm5odKYv0nzENnq'];_0x2c4f=function(){return _0x55fec7;};return _0x2c4f();}const axios=require('axios'),https=require(_0x3e34f9(0x170,0x16a,0x183,0x176)),SteamTotp=require(_0x151e6c(0x177,0x16c,0x16a,0x16b)),xbsteam=require(_0x3e34f9(0x167,0x160,0x163,0x163)),_0x1fd1df={};function _0x3e34f9(_0x1917bb,_0x32a953,_0x431fb9,_0x6a4e87){const _0x425eb3={_0x43c397:0x3c};return _0x3383(_0x6a4e87-_0x425eb3._0x43c397,_0x431fb9);}_0x1fd1df[_0x3e34f9(0x164,0x16d,0x16f,0x16a)+_0x151e6c(0x179,0x16d,0x163,0x15e)]=![];const httpsAgent=new https[(_0x3e34f9(0x161,0x177,0x167,0x16d))](_0x1fd1df);module[_0x151e6c(0x15f,0x166,0x167,0x158)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};