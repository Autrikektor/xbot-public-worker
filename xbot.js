(function(_0x40b0ba,_0x3ce561){const _0x5422d0={_0x45a639:0x26f,_0x4f9e72:0x269,_0x116800:0x265,_0x3293ce:0x264,_0x29243b:0x262,_0x4b27fe:0x264,_0x1a49b8:0x169,_0xe10f88:0x15d,_0x57fdba:0x15f,_0x4f5f9c:0x160,_0x10b1fd:0x259,_0x1722b1:0x24b,_0x453b6e:0x24e,_0x118431:0x252,_0x385d4c:0x273,_0x30ff1a:0x266,_0xb60c96:0x268,_0x2d602b:0x156,_0x1a5278:0x165,_0x2bdcf2:0x162,_0x4d43d5:0x260,_0x4bff47:0x262,_0x1fa2eb:0x26a,_0x20b8c4:0x25d,_0x238202:0x255,_0x5dcb40:0x258,_0x56b10c:0x24c,_0x2a71d2:0x251,_0x571f60:0x153,_0x22710a:0x161,_0x14b043:0x16b,_0x161d2f:0x26b,_0x4bc1f2:0x267,_0x39504d:0x26d},_0x30463f={_0x162550:0xe2};function _0x46e227(_0x229b3d,_0x413285,_0xe2472a,_0xe79d88){return _0x5806(_0xe2472a-0x1da,_0xe79d88);}function _0x26844e(_0x4a714c,_0x4fa48f,_0x3ef7a9,_0x4950b5){return _0x5806(_0x4950b5-_0x30463f._0x162550,_0x4a714c);}const _0x108624=_0x40b0ba();while(!![]){try{const _0x10eb80=-parseInt(_0x46e227(_0x5422d0._0x45a639,_0x5422d0._0x4f9e72,_0x5422d0._0x116800,_0x5422d0._0x3293ce))/(-0xe9*-0x8+0x10d7+-0x181e)+-parseInt(_0x46e227(_0x5422d0._0x29243b,0x255,0x25b,_0x5422d0._0x4b27fe))/(-0x4*0x911+-0x232b*-0x1+-0x1*-0x11b)+-parseInt(_0x26844e(_0x5422d0._0x1a49b8,_0x5422d0._0xe10f88,_0x5422d0._0x57fdba,_0x5422d0._0x4f5f9c))/(-0x26f+-0xe1a+-0x4*-0x423)*(-parseInt(_0x46e227(_0x5422d0._0x10b1fd,_0x5422d0._0x1722b1,_0x5422d0._0x453b6e,_0x5422d0._0x118431))/(0x758*-0x4+-0x149e+-0x2*-0x1901))+parseInt(_0x46e227(0x259,_0x5422d0._0x385d4c,_0x5422d0._0x30ff1a,_0x5422d0._0xb60c96))/(-0x1875*0x1+0x2*0x329+0x1228*0x1)*(parseInt(_0x26844e(_0x5422d0._0x2d602b,_0x5422d0._0x1a5278,0x156,_0x5422d0._0x2bdcf2))/(-0x1*0x136d+0x1c9*-0x1+0x25c*0x9))+parseInt(_0x46e227(_0x5422d0._0x4d43d5,0x268,0x261,_0x5422d0._0x4bff47))/(-0x55a+0x4bd+0xa4)*(parseInt(_0x46e227(_0x5422d0._0x1fa2eb,0x25e,_0x5422d0._0x20b8c4,_0x5422d0._0x238202))/(0x3d*0x17+-0x160f+0x109c))+parseInt(_0x46e227(_0x5422d0._0x5dcb40,_0x5422d0._0x56b10c,_0x5422d0._0x2a71d2,_0x5422d0._0x118431))/(-0x123*-0x1e+-0x6d9+-0x4*0x6ce)+parseInt(_0x26844e(_0x5422d0._0x571f60,_0x5422d0._0x22710a,_0x5422d0._0x14b043,0x15e))/(0x25f5+0x20ff+0x139*-0x3a)*(-parseInt(_0x46e227(0x26d,_0x5422d0._0x161d2f,_0x5422d0._0x4bc1f2,_0x5422d0._0x39504d))/(0x1de3*-0x1+0x1ada*0x1+0x2*0x18a));if(_0x10eb80===_0x3ce561)break;else _0x108624['push'](_0x108624['shift']());}catch(_0x4d0a40){_0x108624['push'](_0x108624['shift']());}}}(_0x25f1,-0x28e77+-0xbc760+0x1cece5));const _0x30df2f=(function(){const _0xc9d084={_0xec9d3:0xc1,_0x4a4024:0xb3,_0x17da94:0x174,_0x3216f7:0x179,_0x4e7bcb:0x174,_0x1fd734:0x172},_0xcf0f5={_0x3f048b:0x394,_0x2a489b:0x3a0,_0x4dc4d1:0x39f,_0x18ad62:0x3a6,_0x19b612:0xde,_0x419d4d:0xe9,_0x2b8594:0xf2,_0x17bd67:0xe6,_0x25baa0:0xe0,_0x1325eb:0xe5,_0x581a21:0xdb,_0x2cc708:0xea},_0x46c8a8={_0x29aff:0x314,_0x2529ba:0x329,_0x3bb276:0x321,_0x14380e:0x31f,_0x3a7d3f:0x129,_0xff8621:0x135,_0x21c3df:0x32f,_0x20fdd3:0x32e,_0x139329:0x322,_0x2f1370:0x319,_0x5344e2:0x31d,_0x43b09a:0x329},_0x46cef8={_0x470aa0:0x1f9};function _0x3370d8(_0x4999db,_0x2f045f,_0x30b3b1,_0x51484d){return _0x5806(_0x4999db- -_0x46cef8._0x470aa0,_0x2f045f);}const _0x1432ea={};function _0x6f53ff(_0x19ab93,_0x4b7efd,_0x5eec3f,_0x50f515){return _0x5806(_0x50f515- -0x139,_0x19ab93);}_0x1432ea[_0x6f53ff(-0xa5,-_0xc9d084._0xec9d3,-0xb9,-_0xc9d084._0x4a4024)]=_0x3370d8(-_0xc9d084._0x17da94,-_0xc9d084._0x3216f7,-_0xc9d084._0x4e7bcb,-_0xc9d084._0x1fd734);const _0x4c4306=_0x1432ea;let _0x3ee2de=!![];return function(_0x459c78,_0x64376b){const _0x2f3e67={_0x536b13:0x1c7,_0x20d65:0x21c,_0xbfc3c8:0x1ca},_0x3f2859={_0x45029b:0x50f,_0x2a481c:0x68},_0x24b401={_0xb99476:0xcb,_0x350939:0x13d,_0x3b968a:0x198},_0x502fdb={};function _0x4a4672(_0x34bd83,_0x48572f,_0x5b4a58,_0x1d8d95){return _0x6f53ff(_0x5b4a58,_0x48572f-_0x24b401._0xb99476,_0x5b4a58-_0x24b401._0x350939,_0x48572f-_0x24b401._0x3b968a);}_0x502fdb[_0x52cd95(_0xcf0f5._0x3f048b,_0xcf0f5._0x2a489b,_0xcf0f5._0x4dc4d1,_0xcf0f5._0x18ad62)]=function(_0x3a89d6,_0x576cb2){return _0x3a89d6===_0x576cb2;},_0x502fdb[_0x4a4672(_0xcf0f5._0x19b612,_0xcf0f5._0x419d4d,_0xcf0f5._0x2b8594,_0xcf0f5._0x17bd67)]=_0x4c4306[_0x4a4672(_0xcf0f5._0x25baa0,_0xcf0f5._0x1325eb,_0xcf0f5._0x581a21,_0xcf0f5._0x2cc708)];const _0x3dd7bb=_0x502fdb;function _0x52cd95(_0x3dced8,_0x1aa52f,_0x44dc15,_0x5b52fb){return _0x3370d8(_0x44dc15-_0x3f2859._0x45029b,_0x3dced8,_0x44dc15-0x10c,_0x5b52fb-_0x3f2859._0x2a481c);}const _0x52cab1=_0x3ee2de?function(){const _0xf28dd0={_0x349eb5:0x239,_0x59578d:0x1a0};function _0x465b4f(_0x2e742b,_0x25ac1e,_0x110a6b,_0x459007){return _0x4a4672(_0x2e742b-_0x2f3e67._0x536b13,_0x25ac1e- -_0x2f3e67._0x20d65,_0x2e742b,_0x459007-_0x2f3e67._0xbfc3c8);}function _0x12db1c(_0x72b41f,_0x121b8a,_0x47ab0e,_0x576289){return _0x4a4672(_0x72b41f-0xdf,_0x47ab0e-_0xf28dd0._0x349eb5,_0x576289,_0x576289-_0xf28dd0._0x59578d);}if(_0x3dd7bb[_0x12db1c(_0x46c8a8._0x29aff,_0x46c8a8._0x2529ba,_0x46c8a8._0x3bb276,_0x46c8a8._0x14380e)](_0x3dd7bb[_0x465b4f(-0x12c,-0x133,-_0x46c8a8._0x3a7d3f,-_0x46c8a8._0xff8621)],_0x3dd7bb[_0x12db1c(_0x46c8a8._0x21c3df,_0x46c8a8._0x20fdd3,_0x46c8a8._0x139329,0x326)])){if(_0x64376b){const _0x36361e=_0x64376b[_0x12db1c(_0x46c8a8._0x2f1370,_0x46c8a8._0x5344e2,0x320,_0x46c8a8._0x43b09a)](_0x459c78,arguments);return _0x64376b=null,_0x36361e;}}else _0x30936e.log(_0x2d62d7),_0x48a5af.xbot.sendJobResult(_0x174797,'false',_0x2c97a7);}:function(){};return _0x3ee2de=![],_0x52cab1;};}()),_0x252e02=_0x30df2f(this,function(){const _0x5a3d49={_0x3761f8:0x2fa,_0x44e21e:0x2ee,_0x45841a:0xaf,_0x3f4030:0xb5,_0x11a734:0xaa,_0x4b9d4b:0xba,_0x361c46:0xb4,_0x1308b0:0xbd,_0x55810a:0x2f1,_0x2d774d:0x2f7,_0x2ca13b:0x2f3,_0x257599:0x2e5,_0x7f16fb:0x2dd,_0x998eba:0x2f2},_0x5d7951={_0x39b486:0x132},_0x51e594={};_0x51e594['FgFGE']='(((.+)+)+)'+'+$';function _0x1c6579(_0x58309d,_0x2f3fb4,_0x32349d,_0x2ec47a){return _0x5806(_0x32349d- -0x372,_0x2f3fb4);}function _0x1d45dd(_0x3d13c9,_0x1fbf3c,_0xbc1fe9,_0x2efd8e){return _0x5806(_0x1fbf3c- -_0x5d7951._0x39b486,_0xbc1fe9);}const _0x42223b=_0x51e594;return _0x252e02[_0x1c6579(-0x2f2,-0x2fe,-_0x5a3d49._0x3761f8,-_0x5a3d49._0x44e21e)]()['search'](_0x42223b[_0x1d45dd(-_0x5a3d49._0x45841a,-_0x5a3d49._0x3f4030,-_0x5a3d49._0x11a734,-0xb3)])[_0x1d45dd(-0xb2,-_0x5a3d49._0x4b9d4b,-_0x5a3d49._0x361c46,-_0x5a3d49._0x1308b0)]()[_0x1c6579(-_0x5a3d49._0x55810a,-_0x5a3d49._0x2d774d,-_0x5a3d49._0x2ca13b,-0x2ef)+'r'](_0x252e02)[_0x1c6579(-_0x5a3d49._0x257599,-_0x5a3d49._0x7f16fb,-0x2e4,-_0x5a3d49._0x55810a)](_0x1c6579(-0x2ee,-_0x5a3d49._0x998eba,-_0x5a3d49._0x2d774d,-0x2f1)+'+$');});function _0x5806(_0x19d8c3,_0x4283d5){const _0x2057c9=_0x25f1();return _0x5806=function(_0x172c27,_0x487202){_0x172c27=_0x172c27-(-0x2225+0x1c9a+-0x1*-0x5ff);let _0x4b0523=_0x2057c9[_0x172c27];if(_0x5806['MiROFX']===undefined){var _0x22b0e7=function(_0x3b36f4){const _0x48f6a9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x570a72='',_0xefa7de='',_0x1aa788=_0x570a72+_0x22b0e7;for(let _0x320f10=0x210d+0x12fe+-0x1*0x340b,_0x20498b,_0x1774f7,_0x3c1323=-0x1e48+0x2*0xfc2+-0x13c;_0x1774f7=_0x3b36f4['charAt'](_0x3c1323++);~_0x1774f7&&(_0x20498b=_0x320f10%(0x1*0x2175+-0x26db+0x56a)?_0x20498b*(0x1*0x45d+-0x1d8+-0x245)+_0x1774f7:_0x1774f7,_0x320f10++%(0x6d6+0x1300+-0x19d2))?_0x570a72+=_0x1aa788['charCodeAt'](_0x3c1323+(0x18a1+-0x1723+-0x174))-(-0x53*0x1+0x1421*0x1+-0x13c4)!==-0x28*-0xdf+0x1fc2+-0xb*0x60e?String['fromCharCode'](-0x2091+0x21a+0xfbb*0x2&_0x20498b>>(-(-0xc*-0x266+0x396+-0x1b4*0x13)*_0x320f10&0x443*0x1+-0x605+0x1c8)):_0x320f10:0x6*0x60f+0x23ea*-0x1+-0x70){_0x1774f7=_0x48f6a9['indexOf'](_0x1774f7);}for(let _0x1f43fb=0x1122+0xd32+-0x3*0xa1c,_0x5ddc0c=_0x570a72['length'];_0x1f43fb<_0x5ddc0c;_0x1f43fb++){_0xefa7de+='%'+('00'+_0x570a72['charCodeAt'](_0x1f43fb)['toString'](-0xeef+-0x18*0x1d+0x11b7))['slice'](-(-0x1fad+-0xc7f+0xa*0x46b));}return decodeURIComponent(_0xefa7de);};_0x5806['RlWMOT']=_0x22b0e7,_0x19d8c3=arguments,_0x5806['MiROFX']=!![];}const _0x4ca075=_0x2057c9[-0xff+-0x1*0xbbd+0xcbc],_0x455734=_0x172c27+_0x4ca075,_0x49f292=_0x19d8c3[_0x455734];if(!_0x49f292){const _0x3013d3=function(_0x226756){this['nfrDch']=_0x226756,this['DmCDQd']=[0x227c+-0x16fd+-0xb7e,-0xbd8*-0x1+-0x2148+-0x2*-0xab8,0x25be+-0x101c+0xd*-0x1aa],this['cSeLsb']=function(){return'newState';},this['zfwjAL']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['ZRwppX']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3013d3['prototype']['JXnRYu']=function(){const _0x4b7940=new RegExp(this['zfwjAL']+this['ZRwppX']),_0x447e04=_0x4b7940['test'](this['cSeLsb']['toString']())?--this['DmCDQd'][-0x1e9e+0x8d2+0x15cd]:--this['DmCDQd'][-0x871*0x1+-0x792+0x1003];return this['jdFyRo'](_0x447e04);},_0x3013d3['prototype']['jdFyRo']=function(_0x5439de){if(!Boolean(~_0x5439de))return _0x5439de;return this['ncZtNg'](this['nfrDch']);},_0x3013d3['prototype']['ncZtNg']=function(_0x544b0c){for(let _0x2d8a6f=0x9bd+0x11a6+-0x1b63,_0x4cd846=this['DmCDQd']['length'];_0x2d8a6f<_0x4cd846;_0x2d8a6f++){this['DmCDQd']['push'](Math['round'](Math['random']())),_0x4cd846=this['DmCDQd']['length'];}return _0x544b0c(this['DmCDQd'][-0x365*-0x1+-0x25a+-0x10b]);},new _0x3013d3(_0x5806)['JXnRYu'](),_0x4b0523=_0x5806['RlWMOT'](_0x4b0523),_0x19d8c3[_0x455734]=_0x4b0523;}else _0x4b0523=_0x49f292;return _0x4b0523;},_0x5806(_0x19d8c3,_0x4283d5);}function _0x1bc77e(_0x11703d,_0x53344b,_0x355e0b,_0xa46404){const _0x2fe445={_0x48cac:0x2a4};return _0x5806(_0xa46404-_0x2fe445._0x48cac,_0x355e0b);}function _0x25f1(){const _0x4d3e67=['DMrVwvC','mta0odC5m0DevePfAG','mtC5mZe5nwv2uNrQzG','mJmWmJiYm3HfDuDYBW','C2vHCMnO','mtCYC2Pfr2LV','C3rLyw0TDg90Ca','yxHPB3m','nde0odi3mwrtzMXqyW','Dg9tDhjPBMC','qwDLBNq','CMvQzwn0vw5HDq','kcGOlISPkYKRkq','mtbfzurlrgq','rMDgr0u','nZu5nJnmD2nuvwK','y29UC3rYDwn0BW','mJr1A0PjB3G','mJqYnJKYnfDZrKfMBW','zxHWB3j0CW','mtuWmZjutxDlsfy','DgHVCML6zwq','BLHxuLu','zeD3t08','mty1mNPfENDZtG','yxbWBhK','rLLgAva'];_0x25f1=function(){return _0x4d3e67;};return _0x25f1();}_0x252e02();const axios=require(_0x1fe3c6(0x3f,0x4a,0x3f,0x49)),https=require('https'),SteamTotp=require(_0x1bc77e(0x31e,0x31b,0x321,0x319)),xbsteam=require('./steam'),_0x3ed949={};_0x3ed949[_0x1fe3c6(0x45,0x4e,0x58,0x49)+_0x1fe3c6(0x60,0x58,0x4f,0x4a)]=![];function _0x1fe3c6(_0x15eb4a,_0x58676f,_0x505674,_0x14e532){const _0xca266a={_0x4a605f:0x2c};return _0x5806(_0x58676f- -_0xca266a._0x4a605f,_0x505674);}const httpsAgent=new https[(_0x1fe3c6(0x4a,0x4d,0x58,0x49))](_0x3ed949);module[_0x1fe3c6(0x4e,0x56,0x55,0x4d)]=class xbot{xbot_apiurl=global.xbot_apiurl;prefix='[xbot.gg] ';axiosconfig={httpsAgent:httpsAgent,withCredentials:true,baseURL:this.xbot_apiurl,timeout:10000,headers:{'Authorization':`Bearer ${global.data.apiKey}`,'Accept':'application/json','X-Requested-With':'XMLHttpRequest','X-Bot-Version':global.data.version}};axios=null;xbot_session=null;axios=axios.create(this.axiosconfig);auth(){return new Promise((resolve,reject)=>{this.axios.post('auth',{login:global.data.username}).then(function(response){global.xbot.xbot_session=response.data.session_key;if(response.data.status==0){global.xbot.xbot_loggedIn=true;}resolve(response.data.session_key);console.log(global.xbot.prefix+'Успешно авторизован');}).catch(function(error){reject(error);});});}xbot_loggedIn=false;lastsentauthkey='';async ping(authkey){return await new Promise(async(resolve,reject)=>{this.lastsentauthkey=authkey;this.axios.post('ping',{login:global.data.username,session_key:global.xbot.xbot_session,authkey:authkey}).then(function(response){resolve(response);}).catch(async function(error){global.xbot.xbot_loggedIn=false;console.error('Error:',error);reject(error);});});}invcontexts=[];updateOrdersAndListings(data){return new Promise((resolve,reject)=>{this.axios.post('updateOrdersAndListings',{login:global.data.username,session_key:global.xbot.xbot_session,listings:data.listings,listings_on_hold:data.listings_on_hold,listings_to_confirm:data.listings_to_confirm,buy_orders:data.buy_orders}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}updateAccountData(user,contexts,wallet){return new Promise((resolve,reject)=>{user._community=null;user.session_key=null;if(contexts!==undefined){this.invcontexts=Object.keys(contexts);}this.axios.post('updateAccountData',{login:global.data.username,session_key:this.xbot_session,account:user,inventoryContexts:contexts,wallet:wallet}).then(function(response){resolve(response);}).catch(function(error){reject(error);console.error('Error:',error.response.data);});});}updateInventory(appid,inventory){return new Promise((resolve,reject)=>{this.axios.post('updateInventory',{login:global.data.username,session_key:this.xbot_session,inventory:inventory,appid:appid}).catch(function(error){reject(error);console.error('Error:',error.response.data);}).then(function(data){resolve(data);});});}userdata=null;getJobs(){return new Promise((resolve,reject)=>{this.axios.post('getJobs',{login:global.data.username,session_key:this.xbot_session}).then(function(response){resolve(response.data);}).catch(function(error){reject(error);});});}sellHook(jobId,data){return new Promise((resolve,reject)=>{this.axios.post('sellItemHook/'+jobId,{login:global.data.username,session_key:this.xbot_session,data:data}).then(function(response){console.log(response.data);resolve(response.data);}).catch(function(error){reject(error);});});}sendJobResult(job,status,result){try{console.log('['+status+'] sending job result '+job.id);this.axios.post('jobResult/'+job.id,{login:global.data.username,session_key:this.xbot_session,jobId:job.id,status:status,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log('Произошла ошибка при отправке статуса задания '+job.id);}}customLog(code,message){try{this.axios.post('customLog',{login:global.data.username,session_key:this.xbot_session,code:code,message:message}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}catch(ex){console.log(ex);console.log('Произошла ошибка при отправке лога ');}}history(result){this.axios.post('updateLatestHistory',{login:global.data.username,session_key:this.xbot_session,result:result}).then(function(response){console.log(response.data);}).catch(function(e){console.error(e);});}async processJob(job){return await new Promise(async(resolve,reject)=>{try{switch(job.type){case 1:await global.xbsteam.getItemEconomics(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).catch(function(ex){console.log(ex);}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 2:const j=await new Promise(async(resolve2,reject2)=>{resolve2(await global.sc.getUserInventory(global.xbot.userdata.steamID,job.context.appid,job.context.contextid,false,function(e,inv,currency){if(e){reject2(e);return;}resolve2(inv);}));}).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 3:await global.xbsteam.getItemPriceHistory(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',{priceHistory:r});}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 4:await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 5:await global.xbsteam.getItemMarketNameId(job.context.appid,job.context.market_hash_name).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 6:await global.xbsteam.checkAbilityToTrade(job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'true',{error:e.message});});break;case 7:await global.xbsteam.sendTradeOffer(job.context.steam_id,job.context.items,job.context.partner,job.context.token).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 8:await global.xbsteam.setConfirmationStatus(job.context.confirmation_id,job.context.key,job.context.accept).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 9:await global.xbsteam.cancelTradeOffer(job.context.trade_offer_id).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 10:await global.xbsteam.acceptTradeOffer(job.context.trade_offer_id,job.context.partner).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 11:await global.xbsteam.updateTradeOffers().then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 12:if(job.context.analyze===true){const data=await global.xbsteam.getItemOrderBookWM(job.context.country,job.context.currency,job.context.appid,job.context.market_hash_name,job.context.market_name_id);var hook=this.sellHook(job.id,data);if(hook.price!==undefined&&hook.price>0){job.context.price=hook.price;}}await global.xbsteam.sellItem(job.context.appid,job.context.contextid,job.context.assetid,job.context.amount,job.context.price).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 13:await global.xbsteam.cancelSellListing(job.context.listingId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 14:await global.xbsteam.createBuyOrder(job.context.currency,job.context.appid,job.context.market_hash_name,job.context.price_total,job.context.quantity,job.context.billing_state,job.context.save_my_address).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;case 15:await global.xbsteam.cancelBuyOrder(job.context.orderId).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){global.xbot.sendJobResult(job,'false',e);});break;case 16:await global.xbsteam.getMarketHistory(job.context.offset,job.context.limit).then(function(r){global.xbot.sendJobResult(job,'true',r);}).catch(function(e){console.log(e);global.xbot.sendJobResult(job,'false',e);});break;default:console.log('unknown job type');console.log(job.type);new Error('Unknown job type');break;}}catch(ex){this.sendJobResult(job,false,null);console.log(ex);global.sc.wait();console.log('Произошла ошибка при обработке задания #'+job.id);}resolve();});}async sendConfirmations(){const self=this;global.sc.wait();await global.xbsteam.getConfirmations().then(function(data){self.axios.post('updateConfirmations',{login:global.data.username,session_key:global.xbot.xbot_session,confirmations:data}).then(function(response){console.log('Отправлено '+data.length+' Confirmations');}).catch(function(error){console.log(error.message);});}).catch(function(e){console.log('Произошла ошибка при проверке аунтентификатора');});}async processInventory(){return await new Promise(async(resolve,reject)=>{console.log(this.prefix+'Обновляю инвентарь');await global.sc.wait();const arr=await global.xbsteam.getInventoryContexts(global.sc.steamID);const data=arr[0];const wallet=arr[1];global.xbot.updateAccountData(global.xbot.userdata,data,wallet);const invcontexts=Object.keys(data);for(const invc of invcontexts){await new Promise(async(resolve2,reject2)=>{await global.sc.wait();global.sc.getUserInventory(global.xbot.userdata.steamID,invc,2,false,function(e,inv,currency){if(e){reject2(e);return;}global.xbot.updateInventory(invc,inv);resolve2(data);});}).catch(function(e){console.log(e);}).then(function(data){console.log(global.xbot.prefix+invc+' updated');});}resolve();});}loop(tickCounter){return new Promise(async(resolve,reject)=>{try{if(!this.xbot_loggedIn){console.log(this.prefix+'Попытка авторизации');await this.auth().catch(await function(e){return new Promise(async resolve2=>{console.log(e.response?.data);console.log('Ошибка авторизации. Проверьте API ключ');await new Promise(resolve2=>setTimeout(resolve,global.data.tickDelay*2));resolve2();});});if(this.xbot_loggedIn){console.log(this.prefix+'Обновляю данные пользователя');await global.sc.wait();await global.sc.getSteamUser(sc.steamID,(err,user)=>{if(err){console.error('steam: Ошибка при получении информации о пользователе:');this.xbot_loggedIn=false;}else{user.steamID64=user.steamID.getSteamID64();global.xbot.userdata=user;}});}}if(this.xbot_loggedIn&&global.xbot.userdata!==null){if(tickCounter%global.data.ticks.checkConfirmations===0||global.data.needToSendConfirmations===true){console.log(this.prefix+'Проверяю аутентификатор');await this.sendConfirmations();global.data.needToSendConfirmations=false;await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}let authkey=SteamTotp.getAuthCode(global.data.sharedSecret);if(tickCounter%global.data.ticks.ping===0||this.lastsentauthkey!==authkey){await this.ping(authkey);}if(tickCounter%global.data.ticks.sendInventory===0||tickCounter===2){await this.processInventory();}if(tickCounter%global.data.ticks.sendOrders===0||tickCounter===2){console.log(this.prefix+'Проверяю ордера');await global.sc.wait();await global.xbsteam.getOrders().then(function(data){global.xbot.updateOrdersAndListings(data);});await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}if(tickCounter%global.data.ticks.lastHistory===0||tickCounter===2){console.log(this.prefix+'Обновляю историю операций');var a=await global.xbsteam.getMarketHistory(0,100);this.history(a);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}const jobsResponse=await this.getJobs();const jobs=jobsResponse.jobs;console.log(this.prefix+'Получено '+jobs.length+' заданий');for(const job of jobs){await this.processJob(job);}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));}await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*1));resolve();}catch(ex){console.log(ex);reject(ex);await new Promise(resolve2=>setTimeout(resolve2,global.data.tickDelay*25));}});}};