function _0xd6f2(){const _0x529d95=['mta1odmZmdDQq1n2zNO','Dg9tDhjPBMC','mtq5ntqWCuXbBvH5','vLLes0y','y29UC3rYDwn0BW','ntCXmgLeu1rwEq','BMnOExK','C3rLyw1JB21TDq','odmXmtCXmeT3A1rwra','BML0Eq','mZy2odr1D0H2AMK','mZC5zw10yKvs','C2vHCMnO','yxbWBhK','uuHUDvq','nda4ndHxr2r1rKi','kcGOlISPkYKRkq','nJLoALj6vNK','mZi5y2zzD2Pd','C3rLyw1ZDg9Yzq','mtu1CMLSvuvi','qwf0v2C','Bw9Tzw50','C3rLyw0TDg90Ca','nZi5mJu3mvDItNP6Eq'];_0xd6f2=function(){return _0x529d95;};return _0xd6f2();}(function(_0x5be44f,_0x5e0590){const _0x21cefd={_0x6f0006:0x18f,_0x82ade5:0x19b,_0x28a274:0x195,_0x3fbcf2:0x18a,_0x1947c2:0x17e,_0x5e5b3f:0x1ac,_0x5b6c7b:0x1b3,_0x5785e8:0x1bb,_0x2be176:0x1be,_0x207dcd:0x1a4,_0xf03b62:0x1b0,_0x2be0db:0x1a6,_0x3133c9:0x1bb,_0x55eef3:0x1aa,_0x3ef7a3:0x19e,_0xf93fe2:0x1b2,_0x6dcc6:0x1af,_0x4caef2:0x1b5,_0x4288d3:0x1bf,_0x2ba07b:0x1ba,_0x38be0e:0x184,_0x4ec256:0x18f,_0x3699e8:0x17d,_0x36b5cf:0x179,_0x356266:0x1a0,_0x216014:0x1a3,_0x4f4f84:0x1a7,_0x108cde:0x196,_0x5bf606:0x19f,_0x493c7b:0x1a5},_0x3571cf={_0x3ae070:0x225};function _0x225b88(_0x2dd8bc,_0x379a22,_0x2807b6,_0x2596db){return _0x2923(_0x379a22- -_0x3571cf._0x3ae070,_0x2807b6);}const _0x490ddb=_0x5be44f();function _0x20c9cb(_0x4a548a,_0x13b89b,_0x4093ab,_0x395ec0){return _0x2923(_0x4a548a-0x10a,_0x4093ab);}while(!![]){try{const _0x1d8dde=parseInt(_0x20c9cb(_0x21cefd._0x6f0006,_0x21cefd._0x82ade5,0x18c,_0x21cefd._0x28a274))/(0x1645*-0x1+0x156+-0x14*-0x10c)*(-parseInt(_0x20c9cb(0x189,_0x21cefd._0x6f0006,_0x21cefd._0x3fbcf2,_0x21cefd._0x1947c2))/(0x165c+0x1*0xb4e+-0x21a8))+-parseInt(_0x225b88(-_0x21cefd._0x5e5b3f,-_0x21cefd._0x5b6c7b,-_0x21cefd._0x5785e8,-_0x21cefd._0x2be176))/(-0x17f3+-0x19c3+-0x3*-0x1093)*(-parseInt(_0x225b88(-0x1a9,-0x1a9,-_0x21cefd._0x207dcd,-_0x21cefd._0xf03b62))/(-0x17e0+0xc9a*0x3+-0xdea))+-parseInt(_0x225b88(-_0x21cefd._0x2be0db,-_0x21cefd._0xf03b62,-0x1a5,-_0x21cefd._0x3133c9))/(-0x1*0x45+0x2362+-0x4*0x8c6)*(-parseInt(_0x225b88(-_0x21cefd._0x55eef3,-0x1a1,-0x198,-_0x21cefd._0x3ef7a3))/(-0x1e7+-0x1*-0x67+0x186))+parseInt(_0x225b88(-0x1af,-_0x21cefd._0xf93fe2,-_0x21cefd._0x6dcc6,-0x1a9))/(0x230a+-0x129e*-0x1+-0x1*0x35a1)*(-parseInt(_0x225b88(-_0x21cefd._0x5b6c7b,-_0x21cefd._0x4caef2,-_0x21cefd._0x4288d3,-_0x21cefd._0x2ba07b))/(0x2e*0x91+-0x1598*0x1+-0x46e))+parseInt(_0x20c9cb(_0x21cefd._0x38be0e,_0x21cefd._0x4ec256,_0x21cefd._0x3699e8,_0x21cefd._0x36b5cf))/(0x1363+0x19b5+0xf*-0x301)+-parseInt(_0x225b88(-_0x21cefd._0x356266,-_0x21cefd._0x216014,-_0x21cefd._0x4f4f84,-_0x21cefd._0x108cde))/(-0x2f+0x1*-0xa39+0xa72)+parseInt(_0x225b88(-_0x21cefd._0x5bf606,-0x1ac,-_0x21cefd._0x6dcc6,-_0x21cefd._0x493c7b))/(-0x1*0x1ad7+0x1*-0xff3+-0x55*-0x81);if(_0x1d8dde===_0x5e0590)break;else _0x490ddb['push'](_0x490ddb['shift']());}catch(_0x46048a){_0x490ddb['push'](_0x490ddb['shift']());}}}(_0xd6f2,0x133f56*0x1+0x46734+-0x161af*0x9));const _0x559e72=(function(){const _0x1db4ff={_0x558f73:0x38d,_0x1e00e2:0x393},_0x16ef1f={_0x29bc53:0x384,_0x315db4:0x38c,_0x2ee1af:0x289,_0x1850b9:0x292,_0xec3588:0x289,_0x209111:0x283,_0x4803c6:0x289},_0x4b5336={_0x1eaeba:0xdc,_0x2dcc0f:0x1a1},_0x11cbc1={_0x3f141d:0x605},_0x595b32={_0x3ea30a:0x30d},_0x23fa89={_0x4bb3de:0x343},_0x500094={};_0x500094[_0x10f747(_0x1db4ff._0x558f73,_0x1db4ff._0x1e00e2,0x388,0x382)]=function(_0x2dd709,_0x272698){return _0x2dd709!==_0x272698;},_0x500094['QHnuT']=_0x10f747(0x383,0x380,0x38f,0x38d);function _0xf185b9(_0x415697,_0x4a66a2,_0x1f0682,_0x1b7fed){return _0x2923(_0x415697- -_0x23fa89._0x4bb3de,_0x1b7fed);}function _0x10f747(_0x259885,_0x5bcb67,_0x1e99de,_0x4c941b){return _0x2923(_0x259885-_0x595b32._0x3ea30a,_0x5bcb67);}const _0xfc7446=_0x500094;let _0xf5e22=!![];return function(_0x37a391,_0xec515f){const _0x26d881={_0x361f6d:0x185,_0x4b8e78:0x17d},_0x185efc={_0x115737:0x4f1,_0x57bfb7:0x38};function _0x4f99e5(_0x21ecce,_0x9a3afe,_0x1e7671,_0x40def3){return _0x10f747(_0x9a3afe- -_0x11cbc1._0x3f141d,_0x21ecce,_0x1e7671-0x14d,_0x40def3-0xb5);}function _0x3e93ee(_0x1cbd03,_0x3f752a,_0x3a744c,_0x433312){return _0xf185b9(_0x3f752a-0x64a,_0x3f752a-_0x4b5336._0x1eaeba,_0x3a744c-_0x4b5336._0x2dcc0f,_0x433312);}if(_0xfc7446[_0x3e93ee(_0x16ef1f._0x29bc53,0x387,0x37e,_0x16ef1f._0x315db4)](_0xfc7446[_0x4f99e5(-0x284,-_0x16ef1f._0x2ee1af,-_0x16ef1f._0x1850b9,-_0x16ef1f._0xec3588)],_0xfc7446[_0x4f99e5(-0x28a,-0x289,-_0x16ef1f._0x209111,-_0x16ef1f._0x4803c6)]))_0x1135a4.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';else{const _0x3fae63=_0xf5e22?function(){function _0x531ec4(_0x2cef3f,_0x14af4e,_0x56d94d,_0x4158ca){return _0x3e93ee(_0x2cef3f-0x1dc,_0x56d94d- -_0x185efc._0x115737,_0x56d94d-_0x185efc._0x57bfb7,_0x4158ca);}if(_0xec515f){const _0x2d7a9c=_0xec515f[_0x531ec4(-_0x26d881._0x361f6d,-_0x26d881._0x4b8e78,-0x17c,-0x184)](_0x37a391,arguments);return _0xec515f=null,_0x2d7a9c;}}:function(){};return _0xf5e22=![],_0x3fae63;}};}()),_0x5a667b=_0x559e72(this,function(){const _0x4b2737={_0x275526:0x349,_0x2d3b41:0x34c,_0x1dd250:0x346,_0x256f7a:0x2aa,_0x2e990c:0x2a9,_0x341395:0x2a7,_0x3e4161:0x348,_0x2a345f:0x333,_0x3459b4:0x341,_0x49f813:0x348,_0x3a1c00:0x342,_0x565bbc:0x33c,_0xafd6b0:0x337,_0x3068f1:0x33b,_0x27a044:0x33d},_0x3ce495={_0x41eac5:0x3c3};function _0x4c3a95(_0x232ee5,_0x46cb24,_0x2637bd,_0x4be07f){return _0x2923(_0x4be07f- -_0x3ce495._0x41eac5,_0x2637bd);}const _0x18470f={};_0x18470f[_0x4c3a95(-0x352,-_0x4b2737._0x275526,-_0x4b2737._0x2d3b41,-_0x4b2737._0x1dd250)]=_0x2e3f8f(0x29d,_0x4b2737._0x256f7a,_0x4b2737._0x2e990c,_0x4b2737._0x341395)+'+$';function _0x2e3f8f(_0x33be87,_0x33f1d4,_0x2140f3,_0x586d65){return _0x2923(_0x586d65-0x236,_0x2140f3);}const _0x444e12=_0x18470f;return _0x5a667b[_0x4c3a95(-0x353,-0x33e,-0x342,-0x348)]()[_0x4c3a95(-_0x4b2737._0x3e4161,-0x335,-_0x4b2737._0x2a345f,-0x33d)](_0x444e12['VYDKF'])[_0x4c3a95(-_0x4b2737._0x3459b4,-0x34c,-0x342,-_0x4b2737._0x49f813)]()[_0x4c3a95(-_0x4b2737._0x3a1c00,-0x350,-_0x4b2737._0x565bbc,-0x345)+'r'](_0x5a667b)[_0x4c3a95(-_0x4b2737._0xafd6b0,-0x349,-_0x4b2737._0x3068f1,-_0x4b2737._0x27a044)](_0x444e12['VYDKF']);});_0x5a667b();const SteamCommunity=require(_0x423246(-0x26d,-0x268,-0x26d,-0x277)+_0x423246(-0x26b,-0x275,-0x25f,-0x274)),SteamTotp=require(_0x423246(-0x276,-0x26f,-0x273,-0x26a)),moment=require(_0x194d66(0x278,0x270,0x274,0x281)),SteamUser=require('steam-user'),SteamStore=require(_0x423246(-0x27a,-0x279,-0x282,-0x287));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}function _0x2923(_0x2a9f58,_0x372462){const _0x48d424=_0xd6f2();return _0x2923=function(_0x183bd3,_0x53c18c){_0x183bd3=_0x183bd3-(0x211d+0x257*0x1+-0x2306);let _0x5e4ef2=_0x48d424[_0x183bd3];if(_0x2923['HtzLlm']===undefined){var _0x553d46=function(_0x78eaa8){const _0x36baee='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5460fb='',_0x22f52f='',_0x649df6=_0x5460fb+_0x553d46;for(let _0x5a08cd=-0x55e+-0xacd+0x102b,_0x31827d,_0x3508c5,_0x590efe=0x96b+0x6cf+-0x103a;_0x3508c5=_0x78eaa8['charAt'](_0x590efe++);~_0x3508c5&&(_0x31827d=_0x5a08cd%(0x1*-0x25e1+-0x124*-0x22+-0xe3)?_0x31827d*(0x3a*0x60+-0x8c5+-0xcbb)+_0x3508c5:_0x3508c5,_0x5a08cd++%(0x246a+0x21b0+-0x4616*0x1))?_0x5460fb+=_0x649df6['charCodeAt'](_0x590efe+(-0x2548+0x2000+0x552))-(0x1b7f+-0x198d+-0x2*0xf4)!==0x10f3*-0x1+0x265*0xb+-0x964?String['fromCharCode'](0x1d6e+-0x11*0x1cd+0x3*0xba&_0x31827d>>(-(-0xcb4+-0xa1*0x20+0x3a6*0x9)*_0x5a08cd&-0x1*0x1763+-0x8f*-0xb+0x22*0x82)):_0x5a08cd:-0x13c*0x1+-0x5e1+0x71d){_0x3508c5=_0x36baee['indexOf'](_0x3508c5);}for(let _0x5736e0=0x135d+-0x1bbb+0x3*0x2ca,_0x18256f=_0x5460fb['length'];_0x5736e0<_0x18256f;_0x5736e0++){_0x22f52f+='%'+('00'+_0x5460fb['charCodeAt'](_0x5736e0)['toString'](0x91*-0x29+-0x1d0a+-0x1171*-0x3))['slice'](-(-0x18d*-0x4+0x38d+-0x9bf));}return decodeURIComponent(_0x22f52f);};_0x2923['IokCHB']=_0x553d46,_0x2a9f58=arguments,_0x2923['HtzLlm']=!![];}const _0xdb00c9=_0x48d424[-0x2153+0x1a3*-0x10+-0xbe7*-0x5],_0x360356=_0x183bd3+_0xdb00c9,_0x3eb94e=_0x2a9f58[_0x360356];if(!_0x3eb94e){const _0x2708ff=function(_0x3eee69){this['ArmyeI']=_0x3eee69,this['xEJYBw']=[-0x10f*0x15+0x1c*-0xdf+-0x1750*-0x2,-0x1f25+-0x611*-0x4+0x3*0x24b,-0x13fd+-0x2024+0xa6d*0x5],this['FEpaOu']=function(){return'newState';},this['VPxode']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['gdRTWk']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2708ff['prototype']['cZnEgk']=function(){const _0x120498=new RegExp(this['VPxode']+this['gdRTWk']),_0x2650d2=_0x120498['test'](this['FEpaOu']['toString']())?--this['xEJYBw'][0x186f+-0x5*-0x62b+-0x3745]:--this['xEJYBw'][0x7cd*-0x5+0xd25*-0x2+0x5*0xd0f];return this['wWLpVy'](_0x2650d2);},_0x2708ff['prototype']['wWLpVy']=function(_0x3504e1){if(!Boolean(~_0x3504e1))return _0x3504e1;return this['YGangG'](this['ArmyeI']);},_0x2708ff['prototype']['YGangG']=function(_0x37d9fd){for(let _0x204e12=-0xb14+0x337*-0xc+-0x1c6*-0x1c,_0x3aafd7=this['xEJYBw']['length'];_0x204e12<_0x3aafd7;_0x204e12++){this['xEJYBw']['push'](Math['round'](Math['random']())),_0x3aafd7=this['xEJYBw']['length'];}return _0x37d9fd(this['xEJYBw'][0x371+0xce*0x24+-0x2069]);},new _0x2708ff(_0x2923)['cZnEgk'](),_0x5e4ef2=_0x2923['IokCHB'](_0x5e4ef2),_0x2a9f58[_0x360356]=_0x5e4ef2;}else _0x5e4ef2=_0x3eb94e;return _0x5e4ef2;},_0x2923(_0x2a9f58,_0x372462);}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};function _0x194d66(_0x495c3f,_0x304ad4,_0x459d27,_0x59a505){const _0x4856ec={_0x3370e3:0x201};return _0x2923(_0x495c3f-_0x4856ec._0x3370e3,_0x304ad4);}global.xbot=new xbot();function _0x423246(_0x26cb52,_0x1d1bef,_0x470c63,_0x3dc87a){return _0x2923(_0x26cb52- -0x2ee,_0x1d1bef);}async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*2;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();