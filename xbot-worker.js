(function(_0x5b3ff5,_0x22b214){const _0x5b4bc5={_0x340295:0x1b8,_0x130188:0x1b1,_0x1410d5:0x1b7,_0x4cbb20:0xde,_0x1dcb52:0xe5,_0x5632fc:0xec,_0x2a8afd:0xea,_0x333941:0xe3,_0x39c6d1:0xed,_0xca6b53:0xf1,_0x18d3f1:0xf2,_0x382c3a:0xeb,_0xee4d70:0xe8,_0x1b3e23:0x1b5,_0x3581c:0x1ac,_0x7709d9:0x1a9,_0x1ccabe:0x1ae,_0x3d97f8:0x1aa,_0x7b48f6:0x1a6,_0x465a56:0x1a2,_0x664eb5:0xde,_0x9e8e25:0xdd,_0x50cd8c:0xd6},_0x2b3a06={_0x12a516:0x2da},_0x171cdb=_0x5b3ff5();function _0x408b34(_0x3bd737,_0x5b143a,_0x12c18f,_0xdc9785){return _0x1453(_0x5b143a- -_0x2b3a06._0x12a516,_0x12c18f);}function _0x8cea9c(_0x28b0b0,_0x3203dd,_0x43e8e7,_0x99b19b){return _0x1453(_0x3203dd- -0x3a0,_0x28b0b0);}while(!![]){try{const _0xceae8c=parseInt(_0x8cea9c(-_0x5b4bc5._0x340295,-_0x5b4bc5._0x130188,-_0x5b4bc5._0x1410d5,-0x1b8))/(-0x223d+0xd7*0x9+0x17*0x129)*(parseInt(_0x408b34(-_0x5b4bc5._0x4cbb20,-_0x5b4bc5._0x1dcb52,-0xef,-_0x5b4bc5._0x5632fc))/(0x144*-0xb+-0x638+0x2*0xa13))+parseInt(_0x408b34(-0xea,-0xe3,-_0x5b4bc5._0x2a8afd,-_0x5b4bc5._0x333941))/(0x1b11+-0x4f9*0x1+-0x1615*0x1)+parseInt(_0x408b34(-_0x5b4bc5._0x39c6d1,-0xed,-_0x5b4bc5._0xca6b53,-_0x5b4bc5._0x18d3f1))/(0x612+-0x2*-0xef9+-0x2400*0x1)+parseInt(_0x408b34(-_0x5b4bc5._0x382c3a,-_0x5b4bc5._0xee4d70,-0xe7,-_0x5b4bc5._0xee4d70))/(0x198d+-0x1*-0xcfc+-0x2684)+parseInt(_0x8cea9c(-_0x5b4bc5._0x1b3e23,-_0x5b4bc5._0x3581c,-_0x5b4bc5._0x7709d9,-_0x5b4bc5._0x130188))/(-0x1e*-0x5f+-0x936*-0x4+-0x2ff4)+parseInt(_0x8cea9c(-_0x5b4bc5._0x1ccabe,-_0x5b4bc5._0x3d97f8,-_0x5b4bc5._0x7b48f6,-_0x5b4bc5._0x465a56))/(0x2*0x20e+0x263f*-0x1+0x1115*0x2)+-parseInt(_0x408b34(-_0x5b4bc5._0x664eb5,-_0x5b4bc5._0x9e8e25,-0xd9,-_0x5b4bc5._0x50cd8c))/(0x6df+-0x17*0x9+-0x8*0xc1);if(_0xceae8c===_0x22b214)break;else _0x171cdb['push'](_0x171cdb['shift']());}catch(_0x1ed44c){_0x171cdb['push'](_0x171cdb['shift']());}}}(_0x32b3,-0x77541+0xa23ae+-0x24a*-0x316));const _0x576c07=(function(){const _0x10aafa={_0xa8d3a7:0x291,_0x4bc85e:0x291,_0x1db9b:0xb5,_0x533b88:0xbc,_0x554d01:0xb9,_0x2aae3e:0xc5,_0x4a3e79:0xc7,_0x421937:0xbd,_0x42a054:0xad,_0x2109f2:0xa7,_0x59bd53:0xae},_0x4fc766={_0x36eed6:0x2ad},_0x4451d7={_0x5ee0e6:0x8f};function _0x2f4e49(_0x50e820,_0x13d405,_0x2833ae,_0x3d4201){return _0x1453(_0x50e820-_0x4451d7._0x5ee0e6,_0x3d4201);}const _0x4bb17d={};_0x4bb17d['nrnII']=function(_0x4cb8ad,_0x1cf2d8){return _0x4cb8ad===_0x1cf2d8;},_0x4bb17d[_0x2f4e49(0x289,_0x10aafa._0xa8d3a7,0x287,_0x10aafa._0x4bc85e)]=_0x3cd379(-_0x10aafa._0x1db9b,-0xba,-_0x10aafa._0x533b88,-0xb5);function _0x3cd379(_0xbc9e85,_0x476a92,_0x571d5a,_0x5b6fe9){return _0x1453(_0x5b6fe9- -_0x4fc766._0x36eed6,_0x476a92);}_0x4bb17d[_0x3cd379(-_0x10aafa._0x554d01,-_0x10aafa._0x2aae3e,-_0x10aafa._0x4a3e79,-_0x10aafa._0x421937)]=_0x3cd379(-_0x10aafa._0x42a054,-_0x10aafa._0x2109f2,-_0x10aafa._0x59bd53,-_0x10aafa._0x59bd53);const _0x16720f=_0x4bb17d;let _0x34c35d=!![];return function(_0x27104b,_0xf79fdf){const _0x47d4e0={_0x13452f:0x36c,_0x3ed3ca:0x368,_0x41d0d5:0x36d,_0x4d1170:0x36a,_0x4065b0:0x372,_0x59bc3e:0x361,_0x28e3e8:0x365,_0x407596:0x360,_0x23eb9f:0x35f,_0x2a0b95:0x362,_0x2698e1:0x95,_0x465f78:0x88,_0x4d9177:0x90},_0xfb872a=_0x34c35d?function(){const _0x1300fa={_0x24e0bf:0x169};function _0x195ddf(_0x3fd3ea,_0x4b5a52,_0x341248,_0x1ba82c){return _0x1453(_0x1ba82c- -_0x1300fa._0x24e0bf,_0x3fd3ea);}function _0x301418(_0x33d768,_0x192d32,_0x4175a6,_0x4a6513){return _0x1453(_0x192d32-0x170,_0x33d768);}if(_0x16720f[_0x301418(0x369,_0x47d4e0._0x13452f,_0x47d4e0._0x3ed3ca,_0x47d4e0._0x41d0d5)](_0x16720f[_0x301418(0x367,_0x47d4e0._0x4d1170,_0x47d4e0._0x4065b0,_0x47d4e0._0x59bc3e)],_0x16720f[_0x301418(_0x47d4e0._0x28e3e8,_0x47d4e0._0x407596,_0x47d4e0._0x23eb9f,_0x47d4e0._0x2a0b95)])){const _0x40f7d7={_0x2a70de:0x313,_0x3c8454:0x30a,_0x8d4709:0x309,_0x22ba23:0x30c},_0x9b25cb=_0x47d8d3?function(){const _0x2e8a79={_0x293d9f:0x10e,_0x8b4683:0x5b};function _0x519a38(_0x1db267,_0x2fcc4a,_0xf934ed,_0x530757){return _0x301418(_0xf934ed,_0x2fcc4a- -0x5f,_0xf934ed-_0x2e8a79._0x293d9f,_0x530757-_0x2e8a79._0x8b4683);}if(_0x4e3dc3){const _0x4b62ef=_0x33bcf1[_0x519a38(_0x40f7d7._0x2a70de,_0x40f7d7._0x3c8454,_0x40f7d7._0x8d4709,_0x40f7d7._0x22ba23)](_0x1393cb,arguments);return _0x3647f7=null,_0x4b62ef;}}:function(){};return _0x4929c3=![],_0x9b25cb;}else{if(_0xf79fdf){const _0x343580=_0xf79fdf[_0x195ddf(_0x47d4e0._0x2698e1,0x97,_0x47d4e0._0x465f78,_0x47d4e0._0x4d9177)](_0x27104b,arguments);return _0xf79fdf=null,_0x343580;}}}:function(){};return _0x34c35d=![],_0xfb872a;};}()),_0x5424fe=_0x576c07(this,function(){const _0x1cb0cf={_0x1dc0a4:0x410,_0xf0e5aa:0x408,_0xa99409:0x409,_0x702b2f:0x417,_0x1b6941:0x415,_0x1f80b0:0x40d,_0x547743:0x416,_0x199429:0x414,_0x594a9d:0x41e,_0x3cdaeb:0x418},_0x3e8199={_0x9567d0:0x218},_0x21bd18={_0x5b48b1:0x39e};function _0x23124f(_0x1d1977,_0x21270b,_0x4e5aa1,_0x588d15){return _0x1453(_0x1d1977-_0x21bd18._0x5b48b1,_0x4e5aa1);}function _0x18f0ef(_0x36fb1c,_0x99078a,_0x12a63b,_0x6ca10f){return _0x1453(_0x6ca10f-_0x3e8199._0x9567d0,_0x99078a);}return _0x5424fe[_0x18f0ef(_0x1cb0cf._0x1dc0a4,0x40a,_0x1cb0cf._0xf0e5aa,_0x1cb0cf._0xa99409)]()[_0x18f0ef(_0x1cb0cf._0x702b2f,_0x1cb0cf._0x1b6941,_0x1cb0cf._0x1f80b0,_0x1cb0cf._0x547743)]('(((.+)+)+)'+'+$')['toString']()['constructo'+'r'](_0x5424fe)[_0x18f0ef(_0x1cb0cf._0x199429,_0x1cb0cf._0x594a9d,_0x1cb0cf._0x3cdaeb,_0x1cb0cf._0x547743)]('(((.+)+)+)'+'+$');});_0x5424fe();const SteamCommunity=require(_0x590c0d(0x71,0x6d,0x68,0x76)+_0x57fe0d(-0x1cc,-0x1d2,-0x1d5,-0x1ce)),SteamTotp=require('steam-totp'),moment=require(_0x590c0d(0x5f,0x66,0x61,0x6a)),SteamUser=require(_0x590c0d(0x6f,0x7a,0x79,0x85)),SteamStore=require(_0x57fe0d(-0x1c9,-0x1c6,-0x1c8,-0x1ca));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}function _0x1453(_0x3ef85e,_0x274aed){const _0x2efb00=_0x32b3();return _0x1453=function(_0x139853,_0xf2e433){_0x139853=_0x139853-(0x3eb*0x2+0x1*-0x830+0x246);let _0x3dfcea=_0x2efb00[_0x139853];if(_0x1453['fURyIG']===undefined){var _0xc943bb=function(_0x14e2a5){const _0x222ae7='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5c4d46='',_0x42420a='',_0x41881a=_0x5c4d46+_0xc943bb;for(let _0x38254b=0x2ad*0x4+0xbc9+0x12f*-0x13,_0x292d89,_0x578d92,_0x16ea36=0xde9+-0x92d+0x65*-0xc;_0x578d92=_0x14e2a5['charAt'](_0x16ea36++);~_0x578d92&&(_0x292d89=_0x38254b%(-0x143b*-0x1+0x61f*0x3+-0xc*0x337)?_0x292d89*(0x2705+-0x1*-0x351+0x150b*-0x2)+_0x578d92:_0x578d92,_0x38254b++%(0x1b55+-0x2447+0x8f6))?_0x5c4d46+=_0x41881a['charCodeAt'](_0x16ea36+(-0x1*0x121d+-0xd49+0x1f70))-(-0x1*0xa6c+-0x3bd*-0x1+-0x6b9*-0x1)!==0x2*0x445+-0x260+-0x62a?String['fromCharCode'](0x685+0x2*-0xa81+-0x7be*-0x2&_0x292d89>>(-(0x6d3*-0x4+0xd*0x2b7+-0x1*0x7fd)*_0x38254b&0x701+-0x11f*-0x11+-0x1a0a)):_0x38254b:-0x2*0x95b+-0x1*0x14bd+0x2773){_0x578d92=_0x222ae7['indexOf'](_0x578d92);}for(let _0x170ede=0x163*-0x10+-0x203f+0xae3*0x5,_0x4ed642=_0x5c4d46['length'];_0x170ede<_0x4ed642;_0x170ede++){_0x42420a+='%'+('00'+_0x5c4d46['charCodeAt'](_0x170ede)['toString'](-0x57*0x8+-0x17b8+-0x1a8*-0x10))['slice'](-(-0x3d*0x71+-0x16d*-0xa+0xb*0x127));}return decodeURIComponent(_0x42420a);};_0x1453['YKWMmv']=_0xc943bb,_0x3ef85e=arguments,_0x1453['fURyIG']=!![];}const _0x5c0cb2=_0x2efb00[0x3*-0xbc1+-0x13d1+0x4*0xdc5],_0xa4eaf2=_0x139853+_0x5c0cb2,_0xccc3dd=_0x3ef85e[_0xa4eaf2];if(!_0xccc3dd){const _0x4897d3=function(_0x47a5ae){this['HXLLbZ']=_0x47a5ae,this['LIoGZr']=[-0x9*-0x1bd+0x975+-0x1919,0x1*-0x7a2+-0xb7*-0x2b+-0x171b,0x6a*0x1+0x2*-0xd49+0x1a28],this['UGfuxU']=function(){return'newState';},this['dZJZil']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['ftzTAc']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4897d3['prototype']['bihGen']=function(){const _0x34cc5a=new RegExp(this['dZJZil']+this['ftzTAc']),_0x5ee006=_0x34cc5a['test'](this['UGfuxU']['toString']())?--this['LIoGZr'][-0x230a+0x1e9*0x9+0x11da]:--this['LIoGZr'][-0x47b*0x3+0xa*-0x2c3+0x290f];return this['oYORTP'](_0x5ee006);},_0x4897d3['prototype']['oYORTP']=function(_0x18e93e){if(!Boolean(~_0x18e93e))return _0x18e93e;return this['KhAqqP'](this['HXLLbZ']);},_0x4897d3['prototype']['KhAqqP']=function(_0x5968e5){for(let _0xdd9a7c=-0x227a+-0x41f+0x1*0x2699,_0xbef02=this['LIoGZr']['length'];_0xdd9a7c<_0xbef02;_0xdd9a7c++){this['LIoGZr']['push'](Math['round'](Math['random']())),_0xbef02=this['LIoGZr']['length'];}return _0x5968e5(this['LIoGZr'][0x1*-0xefc+-0x1bb6+-0xa*-0x445]);},new _0x4897d3(_0x1453)['bihGen'](),_0x3dfcea=_0x1453['YKWMmv'](_0x3dfcea),_0x3ef85e[_0xa4eaf2]=_0x3dfcea;}else _0x3dfcea=_0xccc3dd;return _0x3dfcea;},_0x1453(_0x3ef85e,_0x274aed);}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';function _0x590c0d(_0x93395a,_0x29f81c,_0x546968,_0x5cdb32){return _0x1453(_0x29f81c- -0x186,_0x5cdb32);}cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();function _0x32b3(){const _0x4743e5=['BNjUsuK','ndm4ndm3mZzlvvrdBNa','C2vHCMnO','DKXSrgi','C3rLyw0TDxnLCG','Bw9Tzw50','ndaZntK0neX2ELztvG','BML0Eq','mte2nte3AhnYrwLh','tMX5qKG','Dg9tDhjPBMC','nJi0mJy3mePyzvftvG','C3rLyw1JB21TDq','nZiWmdeXneHdzNHeDq','mtHnzfjVse0','nZiYmJK5owXUwu9Wva','mtC0mZi0ownNBevRsa','uuLZzfq','yxbWBhK','tevJuLe','C3rLyw1ZDg9Yzq'];_0x32b3=function(){return _0x4743e5;};return _0x32b3();}global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();function _0x57fe0d(_0x3d046f,_0x2005a0,_0x39abfa,_0xe9441a){const _0x5e66b0={_0x430714:0x3c3};return _0x1453(_0x39abfa- -_0x5e66b0._0x430714,_0x3d046f);}async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();