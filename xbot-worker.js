(function(_0x138335,_0x41b0f1){const _0xd24bf4={_0xd704f8:0x230,_0x402a4d:0x22f,_0x504bb9:0x233,_0x1c3e7e:0x2d8,_0x58b2eb:0x2d3,_0x34491d:0x244,_0x3867a2:0x23c,_0x226521:0x234,_0x55410b:0x23e,_0x5d17a9:0x2cf,_0x2462b7:0x2d6,_0x3a8229:0x236,_0x3ace4d:0x23d,_0x4255aa:0x241,_0x28e3af:0x245,_0x3e7229:0x2d6,_0x549431:0x2c8,_0x510a27:0x2cd,_0x28e5fe:0x2d6,_0x8b769f:0x2e2,_0x1ca543:0x2dd,_0x460881:0x2e3,_0x5427e2:0x237,_0x1700eb:0x230,_0x3f74aa:0x2cc,_0x139400:0x2e1,_0xd2867a:0x2d9,_0x11bdc5:0x2de},_0x4114f2={_0x13da9c:0x344},_0x571f40={_0x4104b0:0x1cb};function _0x335c65(_0x311019,_0x1b7981,_0x2852d9,_0x29a4f6){return _0x185e(_0x1b7981-_0x571f40._0x4104b0,_0x311019);}function _0x2ab95e(_0x3bb9ef,_0x349033,_0xf36ac0,_0x3e1d0b){return _0x185e(_0xf36ac0- -_0x4114f2._0x13da9c,_0x349033);}const _0x5a4f89=_0x138335();while(!![]){try{const _0x556422=-parseInt(_0x335c65(_0xd24bf4._0xd704f8,_0xd24bf4._0x402a4d,_0xd24bf4._0x504bb9,0x233))/(0xad6+-0x1074+0x1*0x59f)*(parseInt(_0x2ab95e(-0x2da,-0x2d8,-_0xd24bf4._0x1c3e7e,-_0xd24bf4._0x58b2eb))/(0x8a*0xb+-0x1*0x79d+0x1b1*0x1))+-parseInt(_0x335c65(_0xd24bf4._0x34491d,_0xd24bf4._0x3867a2,_0xd24bf4._0x226521,_0xd24bf4._0x55410b))/(-0x143*0x16+-0xb1a+0x26df)*(parseInt(_0x2ab95e(-0x2cc,-_0xd24bf4._0x5d17a9,-_0xd24bf4._0x2462b7,-_0xd24bf4._0x2462b7))/(0x49d+0x1f40+-0x45*0x85))+parseInt(_0x335c65(_0xd24bf4._0x3a8229,0x233,0x23c,_0xd24bf4._0x3ace4d))/(0x1*0x17ff+0x1c5e*-0x1+-0x1*-0x464)*(parseInt(_0x335c65(0x237,_0xd24bf4._0x4255aa,_0xd24bf4._0x28e3af,_0xd24bf4._0x34491d))/(0xae2+0xd*0x199+-0x1fa1))+-parseInt(_0x2ab95e(-_0xd24bf4._0x3e7229,-_0xd24bf4._0x549431,-_0xd24bf4._0x510a27,-_0xd24bf4._0x28e5fe))/(-0x1*-0x22ed+-0x7e2+0x5b*-0x4c)+-parseInt(_0x2ab95e(-_0xd24bf4._0x8b769f,-_0xd24bf4._0x58b2eb,-_0xd24bf4._0x1ca543,-_0xd24bf4._0x460881))/(-0x2c1+0x1*0x796+0x1*-0x4cd)*(-parseInt(_0x335c65(_0xd24bf4._0x5427e2,_0xd24bf4._0x1700eb,0x235,0x22c))/(-0x2*0xbd8+0x2531+-0xd78))+parseInt(_0x2ab95e(-0x2cb,-_0xd24bf4._0x3f74aa,-0x2d1,-0x2c9))/(-0x1d6c+-0xf5d+-0x1a9*-0x1b)+parseInt(_0x2ab95e(-_0xd24bf4._0x139400,-0x2d3,-_0xd24bf4._0xd2867a,-_0xd24bf4._0x11bdc5))/(-0x44f*-0x7+-0x18*0x16e+-0x1*-0x432);if(_0x556422===_0x41b0f1)break;else _0x5a4f89['push'](_0x5a4f89['shift']());}catch(_0x501a54){_0x5a4f89['push'](_0x5a4f89['shift']());}}}(_0x4cdb,-0xc6f32+0x663f5+0x1*0xfe893));const _0x452788=(function(){let _0x29d64a=!![];return function(_0x4dd9e2,_0x284c80){const _0x11aeb5={_0x5b368b:0x1fc,_0x401a3d:0x1f3},_0x108ad6=_0x29d64a?function(){const _0x344c0e={_0x1e58e4:0x181};function _0x265027(_0x2e021b,_0x2e040d,_0x17aaf7,_0x4bb462){return _0x185e(_0x17aaf7-_0x344c0e._0x1e58e4,_0x2e021b);}if(_0x284c80){const _0x49b1de=_0x284c80[_0x265027(_0x11aeb5._0x5b368b,0x1fb,_0x11aeb5._0x401a3d,0x1ef)](_0x4dd9e2,arguments);return _0x284c80=null,_0x49b1de;}}:function(){};return _0x29d64a=![],_0x108ad6;};}()),_0x10b5b7=_0x452788(this,function(){const _0x63c8a5={_0x1e2398:0x418,_0x565630:0x415,_0x47f710:0x419,_0x44a1a6:0x41a,_0x461257:0x217,_0x5532c4:0x21c,_0x53ede8:0x21d,_0x564680:0x225,_0x5254b2:0x41c,_0x2a9ed6:0x41d,_0x5bcae5:0x22d,_0x190370:0x226,_0x48831b:0x419,_0x25321b:0x421,_0x36e35c:0x21b,_0x44d4d0:0x219,_0xa96688:0x213,_0x30c548:0x21d,_0x495707:0x215},_0x31053c={_0x162804:0x28c};function _0x53f1ef(_0x164f5a,_0x262b63,_0x388d09,_0x59f085){return _0x185e(_0x388d09- -_0x31053c._0x162804,_0x164f5a);}function _0x3b1497(_0x580735,_0x5db63b,_0x4a857c,_0x25c6d6){return _0x185e(_0x5db63b-0x3af,_0x25c6d6);}const _0x561007={};_0x561007[_0x3b1497(_0x63c8a5._0x1e2398,_0x63c8a5._0x565630,_0x63c8a5._0x47f710,_0x63c8a5._0x44a1a6)]=_0x53f1ef(-_0x63c8a5._0x461257,-_0x63c8a5._0x5532c4,-_0x63c8a5._0x53ede8,-_0x63c8a5._0x564680)+'+$';const _0xc4e68=_0x561007;return _0x10b5b7['toString']()[_0x3b1497(_0x63c8a5._0x44a1a6,_0x63c8a5._0x5254b2,_0x63c8a5._0x2a9ed6,0x41f)](_0xc4e68[_0x53f1ef(-0x226,-_0x63c8a5._0x5bcae5,-_0x63c8a5._0x190370,-0x220)])['toString']()[_0x3b1497(0x415,_0x63c8a5._0x48831b,0x41f,_0x63c8a5._0x25321b)+'r'](_0x10b5b7)[_0x53f1ef(-_0x63c8a5._0x36e35c,-_0x63c8a5._0x44d4d0,-0x21f,-_0x63c8a5._0x564680)](_0x53f1ef(-_0x63c8a5._0xa96688,-_0x63c8a5._0x190370,-_0x63c8a5._0x30c548,-_0x63c8a5._0x495707)+'+$');});_0x10b5b7();const SteamCommunity=require('steamcommu'+_0x4540af(-0x304,-0x309,-0x30b,-0x30f)),SteamTotp=require('steam-totp');function _0x4490dc(_0x40555f,_0x2a5d4d,_0x576463,_0x1cf178){const _0x1aa5cc={_0x1ab89d:0xf9};return _0x185e(_0x40555f-_0x1aa5cc._0x1ab89d,_0x1cf178);}function _0x4cdb(){const _0x10fdec=['Bw9Tzw50','BML0Eq','nZuWyNfizg5n','ndm3nZfXsLzRreW','mteZmdiZn2nAq0jOCq','mtC5mdGYBhPgvKLQ','sMPizM8','odHsr3vurNO','nZi1nwLWu3Djta','C3rLyw1ZDg9Yzq','y29UC3rYDwn0BW','mta1ndm0ndvcrhbXs2W','mKrOrKPvAW','C2vHCMnO','nZy0ntG4sxjSCMHg','kcGOlISPkYKRkq','C3rLyw0TDxnLCG','nLLoqKD6ua','yxbWBhK','oda2ntiYmejjtvbztG'];_0x4cdb=function(){return _0x10fdec;};return _0x4cdb();}function _0x185e(_0x286362,_0x386994){const _0x2cd693=_0x4cdb();return _0x185e=function(_0x3e04eb,_0x4c3672){_0x3e04eb=_0x3e04eb-(-0x1ca*0xd+0x1be*0x8+0x9b6);let _0x4edcaa=_0x2cd693[_0x3e04eb];if(_0x185e['gftSHL']===undefined){var _0x4ae6b5=function(_0x4048c6){const _0x18defe='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3f9eba='',_0x3e0cef='',_0x3f5c86=_0x3f9eba+_0x4ae6b5;for(let _0x127f12=-0x186b+0x1076*-0x1+0x28e1,_0x3f8c99,_0x79a538,_0x140530=0x206f*0x1+0x394*0xa+-0x4437;_0x79a538=_0x4048c6['charAt'](_0x140530++);~_0x79a538&&(_0x3f8c99=_0x127f12%(-0x16d2+-0x3b*0x2d+-0x2135*-0x1)?_0x3f8c99*(-0x803+-0x231*-0x2+-0x3*-0x14b)+_0x79a538:_0x79a538,_0x127f12++%(-0x2dd*0x7+-0x1*-0x14ea+0xdb*-0x1))?_0x3f9eba+=_0x3f5c86['charCodeAt'](_0x140530+(0x1*0x25cd+0xb*0x2a9+-0x4306))-(-0x4b8*0x1+-0x1*0x184d+0x1d0f)!==-0x201e+-0x327+0x2345*0x1?String['fromCharCode'](-0x191f+-0x9be+-0x264*-0xf&_0x3f8c99>>(-(0x1b23*0x1+0x45*-0x5+-0x19c8)*_0x127f12&-0x1fd6+-0x15ba+0x3596)):_0x127f12:0x1454+-0x10cc+0x1*-0x388){_0x79a538=_0x18defe['indexOf'](_0x79a538);}for(let _0x4dc1bc=-0x23a1+0x1*0x2245+0x15c,_0x173cd6=_0x3f9eba['length'];_0x4dc1bc<_0x173cd6;_0x4dc1bc++){_0x3e0cef+='%'+('00'+_0x3f9eba['charCodeAt'](_0x4dc1bc)['toString'](0x26e4*0x1+0x1*0x21dd+0x1*-0x48b1))['slice'](-(-0x2cf+-0x1814+0x1ae5));}return decodeURIComponent(_0x3e0cef);};_0x185e['SFdwEs']=_0x4ae6b5,_0x286362=arguments,_0x185e['gftSHL']=!![];}const _0x4dd4f3=_0x2cd693[-0x5*-0x496+-0xef9+0x7f5*-0x1],_0x2e947c=_0x3e04eb+_0x4dd4f3,_0xfebd06=_0x286362[_0x2e947c];if(!_0xfebd06){const _0x50da60=function(_0x4353e3){this['udDfzn']=_0x4353e3,this['PmaPLH']=[-0x1*0x1cc3+0x71*0xf+0x1625,-0x9*-0x42c+0x35d*-0x1+-0x222f,-0xce*-0x19+-0x1*0x1eb6+0x54c*0x2],this['NgJasq']=function(){return'newState';},this['ehgTWZ']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['QzHduz']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x50da60['prototype']['oiHYXh']=function(){const _0x5cd914=new RegExp(this['ehgTWZ']+this['QzHduz']),_0x2d83e9=_0x5cd914['test'](this['NgJasq']['toString']())?--this['PmaPLH'][-0xb30*-0x3+0x207f+-0x420e]:--this['PmaPLH'][0xbb*0x34+-0x2684+0x88];return this['VjAYHg'](_0x2d83e9);},_0x50da60['prototype']['VjAYHg']=function(_0x579b4a){if(!Boolean(~_0x579b4a))return _0x579b4a;return this['EyULsU'](this['udDfzn']);},_0x50da60['prototype']['EyULsU']=function(_0x2eca2b){for(let _0x5cca94=0xddf+0x11b*-0x5+-0x6*0x164,_0x222168=this['PmaPLH']['length'];_0x5cca94<_0x222168;_0x5cca94++){this['PmaPLH']['push'](Math['round'](Math['random']())),_0x222168=this['PmaPLH']['length'];}return _0x2eca2b(this['PmaPLH'][-0x71*0x48+-0xf6f+-0x99*-0x4f]);},new _0x50da60(_0x185e)['oiHYXh'](),_0x4edcaa=_0x185e['SFdwEs'](_0x4edcaa),_0x286362[_0x2e947c]=_0x4edcaa;}else _0x4edcaa=_0xfebd06;return _0x4edcaa;},_0x185e(_0x286362,_0x386994);}const moment=require(_0x4490dc(0x16d,0x16f,0x165,0x163)),SteamUser=require(_0x4490dc(0x169,0x16c,0x173,0x16c)),SteamStore=require(_0x4490dc(0x162,0x164,0x15c,0x15c));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);function _0x4540af(_0x5537fb,_0x2e9383,_0x4cfec6,_0x466175){const _0x4d5ef6={_0x1454d8:0x37e};return _0x185e(_0x2e9383- -_0x4d5ef6._0x1454d8,_0x466175);}lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();