(function(_0x58480a,_0x44dfae){const _0x30eafe={_0x1debcd:0xfe,_0x352345:0xf7,_0x5687b8:0x101,_0x3e1439:0x100,_0x32781e:0xf5,_0x157acd:0xf1,_0xfc9148:0xe5,_0x5633b1:0xe1,_0x403ee5:0xfb,_0x14bd2b:0xe5,_0x1472dd:0xe2,_0x5bf32e:0xe3,_0x26f4f1:0x106,_0x314e6b:0xfc,_0x17f442:0xed,_0x395138:0xeb,_0x14e409:0xf2,_0x566ddf:0xed},_0x2b7b23={_0x537868:0xe4};function _0x19ec7a(_0x3f9659,_0x4d3d38,_0x1f59a5,_0x3efa8d){return _0x1d2b(_0x4d3d38- -_0x2b7b23._0x537868,_0x1f59a5);}const _0x411403=_0x58480a();function _0x5bfb7a(_0xa7183a,_0x309d78,_0x300344,_0x418d33){return _0x1d2b(_0x309d78- -0x2cf,_0x418d33);}while(!![]){try{const _0x26495b=parseInt(_0x5bfb7a(-_0x30eafe._0x1debcd,-0xfc,-0xf7,-_0x30eafe._0x352345))/(-0x2479+0xd2b+0x174f)+-parseInt(_0x5bfb7a(-0xfb,-_0x30eafe._0x5687b8,-_0x30eafe._0x5687b8,-_0x30eafe._0x3e1439))/(0x1*-0x1615+-0xea1+-0x28*-0xeb)*(-parseInt(_0x19ec7a(0xfb,_0x30eafe._0x32781e,_0x30eafe._0x157acd,0xec))/(-0x1*-0xe61+-0xd71+-0x1*0xed))+-parseInt(_0x19ec7a(0xef,0xe6,_0x30eafe._0xfc9148,_0x30eafe._0x5633b1))/(-0x1755+0x35*0x1c+0x118d)+parseInt(_0x5bfb7a(-0xf1,-_0x30eafe._0x403ee5,-_0x30eafe._0x403ee5,-0xff))/(0x1b44+-0x1*-0x2500+0x1*-0x403f)+parseInt(_0x19ec7a(_0x30eafe._0x14bd2b,_0x30eafe._0x1472dd,_0x30eafe._0x5bf32e,0xe4))/(-0xc6d*-0x3+-0x21ea+-0x13*0x2d)+parseInt(_0x5bfb7a(-0xff,-_0x30eafe._0x26f4f1,-0x109,-_0x30eafe._0x314e6b))/(-0x16af+0x7*0x239+0x727)+-parseInt(_0x19ec7a(_0x30eafe._0x17f442,_0x30eafe._0x395138,_0x30eafe._0x14e409,_0x30eafe._0x566ddf))/(-0x1b0a+0x23*0x40+0x1d5*0xa);if(_0x26495b===_0x44dfae)break;else _0x411403['push'](_0x411403['shift']());}catch(_0x36052a){_0x411403['push'](_0x411403['shift']());}}}(_0x21ed,0xcbfd+-0x254f*-0x4+0xe581*0x1));const _0x457840=(function(){let _0x4bda5a=!![];return function(_0x48737e,_0x3c927d){const _0x48dbdc={_0x221606:0x93,_0x3d4d26:0x9c,_0x1550e2:0x9e,_0x56685e:0x90},_0xf34ea6={_0x3d8e9b:0x130},_0x3cc279={_0x1dd125:0x1de},_0x1787c6={};_0x1787c6['STggz']=function(_0x27d8d5,_0x2b36b0){return _0x27d8d5!==_0x2b36b0;};const _0x5ef7d6=_0x1787c6,_0x2da0de=_0x4bda5a?function(){function _0x45836a(_0x5e59d,_0x7d0ad7,_0x5de95a,_0x1f5ee7){return _0x1d2b(_0x1f5ee7-_0x3cc279._0x1dd125,_0x5de95a);}function _0x537138(_0x59b229,_0x5328d1,_0x576a52,_0x68026f){return _0x1d2b(_0x68026f- -_0xf34ea6._0x3d8e9b,_0x5328d1);}if(_0x5ef7d6[_0x537138(_0x48dbdc._0x221606,_0x48dbdc._0x3d4d26,_0x48dbdc._0x1550e2,_0x48dbdc._0x3d4d26)](_0x537138(0x9c,_0x48dbdc._0x56685e,_0x48dbdc._0x3d4d26,0x97),'UEFdQ')){if(_0x4132d0)_0x4de4a1.log(_0x19ebee);}else{if(_0x3c927d){const _0x1684c0=_0x3c927d['apply'](_0x48737e,arguments);return _0x3c927d=null,_0x1684c0;}}}:function(){};return _0x4bda5a=![],_0x2da0de;};}()),_0x394086=_0x457840(this,function(){const _0x3fb983={_0x131a8f:0x3b7,_0x5c5341:0x3b8,_0x33fd54:0x3bc,_0x584e51:0x3b6,_0x372247:0x2d7,_0x492ed3:0x2da,_0x81d01:0x2c8,_0x344293:0x2d0,_0x12a506:0x2d1,_0x29b233:0x3bd,_0x5ae3a9:0x3c1,_0x158e8f:0x3bb,_0x5466c4:0x2e0,_0x425925:0x2d6,_0x23b7ce:0x2d7,_0x59c6cd:0x2d7,_0xcc189f:0x2e1,_0x298c13:0x2d3,_0x28d5a3:0x2c3,_0x36cbc9:0x2cc},_0x3d5724={_0x42d34e:0x1eb},_0x3af328={};_0x3af328[_0x1dfe5a(_0x3fb983._0x131a8f,_0x3fb983._0x5c5341,_0x3fb983._0x33fd54,_0x3fb983._0x584e51)]=_0x49e2b2(_0x3fb983._0x372247,_0x3fb983._0x492ed3,0x2d2,_0x3fb983._0x81d01)+'+$';function _0x49e2b2(_0x2fc495,_0xc61e8e,_0x108ba8,_0xb06bf6){return _0x1d2b(_0x108ba8-0x101,_0x2fc495);}const _0x1c1643=_0x3af328;function _0x1dfe5a(_0x39d0d9,_0x5a9260,_0xfd1e05,_0x3ac3c3){return _0x1d2b(_0x3ac3c3-_0x3d5724._0x42d34e,_0x5a9260);}return _0x394086[_0x49e2b2(0x2c7,_0x3fb983._0x344293,_0x3fb983._0x12a506,0x2cc)]()['search'](_0x1c1643['hjeeZ'])[_0x1dfe5a(_0x3fb983._0x29b233,0x3c1,_0x3fb983._0x5ae3a9,_0x3fb983._0x158e8f)]()[_0x49e2b2(_0x3fb983._0x5466c4,_0x3fb983._0x425925,_0x3fb983._0x23b7ce,0x2d0)+'r'](_0x394086)[_0x49e2b2(_0x3fb983._0x59c6cd,_0x3fb983._0xcc189f,0x2d9,0x2d5)](_0x1c1643[_0x49e2b2(_0x3fb983._0x298c13,_0x3fb983._0x28d5a3,_0x3fb983._0x36cbc9,_0x3fb983._0x81d01)]);});_0x394086();const SteamCommunity=require(_0x246dab(0x340,0x333,0x337,0x330)+_0xbe49e2(-0x41,-0x37,-0x48,-0x41)),SteamTotp=require(_0xbe49e2(-0x49,-0x36,-0x45,-0x3f)),moment=require(_0xbe49e2(-0x47,-0x3f,-0x4a,-0x44)),SteamUser=require('steam-user'),SteamStore=require(_0x246dab(0x338,0x33c,0x33c,0x336));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}function _0xbe49e2(_0x244ae3,_0xbd34bf,_0x2343dd,_0xd02a16){return _0x1d2b(_0xd02a16- -0x216,_0x2343dd);}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};function _0x21ed(){const _0x47aa1b=['u1rNz3O','C3rLyw1ZDg9Yzq','mtq3nhznBxnVtW','mtmXnZG4mgnKELvUuG','Dg9tDhjPBMC','kcGOlISPkYKRkq','Bw9Tzw50','mtm1mZK4D2HdzvnO','oti1mJCWCKXgv0Hr','BML0Eq','y29UC3rYDwn0BW','C3rLyw0TDg90Ca','C2vHCMnO','mJm3CNbrCerh','mtq2ody4AurhDgPV','vuvgzfe','C3rLyw1JB21TDq','ntq5ndy1C1ffD2X5','nJCWotqWA1DwtMDA','AgPLzvO'];_0x21ed=function(){return _0x47aa1b;};return _0x21ed();}function _0x1d2b(_0x337d1,_0x166df2){const _0x3b57e9=_0x21ed();return _0x1d2b=function(_0x19b85e,_0x8663f9){_0x19b85e=_0x19b85e-(0x2194+0x17*-0x35+-0x1b0b);let _0x50a5ea=_0x3b57e9[_0x19b85e];if(_0x1d2b['ZpbYTA']===undefined){var _0x5e735c=function(_0x1afdfa){const _0x39b42c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2f117a='',_0x995b43='',_0xd6352d=_0x2f117a+_0x5e735c;for(let _0x25bfb1=-0x3cb*0x4+0x2232+-0x1306,_0x1c58fb,_0x12b9ed,_0x1962c3=0x1293+-0x81a+0x1*-0xa79;_0x12b9ed=_0x1afdfa['charAt'](_0x1962c3++);~_0x12b9ed&&(_0x1c58fb=_0x25bfb1%(-0xc07*-0x1+0x26fb+0x32fe*-0x1)?_0x1c58fb*(0x1*0x2387+0x23f2+0x1*-0x4739)+_0x12b9ed:_0x12b9ed,_0x25bfb1++%(0x198d+0x1*-0x263b+0xcb2))?_0x2f117a+=_0xd6352d['charCodeAt'](_0x1962c3+(0x14ed+0x17e5+-0x2cc8))-(0x5*-0x37d+-0x3*-0x71f+-0x8e*0x7)!==-0x26b9+-0x27b*-0x4+0x1*0x1ccd?String['fromCharCode'](-0xb4*-0x34+0xa69+0x6e*-0x6b&_0x1c58fb>>(-(-0x4d6+0xb*0x166+-0x26*0x47)*_0x25bfb1&0xebf*0x2+-0x1064+-0xd14)):_0x25bfb1:0x8*-0x183+-0x2424+0x303c){_0x12b9ed=_0x39b42c['indexOf'](_0x12b9ed);}for(let _0x23b69e=0xfc5+-0x1790+0x7cb,_0xc8429f=_0x2f117a['length'];_0x23b69e<_0xc8429f;_0x23b69e++){_0x995b43+='%'+('00'+_0x2f117a['charCodeAt'](_0x23b69e)['toString'](-0x2117+0x3f4*0x2+0x193f))['slice'](-(0x1a38+0x1*0x4e3+-0x1f19));}return decodeURIComponent(_0x995b43);};_0x1d2b['ARhDgV']=_0x5e735c,_0x337d1=arguments,_0x1d2b['ZpbYTA']=!![];}const _0x190f16=_0x3b57e9[0x593*0x1+0x1769+-0x1cfc],_0x581200=_0x19b85e+_0x190f16,_0x63b23=_0x337d1[_0x581200];if(!_0x63b23){const _0x4a4df6=function(_0x28825d){this['ZsmnMd']=_0x28825d,this['zdCCdt']=[0x11c9+0xa02*-0x3+0xc3e,-0x25b2+0x530*-0x4+0x3a72,-0x1af8+-0x2*-0x5b3+0xf92],this['QTQSDf']=function(){return'newState';},this['YdoHKV']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['pBjPfH']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4a4df6['prototype']['fZYVEN']=function(){const _0x36c8e2=new RegExp(this['YdoHKV']+this['pBjPfH']),_0x50011f=_0x36c8e2['test'](this['QTQSDf']['toString']())?--this['zdCCdt'][-0x233e+0x1e1+0x10af*0x2]:--this['zdCCdt'][-0x1eef+-0xfb6+0x2ea5*0x1];return this['UeTxOa'](_0x50011f);},_0x4a4df6['prototype']['UeTxOa']=function(_0x51a9e6){if(!Boolean(~_0x51a9e6))return _0x51a9e6;return this['CYrzRw'](this['ZsmnMd']);},_0x4a4df6['prototype']['CYrzRw']=function(_0x517187){for(let _0x117a0b=-0x9ec+-0x8db*0x4+0x2d58,_0x540182=this['zdCCdt']['length'];_0x117a0b<_0x540182;_0x117a0b++){this['zdCCdt']['push'](Math['round'](Math['random']())),_0x540182=this['zdCCdt']['length'];}return _0x517187(this['zdCCdt'][-0x10*0x3+0x10e3+-0x10b3]);},new _0x4a4df6(_0x1d2b)['fZYVEN'](),_0x50a5ea=_0x1d2b['ARhDgV'](_0x50a5ea),_0x337d1[_0x581200]=_0x50a5ea;}else _0x50a5ea=_0x63b23;return _0x50a5ea;},_0x1d2b(_0x337d1,_0x166df2);}function _0x246dab(_0x4d78d4,_0x2177be,_0x362243,_0x237032){const _0x1394e6={_0x38204a:0x16f};return _0x1d2b(_0x362243-_0x1394e6._0x38204a,_0x237032);}gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();