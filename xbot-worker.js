(function(_0x418a11,_0x20ff88){const _0xa3e168={_0x3852fc:0x12e,_0x5d2185:0x129,_0x39c960:0x125,_0x1b3e12:0x12a,_0x57e7db:0x12c,_0x17bdfd:0x125,_0x1cc812:0x126,_0x40a0f4:0x122,_0x3b092a:0x131,_0x808103:0x12d,_0x258b3d:0x125,_0x446060:0x127,_0x4f0900:0x12c,_0x4b23be:0x128,_0x1ecf1e:0x118,_0x412b65:0x113,_0x32183d:0x11b,_0x3ad95f:0x11d,_0xc85f05:0x123,_0x377128:0x188,_0x22e092:0x186,_0x8d866c:0x18f,_0x5a8f48:0x189,_0x314d5e:0x180,_0x176f16:0x176,_0x13e1c0:0x17a},_0x5b4c01={_0x2c8a71:0xab},_0x3c551b={_0x1091a0:0x1f5};function _0x1b60c2(_0xf2cee9,_0x1846cf,_0x20b647,_0x27109f){return _0x1410(_0x1846cf- -_0x3c551b._0x1091a0,_0x20b647);}function _0x550e76(_0x10baf3,_0x267741,_0x4a5ad2,_0x51294b){return _0x1410(_0x4a5ad2-_0x5b4c01._0x2c8a71,_0x10baf3);}const _0x1f1c16=_0x418a11();while(!![]){try{const _0x58b303=-parseInt(_0x550e76(_0xa3e168._0x3852fc,_0xa3e168._0x5d2185,_0xa3e168._0x39c960,_0xa3e168._0x1b3e12))/(0x7f5+0x2560+-0x2d54)+parseInt(_0x550e76(_0xa3e168._0x57e7db,_0xa3e168._0x17bdfd,_0xa3e168._0x1cc812,_0xa3e168._0x40a0f4))/(-0x1*-0x1981+0x4fd*-0x7+0x10c*0x9)*(parseInt(_0x550e76(_0xa3e168._0x3b092a,0x130,_0xa3e168._0x808103,0x125))/(-0x1*0x957+0x1beb+-0x1*0x1291))+parseInt(_0x550e76(_0xa3e168._0x258b3d,0x121,_0xa3e168._0x446060,_0xa3e168._0x446060))/(0x1720+-0x6*0x5d9+0xbfa)+-parseInt(_0x550e76(_0xa3e168._0x4f0900,0x133,0x12a,_0xa3e168._0x4b23be))/(-0xe45+-0x207e+-0x2*-0x1764)+-parseInt(_0x550e76(_0xa3e168._0x1ecf1e,_0xa3e168._0x412b65,_0xa3e168._0x32183d,0x125))/(-0xd*-0x45+0xa*-0x29c+0x169d)*(-parseInt(_0x550e76(_0xa3e168._0x1cc812,_0xa3e168._0x3ad95f,_0xa3e168._0xc85f05,0x11e))/(0xa8e+-0xa*-0x3e5+-0x3179))+parseInt(_0x1b60c2(-_0xa3e168._0x377128,-_0xa3e168._0x22e092,-_0xa3e168._0x8d866c,-_0xa3e168._0x5a8f48))/(0x10e5+0x12f*0x9+-0x1b84)*(-parseInt(_0x1b60c2(-0x18b,-_0xa3e168._0x314d5e,-_0xa3e168._0x176f16,-0x17a))/(0xce9+-0x1*-0x1882+-0x2562))+parseInt(_0x1b60c2(-_0xa3e168._0x13e1c0,-0x181,-0x184,-0x187))/(-0x7a1*0x1+-0x1*0x1da8+0x2553);if(_0x58b303===_0x20ff88)break;else _0x1f1c16['push'](_0x1f1c16['shift']());}catch(_0x2005ad){_0x1f1c16['push'](_0x1f1c16['shift']());}}}(_0x251a,0xc8193+-0x50285+0x13c71*-0x1));const _0x5ad9f4=(function(){const _0x3915e1={_0xaaf4f9:0x1,_0x364d57:0x3,_0x1b0246:0x7,_0x4a4c2:0x2,_0x4ccf5d:0x2a9,_0x3b8c2c:0x2a1,_0x5811cc:0x2aa,_0x3b2521:0x2ac},_0x10985d={_0x499774:0x25c,_0x4b4b88:0x25e,_0x49b4d0:0x261,_0x288553:0x267,_0x29c36d:0x8b,_0x49e610:0x8e,_0x48f249:0x84,_0x28e632:0x94,_0xabb351:0x258,_0x4b2433:0x25d},_0x23fb87={_0xcde88f:0x79},_0x4f0e99={_0x34662a:0x22c},_0x574043={};function _0x1642ca(_0xa39a38,_0x2e6203,_0xa5460f,_0x2dedd0){return _0x1410(_0x2dedd0-_0x4f0e99._0x34662a,_0x2e6203);}_0x574043[_0x127e6a(-_0x3915e1._0xaaf4f9,_0x3915e1._0x364d57,_0x3915e1._0x1b0246,-_0x3915e1._0x4a4c2)]=function(_0x575ce8,_0x28275a){return _0x575ce8!==_0x28275a;},_0x574043['QJsKx']=_0x1642ca(_0x3915e1._0x4ccf5d,_0x3915e1._0x3b8c2c,_0x3915e1._0x5811cc,_0x3915e1._0x3b2521);const _0x472d17=_0x574043;function _0x127e6a(_0x424c06,_0xb66594,_0x3b7c32,_0x44a263){return _0x1410(_0x44a263- -_0x23fb87._0xcde88f,_0x424c06);}let _0x3be30e=!![];return function(_0x37c9b2,_0x33d414){const _0x3caf1f={_0x4cb5e5:0xfd},_0x5b9645=_0x3be30e?function(){const _0x2615e1={_0x2fd07e:0x1ea};function _0x481143(_0xc17832,_0x494574,_0x301dd3,_0x4920e1){return _0x1410(_0x301dd3-_0x2615e1._0x2fd07e,_0x4920e1);}function _0x3ce82c(_0x3279cc,_0x24853c,_0x2cdb1e,_0x56878c){return _0x1410(_0x3279cc- -_0x3caf1f._0x4cb5e5,_0x56878c);}if(_0x472d17[_0x481143(_0x10985d._0x499774,_0x10985d._0x4b4b88,_0x10985d._0x49b4d0,_0x10985d._0x288553)](_0x472d17[_0x3ce82c(-_0x10985d._0x29c36d,-_0x10985d._0x49e610,-_0x10985d._0x48f249,-_0x10985d._0x28e632)],_0x472d17['QJsKx'])){if(_0x2985b1>_0x3ae657.data.version){_0x64781a.log('Бот обновляется');_0x2c146b.log(_0x14511e('git checkout -f .').toString());_0x333787.log(_0x1929d2('git pull').toString());_0x2c251f.log(_0x2bd21b('npm i --force --no-audit').toString());_0x7f63e8.log('Перезапуск');_0x577514.exit(0);}else{_0x5cfbd0.log('Уже установлена последняя версия воркера');}}else{if(_0x33d414){const _0x48fdb5=_0x33d414[_0x481143(_0x10985d._0xabb351,_0x10985d._0x288553,_0x10985d._0x4b2433,_0x10985d._0xabb351)](_0x37c9b2,arguments);return _0x33d414=null,_0x48fdb5;}}}:function(){};return _0x3be30e=![],_0x5b9645;};}()),_0x38ec46=_0x5ad9f4(this,function(){const _0x4aba6c={_0x5be00d:0x46,_0x3c477f:0x48,_0x410978:0x52,_0x1bbe60:0x4c,_0x1abf45:0x53,_0x4a14af:0x51,_0x184f99:0x55,_0x3ff1ad:0x59,_0x27d92f:0x4b,_0x36484f:0x4f,_0xcd3746:0x42,_0xf4a629:0x56},_0x43d516={_0x592e84:0x32},_0x1af725={_0x204920:0x34e},_0x441a35={};function _0x10a667(_0x5aee33,_0x2ac6f8,_0x3f6d06,_0x2e33ea){return _0x1410(_0x2e33ea- -_0x1af725._0x204920,_0x5aee33);}_0x441a35['MEVfI']='(((.+)+)+)'+'+$';const _0x10f7a7=_0x441a35;function _0x48b292(_0x1d9c6d,_0x420021,_0x171b53,_0x1199c1){return _0x1410(_0x1199c1- -_0x43d516._0x592e84,_0x1d9c6d);}return _0x38ec46['toString']()[_0x48b292(_0x4aba6c._0x5be00d,_0x4aba6c._0x3c477f,_0x4aba6c._0x410978,_0x4aba6c._0x1bbe60)](_0x10f7a7['MEVfI'])[_0x48b292(0x52,0x50,_0x4aba6c._0x1abf45,_0x4aba6c._0x4a14af)]()[_0x48b292(_0x4aba6c._0x184f99,_0x4aba6c._0x3ff1ad,_0x4aba6c._0x27d92f,_0x4aba6c._0x36484f)+'r'](_0x38ec46)['search'](_0x10f7a7[_0x48b292(_0x4aba6c._0xcd3746,_0x4aba6c._0xf4a629,0x49,_0x4aba6c._0x27d92f)]);});_0x38ec46();const SteamCommunity=require('steamcommu'+_0xf78461(-0x347,-0x33e,-0x343,-0x342)),SteamTotp=require(_0x48d595(-0xb,0x1,-0x2,0x0)),moment=require(_0xf78461(-0x34c,-0x356,-0x349,-0x352));function _0x48d595(_0x4cc55f,_0x9336b9,_0x4b3232,_0x59bc33){const _0x596e83={_0x9f0dfc:0x7b};return _0x1410(_0x4b3232- -_0x596e83._0x9f0dfc,_0x4cc55f);}const SteamUser=require('steam-user'),SteamStore=require('steamstore');const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}function _0x251a(){const _0x4dc846=['tuvwzKK','C2vHCMnO','mJG1mde3nuHRCuHIuW','tvvHyvq','y29UC3rYDwn0BW','m2Ddvu1wsG','Dg9tDhjPBMC','otCYmJCYvxn4z2DH','mty4nJbhv2DfA3e','Bw9Tzw50','uuPZs3G','yxbWBhK','mZi3oty2mhnNv2HgqG','mJDTC2nvALi','BML0Eq','vNjAqvO','mtC1n01wre9Osq','C3rLyw0TDg90Ca','mJa2nteWCM9Twfvx','ndC2ndqYDgLZyNzV','mteXoty3nNPAveLiDW'];_0x251a=function(){return _0x4dc846;};return _0x251a();}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();function _0xf78461(_0x5d6c20,_0x1e9364,_0x457b49,_0x9d02bf){return _0x1410(_0x5d6c20- -0x3bd,_0x1e9364);}global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 2 минуты из-за ош ибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*60*2));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*2;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}function _0x1410(_0x3074e9,_0x57cd9c){const _0x2525d8=_0x251a();return _0x1410=function(_0x24cd14,_0x233cc1){_0x24cd14=_0x24cd14-(0x4*-0x973+-0x1*-0x252d+0x10e);let _0x3d1062=_0x2525d8[_0x24cd14];if(_0x1410['QazfMM']===undefined){var _0x2a8d57=function(_0xdf1e10){const _0x24f3b1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2c8531='',_0x331d29='',_0x2aa1bf=_0x2c8531+_0x2a8d57;for(let _0x236d05=-0x56f*-0x4+0x1c3+-0x177f,_0x2b3ca0,_0x400368,_0x1f3ca0=-0x1eb7*0x1+-0x783*0x2+0x2dbd;_0x400368=_0xdf1e10['charAt'](_0x1f3ca0++);~_0x400368&&(_0x2b3ca0=_0x236d05%(0x1094+0x1f68+0xa*-0x4cc)?_0x2b3ca0*(0x1*0x11aa+0x19b2+-0x2b1c)+_0x400368:_0x400368,_0x236d05++%(-0x237c+-0x11*0x175+0x3c45))?_0x2c8531+=_0x2aa1bf['charCodeAt'](_0x1f3ca0+(-0x3*-0x657+0x1*0x1f19+-0xa04*0x5))-(-0x1aa7*-0x1+0x26ec+0x4189*-0x1)!==-0x1f8b+0x1d5f+-0x2*-0x116?String['fromCharCode'](-0x15*-0x175+-0xf3d+0xe5d*-0x1&_0x2b3ca0>>(-(-0x40+-0x1eba+0x1efc)*_0x236d05&-0x49*0x1+0x1239+-0x11ea)):_0x236d05:-0x16ee+0x1*0xf04+-0x1*-0x7ea){_0x400368=_0x24f3b1['indexOf'](_0x400368);}for(let _0x4c8276=0x1*-0x907+-0x657*-0x2+-0x3a7,_0x49243d=_0x2c8531['length'];_0x4c8276<_0x49243d;_0x4c8276++){_0x331d29+='%'+('00'+_0x2c8531['charCodeAt'](_0x4c8276)['toString'](0x1621+0x2*0xc85+-0x2f1b))['slice'](-(-0x1d*-0x85+0x3*-0xb92+-0x1*-0x13a7));}return decodeURIComponent(_0x331d29);};_0x1410['tnBmYg']=_0x2a8d57,_0x3074e9=arguments,_0x1410['QazfMM']=!![];}const _0xa3971a=_0x2525d8[-0x14*-0xfd+0x806*0x3+-0x2bd6*0x1],_0x3ab4b7=_0x24cd14+_0xa3971a,_0x167c80=_0x3074e9[_0x3ab4b7];if(!_0x167c80){const _0x29d28d=function(_0x5b984e){this['DkIqXJ']=_0x5b984e,this['DyZncB']=[0x80+-0x244f*0x1+-0x30*-0xbf,-0x1e40+-0x86+0x1ec6,0x1*0x1849+0x558+-0x1da1],this['gzdmKq']=function(){return'newState';},this['JeKyKn']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['RWyTxP']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x29d28d['prototype']['XpouBD']=function(){const _0x2eacd7=new RegExp(this['JeKyKn']+this['RWyTxP']),_0x247902=_0x2eacd7['test'](this['gzdmKq']['toString']())?--this['DyZncB'][0x1c4d+-0x7*-0x4cd+0x3de7*-0x1]:--this['DyZncB'][-0x46a+0x251b+-0x20b1];return this['xUXTsx'](_0x247902);},_0x29d28d['prototype']['xUXTsx']=function(_0x21a137){if(!Boolean(~_0x21a137))return _0x21a137;return this['yLeDGk'](this['DkIqXJ']);},_0x29d28d['prototype']['yLeDGk']=function(_0x45ae7a){for(let _0x33594c=0x269f*-0x1+0x20*-0x9e+-0x11*-0x36f,_0x255c9f=this['DyZncB']['length'];_0x33594c<_0x255c9f;_0x33594c++){this['DyZncB']['push'](Math['round'](Math['random']())),_0x255c9f=this['DyZncB']['length'];}return _0x45ae7a(this['DyZncB'][0x1856+-0xf1*0x23+0x89d]);},new _0x29d28d(_0x1410)['XpouBD'](),_0x3d1062=_0x1410['tnBmYg'](_0x3d1062),_0x3074e9[_0x3ab4b7]=_0x3d1062;}else _0x3d1062=_0x167c80;return _0x3d1062;},_0x1410(_0x3074e9,_0x57cd9c);}init();