(function(_0x45e534,_0x58e676){const _0x450976={_0x386abe:0x2ca,_0x36fee7:0x2cd,_0x26168b:0x2c3,_0x462a32:0x2cf,_0xaac521:0x1ec,_0x37ea87:0x1fb,_0x17e508:0x1f4,_0x1e630b:0x1f7,_0x52efcd:0x1fc,_0x1f3aa0:0x1f2,_0xbd5194:0x2d9,_0x1cce11:0x2d3,_0x49bde4:0x2d3,_0x13f7c6:0x2ce,_0x6c6ee7:0x2d1,_0x3c5698:0x2e3,_0x2e9815:0x2de,_0x32c18d:0x1fa,_0x5b1d85:0x1f4},_0x5b41bb={_0x1338ba:0x3ad};function _0x42db3e(_0x20f660,_0xca538c,_0x532d92,_0x558b5d){return _0x360e(_0xca538c- -_0x5b41bb._0x1338ba,_0x532d92);}function _0x2c11c8(_0x36ae0d,_0x4fcdfc,_0x3d6310,_0x1d5315){return _0x360e(_0x1d5315- -0x2cf,_0x3d6310);}const _0x4c4b48=_0x45e534();while(!![]){try{const _0x5034a7=-parseInt(_0x42db3e(-_0x450976._0x386abe,-_0x450976._0x36fee7,-_0x450976._0x26168b,-_0x450976._0x462a32))/(-0xe95+0x5dd+-0x1d*-0x4d)+-parseInt(_0x2c11c8(-_0x450976._0xaac521,-0x1f6,-_0x450976._0x37ea87,-_0x450976._0x17e508))/(0x1757+0x254e+-0x3ca3)+parseInt(_0x2c11c8(-0x1f8,-_0x450976._0x1e630b,-_0x450976._0x52efcd,-_0x450976._0x1f3aa0))/(-0x13c5+-0x112*-0x2+0x11a4)+parseInt(_0x42db3e(-0x2e0,-_0x450976._0xbd5194,-_0x450976._0x1cce11,-0x2cf))/(0x8da+0x7*-0x523+0x1b1f)+parseInt(_0x42db3e(-0x2ce,-_0x450976._0x49bde4,-_0x450976._0x13f7c6,-_0x450976._0x6c6ee7))/(-0x238e*-0x1+-0x75a*-0x2+-0x323d)+parseInt(_0x42db3e(-_0x450976._0x3c5698,-0x2d8,-0x2de,-_0x450976._0x2e9815))/(-0x98*-0x2f+0x2*0x66+0x1cae*-0x1)+parseInt(_0x2c11c8(-0x1f0,-_0x450976._0x32c18d,-_0x450976._0x5b1d85,-_0x450976._0x1e630b))/(0x185d+0x2*0xe3c+0x9*-0x5de);if(_0x5034a7===_0x58e676)break;else _0x4c4b48['push'](_0x4c4b48['shift']());}catch(_0x3b5df8){_0x4c4b48['push'](_0x4c4b48['shift']());}}}(_0x21ee,-0x74eec+0x1*-0x1d56+0xbdc64));const _0x2de691=(function(){const _0x142732={_0x5bc4fe:0x172,_0x32525e:0x179,_0x2fcea9:0x17b,_0x56321c:0x17f,_0x194775:0x17c},_0x30c999={_0x2b1d48:0x3c1,_0x1565d8:0x3b5,_0xcc81e6:0x3d0,_0x2f2298:0x3ce,_0x4e954f:0x3ca,_0x4e31b1:0x3c6,_0x13d153:0x2fc,_0x398ff5:0x2f6,_0x56fac2:0x2eb,_0x37b7ab:0x3be,_0xd62ed:0x3c0,_0x443985:0x3c7},_0x281df3={_0x2ec656:0x25d},_0xf12458={_0x31868f:0x355},_0x571c8b={};_0x571c8b['AxUvb']=function(_0x2e4aee,_0x4d50ff){return _0x2e4aee===_0x4d50ff;},_0x571c8b[_0x31baf4(-0x172,-0x183,-_0x142732._0x5bc4fe,-_0x142732._0x32525e)]=_0x31baf4(-0x180,-_0x142732._0x2fcea9,-_0x142732._0x56321c,-_0x142732._0x194775);function _0x45ebbb(_0x3b8877,_0x4b0098,_0x18a48c,_0x22ab65){return _0x360e(_0x3b8877- -_0xf12458._0x31868f,_0x4b0098);}const _0x31efae=_0x571c8b;let _0x12ddfb=!![];function _0x31baf4(_0x1daaec,_0x5e67e9,_0x2be958,_0x100391){return _0x360e(_0x100391- -_0x281df3._0x2ec656,_0x1daaec);}return function(_0x59910d,_0x3d3251){const _0x34a153=_0x12ddfb?function(){const _0x40c17a={_0x497a9b:0x3da},_0x3efd18={_0x1d961c:0x2e2};function _0x37d138(_0x329e0b,_0x3c87fc,_0x3ede75,_0x23dc06){return _0x360e(_0x23dc06-_0x3efd18._0x1d961c,_0x3ede75);}function _0x49e4e4(_0x1201f6,_0x9dd8f5,_0x12c703,_0x613d58){return _0x360e(_0x9dd8f5- -_0x40c17a._0x497a9b,_0x1201f6);}if(_0x3d3251){if(_0x31efae[_0x37d138(_0x30c999._0x2b1d48,0x3c6,_0x30c999._0x1565d8,0x3bb)](_0x31efae[_0x37d138(_0x30c999._0xcc81e6,_0x30c999._0x2f2298,_0x30c999._0x4e954f,_0x30c999._0x4e31b1)],_0x31efae[_0x49e4e4(-_0x30c999._0x13d153,-_0x30c999._0x398ff5,-0x2f7,-_0x30c999._0x56fac2)])){const _0x6a81dd=_0x3d3251[_0x37d138(_0x30c999._0x4e31b1,_0x30c999._0x37b7ab,_0x30c999._0xd62ed,_0x30c999._0x443985)](_0x59910d,arguments);return _0x3d3251=null,_0x6a81dd;}else _0x4cc043.env['NODE_TLS_REJECT_UNAUTHORIZED']=0,_0x462013.xbot_apiurl=_0x281ffc.env.XBOT_URL;}}:function(){};return _0x12ddfb=![],_0x34a153;};}()),_0x559833=_0x2de691(this,function(){const _0xfe5bc2={_0x3c989f:0x178,_0x46d990:0x16f,_0xc9ae84:0x176,_0x30beb4:0x178,_0x3dcc81:0x1c5,_0x7950b9:0x1cf,_0x27cb7a:0x1cd,_0x5e5e87:0x1cd,_0x41d4c3:0x169,_0x5ecc5f:0x175,_0x1f0a17:0x179,_0x21afc6:0x170,_0x539e74:0x16e,_0x251312:0x166,_0x59e78d:0x170,_0x325255:0x16d,_0x1b5f28:0x16c,_0x2115f2:0x179,_0x49ee16:0x16f,_0x574c82:0x174,_0x56d3be:0x17a,_0x49a13a:0x1b6,_0x503404:0x1ac,_0x1d3542:0x1b8,_0x20d3ef:0x1be},_0x5b3713={_0x4deb1d:0xe3},_0x334b6d={_0x3e98ac:0x24f},_0x140963={};_0x140963[_0x3a201b(-_0xfe5bc2._0x3c989f,-_0xfe5bc2._0x46d990,-_0xfe5bc2._0xc9ae84,-_0xfe5bc2._0x30beb4)]=_0x88316c(_0xfe5bc2._0x3dcc81,_0xfe5bc2._0x7950b9,_0xfe5bc2._0x27cb7a,_0xfe5bc2._0x5e5e87)+'+$';function _0x3a201b(_0x2a77f8,_0x103b60,_0x3155e5,_0x2add1d){return _0x360e(_0x2add1d- -_0x334b6d._0x3e98ac,_0x3155e5);}function _0x88316c(_0x996960,_0x3c1db1,_0x5bac72,_0x3328eb){return _0x360e(_0x996960-_0x5b3713._0x4deb1d,_0x5bac72);}const _0x1836e6=_0x140963;return _0x559833[_0x3a201b(-_0xfe5bc2._0x41d4c3,-_0xfe5bc2._0x5ecc5f,-_0xfe5bc2._0x1f0a17,-_0xfe5bc2._0x21afc6)]()['search'](_0x3a201b(-_0xfe5bc2._0x539e74,-_0xfe5bc2._0x251312,-_0xfe5bc2._0x59e78d,-_0xfe5bc2._0x325255)+'+$')[_0x3a201b(-_0xfe5bc2._0x1b5f28,-_0xfe5bc2._0x2115f2,-_0xfe5bc2._0x49ee16,-_0xfe5bc2._0x59e78d)]()[_0x3a201b(-_0xfe5bc2._0x574c82,-0x17c,-_0xfe5bc2._0x56d3be,-_0xfe5bc2._0x2115f2)+'r'](_0x559833)[_0x88316c(_0xfe5bc2._0x49a13a,_0xfe5bc2._0x503404,_0xfe5bc2._0x1d3542,_0xfe5bc2._0x20d3ef)](_0x1836e6['pHrrO']);});_0x559833();const SteamCommunity=require(_0x490d1d(0xef,0xf9,0xf4,0xf2)+'nity'),SteamTotp=require(_0x490d1d(0xf1,0xe9,0xed,0xf7)),moment=require(_0x490d1d(0xf6,0xee,0xec,0x101)),SteamUser=require(_0x3860f3(0x48c,0x47b,0x484,0x48e)),SteamStore=require(_0x3860f3(0x49e,0x4a1,0x498,0x491));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();function _0x360e(_0x5b5fc1,_0x99cef7){const _0x3d9131=_0x21ee();return _0x360e=function(_0x35e91a,_0x2b8b98){_0x35e91a=_0x35e91a-(-0x1fe6+-0x2*0x7e0+0x3078);let _0x220953=_0x3d9131[_0x35e91a];if(_0x360e['rbwFzG']===undefined){var _0x142260=function(_0x4dc1b2){const _0x2af9a4='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xdbd0a8='',_0x56680d='',_0x3bc569=_0xdbd0a8+_0x142260;for(let _0x5ea035=0x4*0x14e+0x193a*-0x1+0x1402,_0x127abd,_0x45703e,_0x273457=0x18f4+0x57f+-0x5*0x617;_0x45703e=_0x4dc1b2['charAt'](_0x273457++);~_0x45703e&&(_0x127abd=_0x5ea035%(-0x20ed+-0x25c6+-0x1*-0x46b7)?_0x127abd*(0xb5*0x1f+0x1*-0x115+-0x1496*0x1)+_0x45703e:_0x45703e,_0x5ea035++%(0x1d3d*-0x1+-0x11c4+0x2f05*0x1))?_0xdbd0a8+=_0x3bc569['charCodeAt'](_0x273457+(0x6*-0x29b+-0x116e+0x108d*0x2))-(0x6*-0x279+0x2238+0x9ac*-0x2)!==-0xcad+0x1*0xf0c+0x25f*-0x1?String['fromCharCode'](-0x17df+-0x746+0x2024&_0x127abd>>(-(0x1*-0x2051+0x6*0x17b+0x1771)*_0x5ea035&0x17a7+-0x11*-0x189+-0x26*0x14f)):_0x5ea035:0x213f+-0x7e4+-0x195b){_0x45703e=_0x2af9a4['indexOf'](_0x45703e);}for(let _0x1fd422=-0x23cb+0x194+0x1cd*0x13,_0x4b01b3=_0xdbd0a8['length'];_0x1fd422<_0x4b01b3;_0x1fd422++){_0x56680d+='%'+('00'+_0xdbd0a8['charCodeAt'](_0x1fd422)['toString'](0x11*-0x17+-0x4e4+0x7*0xed))['slice'](-(-0x80e+0x2498+-0x1c88));}return decodeURIComponent(_0x56680d);};_0x360e['zIHpoC']=_0x142260,_0x5b5fc1=arguments,_0x360e['rbwFzG']=!![];}const _0x322345=_0x3d9131[-0x8bb+-0x3*0x9cd+0x2622],_0xc18da8=_0x35e91a+_0x322345,_0x11afa5=_0x5b5fc1[_0xc18da8];if(!_0x11afa5){const _0x4f5420=function(_0x5b922f){this['nbJAaA']=_0x5b922f,this['QUWPCz']=[0x486*0x5+-0x22f3+0xc56,0x1516+0x9fc+-0x52*0x61,-0x180d+0x2eb*0x6+0x1*0x68b],this['jvpugU']=function(){return'newState';},this['fOAlZO']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['xxfbWx']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4f5420['prototype']['dOegNz']=function(){const _0x367ab0=new RegExp(this['fOAlZO']+this['xxfbWx']),_0x56e5e5=_0x367ab0['test'](this['jvpugU']['toString']())?--this['QUWPCz'][-0x3e*-0x59+0x147b+-0x1*0x2a08]:--this['QUWPCz'][0x1*-0x1508+0x12a8+0x20*0x13];return this['uCqbkk'](_0x56e5e5);},_0x4f5420['prototype']['uCqbkk']=function(_0xf81233){if(!Boolean(~_0xf81233))return _0xf81233;return this['ZLMHBm'](this['nbJAaA']);},_0x4f5420['prototype']['ZLMHBm']=function(_0x440f28){for(let _0x352be8=0x19b6+-0x2290+0xce*0xb,_0x333cad=this['QUWPCz']['length'];_0x352be8<_0x333cad;_0x352be8++){this['QUWPCz']['push'](Math['round'](Math['random']())),_0x333cad=this['QUWPCz']['length'];}return _0x440f28(this['QUWPCz'][-0x1217*0x1+-0x125f+0x2476]);},new _0x4f5420(_0x360e)['dOegNz'](),_0x220953=_0x360e['zIHpoC'](_0x220953),_0x5b5fc1[_0xc18da8]=_0x220953;}else _0x220953=_0x11afa5;return _0x220953;},_0x360e(_0x5b5fc1,_0x99cef7);}global.user=undefined;function _0x3860f3(_0x43f764,_0x234db5,_0x406a02,_0xdbf900){const _0x16e32d={_0x2b8dac:0x3b2};return _0x360e(_0x406a02-_0x16e32d._0x2b8dac,_0x234db5);}global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};function _0x21ee(){const _0x194da3=['CeHYCK8','nZu2mteYvwXKy1rv','qxHvDMi','mZe4ndGWuefkBevd','nJi0mJq4zurVqNnt','C3rLyw1JB21TDq','nZC2ndyZvM5Uzg1T','C3rLyw0TDg90Ca','Dg9tDhjPBMC','ndi4mJyXz0HUr0DI','B25rq1m','kcGOlISPkYKRkq','Bw9Tzw50','EMTpB0W','yxbWBhK','C3rLyw1ZDg9Yzq','C3rLyw0TDxnLCG','C2vHCMnO','mtG5odmZmKD6q3zTzG','nZu2nZe0zg1uDg9J','y29UC3rYDwn0BW'];_0x21ee=function(){return _0x194da3;};return _0x21ee();}if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';function _0x490d1d(_0x351d0f,_0x4ce06b,_0x20b5b0,_0x1c9362){const _0x45f507={_0x45a602:0x13};return _0x360e(_0x351d0f-_0x45f507._0x45a602,_0x1c9362);}saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();