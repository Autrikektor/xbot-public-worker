(function(_0x20a27c,_0x378062){const _0x13c064={_0x5a7a20:0x37c,_0x3af89e:0x380,_0x34b276:0x388,_0x49842f:0x385,_0x3f58f9:0x37a,_0x1b9514:0x339,_0x48d004:0x343,_0x336712:0x390,_0x47b58a:0x386,_0x9d0e7b:0x38f,_0x4f881e:0x38d,_0x8b86ec:0x382,_0x3be298:0x38c,_0x342ffe:0x335,_0x398b39:0x32c,_0x2f9b89:0x329,_0xcf1fad:0x32f,_0x394c72:0x389,_0x279efd:0x38e,_0x3f3e57:0x331,_0xcf2e09:0x333,_0x315452:0x33d,_0x3683f2:0x383,_0x3f9a29:0x381,_0x90facf:0x378,_0x513363:0x370,_0x7204f6:0x37e,_0x49ddb0:0x376,_0x4eca1f:0x37d,_0x4110fc:0x333,_0x9d740e:0x340,_0x368d72:0x338,_0x5517b0:0x33b},_0x1bfbbf={_0x322bca:0x226},_0x298265={_0x5e73ff:0x1d6};function _0x199f6b(_0x10aa93,_0x49ff02,_0x37872a,_0x3ddfc8){return _0x3c5e(_0x49ff02-_0x298265._0x5e73ff,_0x37872a);}const _0x38ed61=_0x20a27c();function _0x51271d(_0x35a96c,_0x155a57,_0x2feba2,_0x2b6db5){return _0x3c5e(_0x2b6db5-_0x1bfbbf._0x322bca,_0x2feba2);}while(!![]){try{const _0x531b33=-parseInt(_0x51271d(_0x13c064._0x5a7a20,0x38f,_0x13c064._0x3af89e,_0x13c064._0x34b276))/(-0x32b*0x2+-0xb06*-0x1+-0x4af)*(parseInt(_0x51271d(_0x13c064._0x3af89e,_0x13c064._0x49842f,_0x13c064._0x3f58f9,0x37f))/(-0x18e3+-0xd58+0x263d))+parseInt(_0x199f6b(0x33d,_0x13c064._0x1b9514,_0x13c064._0x48d004,0x340))/(0x7eb+-0x1ce5*0x1+-0x14fd*-0x1)*(parseInt(_0x51271d(_0x13c064._0x336712,0x386,_0x13c064._0x47b58a,_0x13c064._0x9d0e7b))/(0x36f*0x2+-0x9c8+0x2ee))+-parseInt(_0x51271d(_0x13c064._0x4f881e,0x386,_0x13c064._0x8b86ec,_0x13c064._0x3be298))/(-0x135*0x18+-0x1*0x2492+-0x418f*-0x1)+parseInt(_0x199f6b(_0x13c064._0x342ffe,_0x13c064._0x398b39,_0x13c064._0x2f9b89,_0x13c064._0xcf1fad))/(0x1*-0x1cef+-0x936+-0x262b*-0x1)*(-parseInt(_0x51271d(_0x13c064._0x9d0e7b,_0x13c064._0x394c72,0x38c,_0x13c064._0x279efd))/(-0x11d5+-0xe09*0x2+0x2dee))+-parseInt(_0x199f6b(0x33b,_0x13c064._0x3f3e57,_0x13c064._0xcf2e09,_0x13c064._0x315452))/(0x1e45+0x1*0x13e7+0x4*-0xc89)*(parseInt(_0x51271d(_0x13c064._0x3683f2,_0x13c064._0x3f9a29,_0x13c064._0x90facf,0x37e))/(0x13bc+0x1*-0xb2b+-0x2*0x444))+parseInt(_0x51271d(_0x13c064._0x513363,_0x13c064._0x7204f6,_0x13c064._0x49ddb0,_0x13c064._0x4eca1f))/(0x6*-0x17e+0xa*-0x3d+0xb60)*(parseInt(_0x199f6b(_0x13c064._0x4110fc,_0x13c064._0x9d740e,_0x13c064._0x368d72,0x34a))/(0xd30*-0x2+-0x74*-0x2b+0x19*0x47))+parseInt(_0x199f6b(0x348,_0x13c064._0x5517b0,0x334,0x344))/(0x77f*-0x3+-0x1c4e+0x13*0x2ad);if(_0x531b33===_0x378062)break;else _0x38ed61['push'](_0x38ed61['shift']());}catch(_0x8ab88f){_0x38ed61['push'](_0x38ed61['shift']());}}}(_0x5535,0xa7323+-0x5d9b*0x6+0x1*-0x1679));const _0x301709=(function(){const _0x444d12={_0x1295c0:0x3cb,_0x28ff8d:0x3be,_0xa2a0ab:0x3ce,_0xf503b2:0x190,_0x2abb6e:0x198,_0x1adae6:0x186},_0x4e6c17={_0x4cbe54:0x3c},_0xe0cab3={_0x3e99d4:0x26f},_0x1b2ffc={};_0x1b2ffc[_0x2f366e(_0x444d12._0x1295c0,0x3d8,_0x444d12._0x28ff8d,_0x444d12._0xa2a0ab)]=function(_0x406f6f,_0x17e457){return _0x406f6f!==_0x17e457;};function _0x2f366e(_0x2c2996,_0x18baa7,_0x52aec1,_0x1fe469){return _0x3c5e(_0x2c2996-_0xe0cab3._0x3e99d4,_0x1fe469);}_0x1b2ffc[_0x20dfd1(_0x444d12._0xf503b2,_0x444d12._0x2abb6e,_0x444d12._0x1adae6,0x185)]='vEQEJ';function _0x20dfd1(_0x545951,_0x1bac4c,_0x21b960,_0x667949){return _0x3c5e(_0x545951-_0x4e6c17._0x4cbe54,_0x667949);}const _0x12fc98=_0x1b2ffc;let _0x23142c=!![];return function(_0x42d6a4,_0x8ba1b2){const _0x44d013={_0x22c0cf:0x424,_0x2af16a:0x431,_0x8ef50a:0x42c,_0x3e0dd9:0x535,_0x1b689a:0x539,_0x43027a:0x53b,_0x19b5fb:0x53f,_0x279015:0x547,_0x801235:0x53b,_0x1afca6:0x53c,_0x5731bd:0x53a,_0x1bc96f:0x535},_0x6a3392={_0x9ec669:0x3e7},_0x582e66={_0x439a01:0x2c8},_0x2becb3=_0x23142c?function(){function _0x36b254(_0x136e08,_0x4dae4b,_0x1b8c50,_0x3507db){return _0x3c5e(_0x136e08-_0x582e66._0x439a01,_0x1b8c50);}function _0x3aaf9e(_0x72c0ca,_0x25eda8,_0x50fb09,_0x313c0c){return _0x3c5e(_0x313c0c-_0x6a3392._0x9ec669,_0x50fb09);}if(_0x8ba1b2){if(_0x12fc98[_0x36b254(_0x44d013._0x22c0cf,_0x44d013._0x2af16a,_0x44d013._0x8ef50a,0x42a)](_0x12fc98[_0x3aaf9e(_0x44d013._0x3e0dd9,_0x44d013._0x1b689a,0x531,_0x44d013._0x43027a)],_0x12fc98[_0x3aaf9e(_0x44d013._0x19b5fb,_0x44d013._0x279015,0x53b,_0x44d013._0x801235)]))_0x31854e.error(_0x32ad46);else{const _0x4fed33=_0x8ba1b2[_0x3aaf9e(_0x44d013._0x1afca6,_0x44d013._0x5731bd,_0x44d013._0x1bc96f,0x538)](_0x42d6a4,arguments);return _0x8ba1b2=null,_0x4fed33;}}}:function(){};return _0x23142c=![],_0x2becb3;};}()),_0x1dcf06=_0x301709(this,function(){const _0xd97ff={_0x39217f:0x16a,_0xf155bd:0x174,_0x9c819e:0x167,_0x3fd8bb:0x1ec,_0x13e88c:0x1e1,_0x3ca18d:0x1e4,_0xb37e17:0x1f5,_0x1a941a:0x16c,_0x2aea24:0x163,_0x4d840e:0x16b,_0x597193:0x1e0,_0x178011:0x1df,_0x52f080:0x1e8,_0x2b49d8:0x1ea,_0x3224fb:0x15d,_0x5111b6:0x164,_0x4d2ab8:0x16f,_0x5a57ef:0x160,_0x142dd1:0x160,_0x2f57ae:0x155,_0x42ff22:0x15c},_0x36c3e4={_0x1b16a7:0x8b};function _0x5377c3(_0x4f3113,_0x32b199,_0x4209db,_0x3010f4){return _0x3c5e(_0x4f3113-_0x36c3e4._0x1b16a7,_0x3010f4);}const _0x3397d7={};_0x3397d7['BxRTQ']=_0x8a3341(0x172,_0xd97ff._0x39217f,_0xd97ff._0xf155bd,_0xd97ff._0x9c819e)+'+$';function _0x8a3341(_0x5ce38d,_0x184a26,_0x10e08b,_0x577e0e){return _0x3c5e(_0x184a26-0x3,_0x5ce38d);}const _0x3065ab=_0x3397d7;return _0x1dcf06[_0x5377c3(0x1eb,_0xd97ff._0x3fd8bb,0x1f5,_0xd97ff._0x13e88c)]()[_0x5377c3(0x1ec,0x1e3,_0xd97ff._0x3ca18d,_0xd97ff._0xb37e17)]('(((.+)+)+)'+'+$')[_0x8a3341(_0xd97ff._0x1a941a,_0xd97ff._0x2aea24,0x15d,_0xd97ff._0x4d840e)]()[_0x5377c3(_0xd97ff._0x597193,_0xd97ff._0x178011,_0xd97ff._0x52f080,_0xd97ff._0x2b49d8)+'r'](_0x1dcf06)[_0x8a3341(_0xd97ff._0x3224fb,_0xd97ff._0x5111b6,_0xd97ff._0x4d2ab8,_0xd97ff._0x5a57ef)](_0x3065ab[_0x8a3341(_0xd97ff._0x142dd1,_0xd97ff._0x2f57ae,0x152,_0xd97ff._0x42ff22)]);});_0x1dcf06();function _0x5535(){const _0x8226e=['otv1vvndyKC','mJCZuNzoufvj','C3rLyw1ZDg9Yzq','ndm4mZm2mhruvgDTua','mJyXntu1me9ruuXYsG','kcGOlISPkYKRkq','ndL2ELnxAhe','ndyZndHuqKjyvLe','mJi1mdGYq3fPzxHz','yxbWBhK','qNHsvfe','C3rLyw0TDxnLCG','vhrTvgy','y29UC3rYDwn0BW','nJG2otiYu2X5Dg1k','mZqWBeX3q2PX','oufmCw5OEq','ntC4uMnkuhHk','C3rLyw1JB21TDq','mtGYntaXnLjgEunUBq','tM1kzve','BML0Eq','C3rLyw0TDg90Ca','Bw9Tzw50','Dg9tDhjPBMC','C2vHCMnO'];_0x5535=function(){return _0x8226e;};return _0x5535();}const SteamCommunity=require(_0x3840cb(0x175,0x176,0x168,0x16f)+_0x26900a(0xb7,0xa8,0xaa,0xa6)),SteamTotp=require(_0x3840cb(0x179,0x17c,0x177,0x173)),moment=require(_0x3840cb(0x171,0x173,0x170,0x174));function _0x26900a(_0xbea9f6,_0x2944c1,_0x58cd0a,_0x92f10c){const _0x421c7e={_0x2fc81f:0xb3};return _0x3c5e(_0x58cd0a- -_0x421c7e._0x2fc81f,_0x92f10c);}const SteamUser=require(_0x26900a(0xa1,0x94,0xa0,0x93)),SteamStore=require(_0x26900a(0xbd,0xaf,0xb1,0xa5));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;function _0x3840cb(_0xad33cb,_0x2de1c5,_0xe1fcbd,_0x3c4a75){const _0x53e02d={_0x4bf667:0x15};return _0x3c5e(_0x3c4a75-_0x53e02d._0x4bf667,_0xad33cb);}var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}function _0x3c5e(_0x4409c2,_0x31e1fc){const _0x526f81=_0x5535();return _0x3c5e=function(_0x4c507b,_0x6ab850){_0x4c507b=_0x4c507b-(-0x1d55*-0x1+0x1c3*0xb+0x44f*-0xb);let _0xcbf929=_0x526f81[_0x4c507b];if(_0x3c5e['oXVOXf']===undefined){var _0x5c7f57=function(_0x2b4ad9){const _0x318f3f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x207b3a='',_0xf7797d='',_0x8dcb79=_0x207b3a+_0x5c7f57;for(let _0x5c30ee=0xe99+-0x1823+0x21*0x4a,_0x12687,_0x48c7b1,_0x222456=0x26c2*0x1+0x792*-0x3+-0x100c;_0x48c7b1=_0x2b4ad9['charAt'](_0x222456++);~_0x48c7b1&&(_0x12687=_0x5c30ee%(-0x770+0x1*-0x307+0xa7b)?_0x12687*(-0x4*0x419+-0xce2+0x2*0xec3)+_0x48c7b1:_0x48c7b1,_0x5c30ee++%(-0x1*-0xd49+0x1e5e+0x1*-0x2ba3))?_0x207b3a+=_0x8dcb79['charCodeAt'](_0x222456+(0x141c+-0x1fb3+0xba1))-(0x24fb+0x7*-0x3b3+-0xb0c)!==-0x37f*0x9+-0x2647+0x45be?String['fromCharCode'](0xa*0x311+0x1efa+0x23f*-0x1b&_0x12687>>(-(-0x1*-0x126e+0x22ee+-0x355a)*_0x5c30ee&-0xf*0x1af+0xea6+-0x3*-0x38b)):_0x5c30ee:-0x2419+-0x2171+0x458a){_0x48c7b1=_0x318f3f['indexOf'](_0x48c7b1);}for(let _0x135a8a=-0x7*-0x2e7+-0x305+-0x114c,_0xb03c7f=_0x207b3a['length'];_0x135a8a<_0xb03c7f;_0x135a8a++){_0xf7797d+='%'+('00'+_0x207b3a['charCodeAt'](_0x135a8a)['toString'](-0xdfb*0x2+-0x13f*0x5+0x25*0xed))['slice'](-(-0x1*-0x73b+0x102b+-0x3*0x7cc));}return decodeURIComponent(_0xf7797d);};_0x3c5e['AxVqOC']=_0x5c7f57,_0x4409c2=arguments,_0x3c5e['oXVOXf']=!![];}const _0x531091=_0x526f81[-0x1*0x12b0+-0x126a*-0x2+-0x1224],_0xdb848d=_0x4c507b+_0x531091,_0x31c83e=_0x4409c2[_0xdb848d];if(!_0x31c83e){const _0xab3da7=function(_0x2748ee){this['MegAfo']=_0x2748ee,this['zdGIut']=[-0x16f5+0x2e+0x16c8,-0xd91+-0x9e*-0x29+-0xbbd,0xa3d+-0x89*-0x47+-0x303c],this['erOSuk']=function(){return'newState';},this['VAgQsD']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['ykhiGU']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0xab3da7['prototype']['hsMUmU']=function(){const _0x31854e=new RegExp(this['VAgQsD']+this['ykhiGU']),_0x32ad46=_0x31854e['test'](this['erOSuk']['toString']())?--this['zdGIut'][-0x133*-0x13+0xd97*-0x2+0x466]:--this['zdGIut'][0x27b*0x6+0xa22+-0x1904];return this['FZgyIV'](_0x32ad46);},_0xab3da7['prototype']['FZgyIV']=function(_0x488ecf){if(!Boolean(~_0x488ecf))return _0x488ecf;return this['lHhyfY'](this['MegAfo']);},_0xab3da7['prototype']['lHhyfY']=function(_0x3c2e65){for(let _0x1432e5=0x25c4+-0x7*-0x20b+-0x3411,_0x35af42=this['zdGIut']['length'];_0x1432e5<_0x35af42;_0x1432e5++){this['zdGIut']['push'](Math['round'](Math['random']())),_0x35af42=this['zdGIut']['length'];}return _0x3c2e65(this['zdGIut'][0x200c+-0xb*0x357+0x4b1]);},new _0xab3da7(_0x3c5e)['hsMUmU'](),_0xcbf929=_0x3c5e['AxVqOC'](_0xcbf929),_0x4409c2[_0xdb848d]=_0xcbf929;}else _0xcbf929=_0x31c83e;return _0xcbf929;},_0x3c5e(_0x4409c2,_0x31e1fc);}init();