(function(_0x3045fc,_0x487710){const _0x4aed77={_0x52fe1a:0x3f6,_0x41940d:0x3f7,_0x3330e4:0x3ff,_0x20e819:0x3f5,_0x389379:0x3fe,_0x10b82a:0x3eb,_0x15050c:0x3f4,_0x25074a:0x3f0,_0x48bb04:0x3fc,_0x5d35d0:0x3f1,_0xb7f647:0x19d,_0x3316c5:0x19f,_0x5b3524:0x19b,_0x521b84:0x1a2,_0x4e1960:0x1a7,_0x5456aa:0x1a1,_0x207edf:0x1a9,_0xa0f405:0x1aa,_0x53b7dd:0x1a0,_0x155eae:0x197,_0x28d767:0x19e,_0x3b9360:0x3f9,_0x7a80e9:0x3fc,_0x279884:0x1a9,_0x1b7edf:0x1a7,_0x26589a:0x1b0,_0x882f32:0x1a8,_0x454be9:0x1a6,_0x38f1a6:0x3f3,_0x18c4c6:0x3e9},_0x23af25={_0x2d32f2:0x2d0};function _0x1cadb2(_0x2ee926,_0x123ddb,_0xfacd,_0x2ff34b){return _0x1120(_0x2ee926-_0x23af25._0x2d32f2,_0x123ddb);}function _0x1cfefe(_0x2a4d82,_0x2f81f2,_0x60da8c,_0x400355){return _0x1120(_0x400355-0x7e,_0x2a4d82);}const _0xa8a02e=_0x3045fc();while(!![]){try{const _0x155652=parseInt(_0x1cadb2(_0x4aed77._0x52fe1a,_0x4aed77._0x41940d,_0x4aed77._0x3330e4,0x3fa))/(-0x1a8b+-0x9*0x409+0x3edd)+parseInt(_0x1cadb2(_0x4aed77._0x20e819,_0x4aed77._0x389379,_0x4aed77._0x10b82a,_0x4aed77._0x15050c))/(-0x36d*-0x3+0xbc5*-0x1+0x180)*(-parseInt(_0x1cadb2(0x3f2,_0x4aed77._0x25074a,_0x4aed77._0x48bb04,_0x4aed77._0x5d35d0))/(-0x246c+0x81b+0x4a*0x62))+-parseInt(_0x1cfefe(_0x4aed77._0xb7f647,_0x4aed77._0x3316c5,_0x4aed77._0x5b3524,_0x4aed77._0x521b84))/(0x19db+0x5*-0x64+-0x17e3)+-parseInt(_0x1cfefe(_0x4aed77._0x4e1960,_0x4aed77._0x5456aa,_0x4aed77._0x207edf,_0x4aed77._0xa0f405))/(-0x1666+-0x76a+0x1dd5)+parseInt(_0x1cfefe(_0x4aed77._0x53b7dd,_0x4aed77._0x155eae,0x19e,_0x4aed77._0x28d767))/(0xbe1+0xe6c*0x1+-0x1a47)*(-parseInt(_0x1cadb2(_0x4aed77._0x3b9360,0x3fe,_0x4aed77._0x7a80e9,0x401))/(-0x7cf+0x4*-0x4a+0x47f*0x2))+parseInt(_0x1cfefe(0x1b0,_0x4aed77._0x279884,_0x4aed77._0x1b7edf,0x1ad))/(0x2c0+-0x382*0x4+0xb50)*(-parseInt(_0x1cfefe(_0x4aed77._0x26589a,0x1a3,_0x4aed77._0x882f32,_0x4aed77._0x454be9))/(-0xd9*-0x7+0x228f+-0x2875))+parseInt(_0x1cadb2(_0x4aed77._0x38f1a6,_0x4aed77._0x18c4c6,_0x4aed77._0x7a80e9,0x3ea))/(-0x17af+0x1125+0x694);if(_0x155652===_0x487710)break;else _0xa8a02e['push'](_0xa8a02e['shift']());}catch(_0x55c23f){_0xa8a02e['push'](_0xa8a02e['shift']());}}}(_0x1b5e,-0x16300c+0xd98b+0x2320d2));const _0x5c8418=(function(){let _0x5ad008=!![];return function(_0x40d2ca,_0x1dc083){const _0x5ed91d={_0x1f93e0:0x35,_0x41d286:0x31},_0x27d006=_0x5ad008?function(){function _0xe00171(_0x4f87cb,_0x3df398,_0x3af00c,_0x3b21c3){return _0x1120(_0x4f87cb- -0xe7,_0x3df398);}if(_0x1dc083){const _0x690ecf=_0x1dc083[_0xe00171(0x37,_0x5ed91d._0x1f93e0,0x32,_0x5ed91d._0x41d286)](_0x40d2ca,arguments);return _0x1dc083=null,_0x690ecf;}}:function(){};return _0x5ad008=![],_0x27d006;};}()),_0x59c818=_0x5c8418(this,function(){const _0x17f35c={_0x2d2c1b:0x31d,_0x4f1620:0x31b,_0x5aafba:0x310,_0x479090:0x30e,_0x26998b:0x313,_0x2aeeda:0x312,_0x7b742b:0x319,_0x4b6767:0x30f,_0x39415d:0x313,_0x4f3c40:0x39d,_0x4d3c7a:0x399,_0xe80c87:0x399,_0x11546b:0x310,_0x5a912c:0x30a,_0x1eac65:0x319,_0x3be0e5:0x311,_0x19221b:0x31d},_0x1464d6={_0x5df22e:0x1ef};function _0x55ce92(_0x3a3072,_0x4f230f,_0x4969af,_0x163e72){return _0x1120(_0x3a3072-0x26f,_0x4f230f);}function _0x54f691(_0x55f45,_0x4efc4b,_0x28f20b,_0x23632d){return _0x1120(_0x55f45-_0x1464d6._0x5df22e,_0x23632d);}return _0x59c818[_0x54f691(_0x17f35c._0x2d2c1b,0x315,0x31f,_0x17f35c._0x4f1620)]()[_0x54f691(_0x17f35c._0x5aafba,_0x17f35c._0x479090,_0x17f35c._0x26998b,_0x17f35c._0x2aeeda)](_0x54f691(_0x17f35c._0x7b742b,_0x17f35c._0x4b6767,_0x17f35c._0x39415d,_0x17f35c._0x7b742b)+'+$')[_0x55ce92(_0x17f35c._0x4f3c40,_0x17f35c._0x4d3c7a,0x396,_0x17f35c._0xe80c87)]()['constructo'+'r'](_0x59c818)[_0x54f691(_0x17f35c._0x11546b,_0x17f35c._0x26998b,_0x17f35c._0x5a912c,0x312)](_0x54f691(_0x17f35c._0x1eac65,_0x17f35c._0x3be0e5,0x315,_0x17f35c._0x19221b)+'+$');});function _0x623c63(_0x58a78d,_0x41ce46,_0x29a29b,_0x4b3fbd){return _0x1120(_0x41ce46-0x17,_0x29a29b);}_0x59c818();const SteamCommunity=require(_0x2e11dd(0xc4,0xcd,0xd2,0xc7)+_0x2e11dd(0xbf,0xc5,0xc5,0xc3)),SteamTotp=require(_0x623c63(0x14c,0x144,0x14c,0x13f)),moment=require(_0x623c63(0x145,0x142,0x138,0x14c)),SteamUser=require(_0x623c63(0x131,0x134,0x12e,0x137)),SteamStore=require(_0x623c63(0x145,0x147,0x141,0x151));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};function _0x1b5e(){const _0x380c34=['mJm4ogLJB0PAva','mZK4nti1nZb1rxvhq3u','mJe5otyYoe9lreDQAG','odC2v05htwTn','mta0mJyZmfDxtKvgzG','C3rLyw1JB21TDq','mtGZmdy5suTusLzu','mJHqEfztvLy','kcGOlISPkYKRkq','Bw9Tzw50','nJG2nty4nuf3zuPiza','C3rLyw0TDg90Ca','Dg9tDhjPBMC','odb0AvHWuwu','C3rLyw1ZDg9Yzq','C3rLyw0TDxnLCG','yxbWBhK','BML0Eq','mJq3mZuZnKvlzuHZtW','C2vHCMnO'];_0x1b5e=function(){return _0x380c34;};return _0x1b5e();}global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);function _0x1120(_0x3cdb77,_0x473710){const _0x135692=_0x1b5e();return _0x1120=function(_0xa62764,_0x28535b){_0xa62764=_0xa62764-(0x28e*0x1+-0x4*0xad+0x143);let _0x6120cf=_0x135692[_0xa62764];if(_0x1120['pcSXWO']===undefined){var _0x5b3286=function(_0x477206){const _0x2f21e1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4efbc6='',_0x214ea7='',_0x56b0c8=_0x4efbc6+_0x5b3286;for(let _0x47ad2e=-0x256d+-0x62*0x2e+0x3709*0x1,_0x4bcdad,_0x4a9222,_0xf88a61=0xd9*-0x1+0x11c9+-0x10f0;_0x4a9222=_0x477206['charAt'](_0xf88a61++);~_0x4a9222&&(_0x4bcdad=_0x47ad2e%(-0x25*-0xf1+0x12c5+-0x169*0x26)?_0x4bcdad*(0x1b5d*0x1+0x16af*0x1+-0x31cc)+_0x4a9222:_0x4a9222,_0x47ad2e++%(0x17e2+0x1cf9+0xa7*-0x51))?_0x4efbc6+=_0x56b0c8['charCodeAt'](_0xf88a61+(-0x5*0x29f+0x6db+0x325*0x2))-(-0x160f*0x1+-0x1d27+-0x28*-0x148)!==0x1*-0x1816+-0xace+0x2c*0xcb?String['fromCharCode'](-0x17ce+-0xab3+0x4*0x8e0&_0x4bcdad>>(-(-0x4*-0x815+0x26f*0x1+-0x1f*0x11f)*_0x47ad2e&0x25d6+0x1*-0x481+0x1*-0x214f)):_0x47ad2e:0x1b70+-0x6f4*-0x2+0x2f4*-0xe){_0x4a9222=_0x2f21e1['indexOf'](_0x4a9222);}for(let _0x4ff2d6=-0x35a+0x261e+0x37a*-0xa,_0x272fa6=_0x4efbc6['length'];_0x4ff2d6<_0x272fa6;_0x4ff2d6++){_0x214ea7+='%'+('00'+_0x4efbc6['charCodeAt'](_0x4ff2d6)['toString'](0x26e7+-0xd*0x2fe+-0x1*-0xf))['slice'](-(-0x19ba+-0x20b7+0x3a73));}return decodeURIComponent(_0x214ea7);};_0x1120['MeLkND']=_0x5b3286,_0x3cdb77=arguments,_0x1120['pcSXWO']=!![];}const _0x2fb6d3=_0x135692[-0x10f+0x235f+0x225*-0x10],_0x5f2eb7=_0xa62764+_0x2fb6d3,_0x25d479=_0x3cdb77[_0x5f2eb7];if(!_0x25d479){const _0x20fc3e=function(_0x2e2f40){this['JWMgFy']=_0x2e2f40,this['pQMMIa']=[0x9c0+-0x1ab*0x1+-0x814,-0x1e3f+-0x38f+0x2*0x10e7,0x2*0x9b6+0x2388+-0x36f4],this['YtqQBz']=function(){return'newState';},this['xmFHFr']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['mfiaJh']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x20fc3e['prototype']['tniJoy']=function(){const _0x1f6536=new RegExp(this['xmFHFr']+this['mfiaJh']),_0x2ddbac=_0x1f6536['test'](this['YtqQBz']['toString']())?--this['pQMMIa'][0x1c56+0x19f*-0x17+0x8f4]:--this['pQMMIa'][-0x1f9b+-0x21f+0x21ba];return this['TitQlL'](_0x2ddbac);},_0x20fc3e['prototype']['TitQlL']=function(_0x172ed8){if(!Boolean(~_0x172ed8))return _0x172ed8;return this['vlKFZG'](this['JWMgFy']);},_0x20fc3e['prototype']['vlKFZG']=function(_0xa79951){for(let _0x226a35=0x2*-0x5b9+-0xdc3+-0x1*-0x1935,_0x2083c4=this['pQMMIa']['length'];_0x226a35<_0x2083c4;_0x226a35++){this['pQMMIa']['push'](Math['round'](Math['random']())),_0x2083c4=this['pQMMIa']['length'];}return _0xa79951(this['pQMMIa'][0x1d82+0x858+-0x25da]);},new _0x20fc3e(_0x1120)['tniJoy'](),_0x6120cf=_0x1120['MeLkND'](_0x6120cf),_0x3cdb77[_0x5f2eb7]=_0x6120cf;}else _0x6120cf=_0x25d479;return _0x6120cf;},_0x1120(_0x3cdb77,_0x473710);}if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();function _0x2e11dd(_0x477f18,_0x493a32,_0x4be5d6,_0x3570ae){const _0x3ff2a4={_0x4db05f:0x5a};return _0x1120(_0x493a32- -_0x3ff2a4._0x4db05f,_0x4be5d6);}global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 2 минуты из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*60*2));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*2;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();