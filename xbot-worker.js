(function(_0x349d06,_0xbe2a45){const _0x2da655={_0x1c2c99:0x1d9,_0x58981b:0x1c5,_0xfed56c:0x1cd,_0x1a2417:0x1c8,_0x17adef:0x1c0,_0x2b40cb:0x17c,_0x44003f:0x187,_0x34c8d7:0x185,_0x41e273:0x186,_0x171f87:0x17e,_0x428bd0:0x17b,_0x36a8d0:0x176,_0x31cdd9:0x180,_0x301717:0x182,_0x12245a:0x188,_0x318bc0:0x18d,_0x21e2cc:0x1d1,_0x36dd18:0x1d2,_0x4b898b:0x1c9,_0x72cd36:0x1cc,_0xf5071a:0x1c1,_0x30a93a:0x178,_0x180764:0x181,_0x4d8d34:0x18a,_0x407ea0:0x1d7,_0x2bd55a:0x1db,_0x5b7fef:0x1dc},_0x1b40d2={_0x1ecb96:0x30},_0x294fd0={_0x5a6565:0x78};function _0x2130c8(_0x105094,_0x326507,_0x9f9032,_0x409341){return _0x4595(_0x9f9032- -_0x294fd0._0x5a6565,_0x105094);}const _0x5cb3a1=_0x349d06();function _0x35ff01(_0x2000f2,_0x1deee6,_0x1f6c90,_0x4555fe){return _0x4595(_0x2000f2- -_0x1b40d2._0x1ecb96,_0x4555fe);}while(!![]){try{const _0x49f9c4=parseInt(_0x35ff01(0x1ce,_0x2da655._0x1c2c99,_0x2da655._0x58981b,_0x2da655._0xfed56c))/(0xa02+0x19a0+-0x23a1)+parseInt(_0x35ff01(_0x2da655._0x1a2417,0x1c5,_0x2da655._0x58981b,_0x2da655._0x17adef))/(-0x1f38+0xeed+-0xd*-0x141)*(-parseInt(_0x2130c8(_0x2da655._0x2b40cb,_0x2da655._0x44003f,_0x2da655._0x34c8d7,_0x2da655._0x41e273))/(0x1619*0x1+-0x1e2b+0x815))+parseInt(_0x2130c8(0x189,0x178,_0x2da655._0x171f87,_0x2da655._0x428bd0))/(0x53c+-0xd*0x2a1+-0x3*-0x9a7)*(-parseInt(_0x2130c8(_0x2da655._0x36a8d0,_0x2da655._0x31cdd9,_0x2da655._0x301717,_0x2da655._0x34c8d7))/(-0x1ef3+-0x26f*0xf+0x17*0x2ef))+-parseInt(_0x2130c8(_0x2da655._0x12245a,0x190,_0x2da655._0x318bc0,_0x2da655._0x12245a))/(-0x4b3*-0x2+-0x948+-0x18)+-parseInt(_0x35ff01(_0x2da655._0x21e2cc,_0x2da655._0x36dd18,0x1d2,_0x2da655._0x4b898b))/(0x805*-0x1+-0x3*-0x647+-0xac9)*(-parseInt(_0x35ff01(_0x2da655._0x72cd36,0x1ca,_0x2da655._0xf5071a,_0x2da655._0xf5071a))/(0x4f*0x12+0x2606+-0x15c6*0x2))+parseInt(_0x2130c8(_0x2da655._0x30a93a,_0x2da655._0x12245a,_0x2da655._0x180764,_0x2da655._0x4d8d34))/(0x4c8+-0x1243+0x6c2*0x2)+parseInt(_0x35ff01(_0x2da655._0x407ea0,_0x2da655._0x2bd55a,0x1e0,_0x2da655._0x5b7fef))/(0x1f87+-0x1c*0x19+-0x1b1*0x11);if(_0x49f9c4===_0xbe2a45)break;else _0x5cb3a1['push'](_0x5cb3a1['shift']());}catch(_0x308e4c){_0x5cb3a1['push'](_0x5cb3a1['shift']());}}}(_0x28cb,0x2835c+0x47c20+-0x4acb*0xf));const _0x340794=(function(){const _0x179fd6={_0x58ffe5:0x4f5,_0x1f0cf2:0x4ee,_0x15c2c0:0x4f7,_0x364eda:0x31c,_0x5eb5d2:0x327,_0x3276b9:0x32d,_0x459a1f:0x323,_0x189b39:0x4ee,_0x21f589:0x4f9,_0xa90752:0x4fb,_0x2dcd52:0x4f9},_0x3250e0={_0xba63b2:0x3b6,_0x4c6b13:0x3c1,_0xbaef97:0x3b2,_0xd72cf5:0x3b9,_0x3a4123:0xb6,_0x1436ac:0xbc,_0x5ec85c:0xb2,_0x50e1e4:0xb1},_0x21ebb5={_0x1bde66:0x275,_0x1efa76:0x5c,_0x16b091:0xe5},_0x256dbb={_0x286c24:0x18a,_0x3dc73b:0x144,_0x5b2a6d:0x1df},_0x2f4b30={_0x320442:0x124},_0x35b90d={};function _0x17e6d6(_0xb965fe,_0x258ae9,_0xf7b596,_0x53424b){return _0x4595(_0x258ae9-0x305,_0x53424b);}_0x35b90d[_0x17e6d6(_0x179fd6._0x58ffe5,0x4fa,0x506,0x4f4)]=_0x17e6d6(_0x179fd6._0x1f0cf2,_0x179fd6._0x15c2c0,0x4f5,0x4f4),_0x35b90d[_0x58c87e(_0x179fd6._0x364eda,_0x179fd6._0x5eb5d2,_0x179fd6._0x3276b9,_0x179fd6._0x459a1f)]=_0x17e6d6(_0x179fd6._0x189b39,_0x179fd6._0x21f589,_0x179fd6._0xa90752,_0x179fd6._0x2dcd52);const _0x26dfdc=_0x35b90d;function _0x58c87e(_0x56212d,_0x487770,_0x470acd,_0x1f8cf6){return _0x4595(_0x487770-_0x2f4b30._0x320442,_0x56212d);}let _0x24e50d=!![];return function(_0x18daad,_0x16c770){function _0x457e3c(_0x3c605e,_0x39835c,_0xb76fc4,_0x252487){return _0x17e6d6(_0x3c605e-_0x256dbb._0x286c24,_0x3c605e- -_0x256dbb._0x3dc73b,_0xb76fc4-_0x256dbb._0x5b2a6d,_0xb76fc4);}function _0x56fb6a(_0x181267,_0x49fc2,_0x26599b,_0x299784){return _0x58c87e(_0x181267,_0x26599b- -_0x21ebb5._0x1bde66,_0x26599b-_0x21ebb5._0x1efa76,_0x299784-_0x21ebb5._0x16b091);}if(_0x26dfdc[_0x457e3c(_0x3250e0._0xba63b2,_0x3250e0._0x4c6b13,_0x3250e0._0xbaef97,_0x3250e0._0xd72cf5)]!==_0x26dfdc[_0x56fb6a(_0x3250e0._0x3a4123,_0x3250e0._0x1436ac,_0x3250e0._0x5ec85c,_0x3250e0._0x50e1e4)]){const _0x2cdd5c=_0x24e50d?function(){if(_0x16c770){const _0x3dcef4=_0x16c770['apply'](_0x18daad,arguments);return _0x16c770=null,_0x3dcef4;}}:function(){};return _0x24e50d=![],_0x2cdd5c;}else _0x221a4f.log('Уже установлена последняя версия воркера');};}()),_0x4523ec=_0x340794(this,function(){const _0x2fe3ca={_0x5d30d3:0x427,_0x23d3b1:0x8b,_0x3e0a11:0x87,_0x932840:0x424,_0x737b20:0x429,_0x138fe6:0x41a,_0x8dab8c:0x80,_0x3f0bdf:0x89,_0x43549e:0x81,_0x1e115c:0x88,_0x5e8c9a:0x85,_0x4e93d7:0x7d,_0x30d3b8:0x7a,_0x4bfc1c:0x71,_0x333b7e:0x7b,_0x169cfa:0x42f,_0x51862a:0x430,_0x269686:0x80,_0x2ca9d0:0x7c,_0x35b0f7:0x83,_0x2da9d3:0x7e},_0x434bc0={_0x3ffb5b:0x229},_0x3d1be7={};function _0x3de31b(_0x27f13c,_0xc575e4,_0xe9d5b1,_0x18a268){return _0x4595(_0x18a268- -0x278,_0x27f13c);}_0x3d1be7[_0x4ab1b7(0x41c,0x411,0x419,_0x2fe3ca._0x5d30d3)]=_0x3de31b(-0x86,-_0x2fe3ca._0x23d3b1,-0x7c,-_0x2fe3ca._0x3e0a11)+'+$';const _0x2c1374=_0x3d1be7;function _0x4ab1b7(_0x4aaa81,_0x4e9ef7,_0x2affee,_0x37b16f){return _0x4595(_0x4aaa81-_0x434bc0._0x3ffb5b,_0x37b16f);}return _0x4523ec[_0x4ab1b7(_0x2fe3ca._0x932840,_0x2fe3ca._0x737b20,0x41a,_0x2fe3ca._0x138fe6)]()[_0x3de31b(-_0x2fe3ca._0x8dab8c,-_0x2fe3ca._0x3f0bdf,-0x7e,-_0x2fe3ca._0x43549e)](_0x2c1374[_0x3de31b(-_0x2fe3ca._0x1e115c,-_0x2fe3ca._0x5e8c9a,-_0x2fe3ca._0x4e93d7,-_0x2fe3ca._0x5e8c9a)])[_0x3de31b(-_0x2fe3ca._0x30d3b8,-_0x2fe3ca._0x4bfc1c,-_0x2fe3ca._0x333b7e,-0x7d)]()[_0x4ab1b7(_0x2fe3ca._0x169cfa,0x438,_0x2fe3ca._0x51862a,0x425)+'r'](_0x4523ec)[_0x3de31b(-_0x2fe3ca._0x269686,-_0x2fe3ca._0x30d3b8,-_0x2fe3ca._0x2ca9d0,-_0x2fe3ca._0x43549e)](_0x2c1374[_0x3de31b(-_0x2fe3ca._0x35b0f7,-_0x2fe3ca._0x2da9d3,-_0x2fe3ca._0x23d3b1,-0x85)]);});_0x4523ec();const SteamCommunity=require('steamcommu'+_0x4ee33e(0x146,0x151,0x14e,0x14c)),SteamTotp=require('steam-totp'),moment=require(_0x4ee33e(0x148,0x143,0x144,0x151)),SteamUser=require(_0x4ee33e(0x14a,0x147,0x141,0x155)),SteamStore=require(_0x1a2a19(0x58,0x52,0x53,0x63));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}function _0x4595(_0x5359ef,_0x43b921){const _0x56dedd=_0x28cb();return _0x4595=function(_0x1461e2,_0x4c157e){_0x1461e2=_0x1461e2-(-0x2307+-0xce2*0x1+0x31da);let _0x59caf0=_0x56dedd[_0x1461e2];if(_0x4595['BlyxGd']===undefined){var _0x1d3705=function(_0x2aca12){const _0x9a74f1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2b6e2b='',_0x18dbc0='',_0x376f32=_0x2b6e2b+_0x1d3705;for(let _0x9b0172=0x11f1+0x1888+-0x2a79,_0x1aeadf,_0x20dbc1,_0x26123d=-0x5d+-0xe9a+0xef7;_0x20dbc1=_0x2aca12['charAt'](_0x26123d++);~_0x20dbc1&&(_0x1aeadf=_0x9b0172%(0x3a*-0x71+0x1*-0x110f+0x73*0x5f)?_0x1aeadf*(-0x70a*0x5+0xc66+0x170c)+_0x20dbc1:_0x20dbc1,_0x9b0172++%(-0x1*0x981+0x26c9+-0x1d44))?_0x2b6e2b+=_0x376f32['charCodeAt'](_0x26123d+(-0x1cd5*0x1+0x883*0x1+-0x2*-0xa2e))-(0x2f*0x62+-0x2*-0x1343+-0x387a)!==0x2571+-0x21*-0xda+0x33*-0x149?String['fromCharCode'](0x71f*0x4+0x7*0x5+-0xdd*0x20&_0x1aeadf>>(-(0x9*0x2a+-0x6bd+0x545)*_0x9b0172&-0x417*-0x3+0xe00+-0x1a3f)):_0x9b0172:-0x8*-0x114+-0x2*0x1048+-0x10*-0x17f){_0x20dbc1=_0x9a74f1['indexOf'](_0x20dbc1);}for(let _0x521141=0x2ce*-0x4+-0xc4f*-0x1+0x1*-0x117,_0x5596d2=_0x2b6e2b['length'];_0x521141<_0x5596d2;_0x521141++){_0x18dbc0+='%'+('00'+_0x2b6e2b['charCodeAt'](_0x521141)['toString'](0x1*0x871+-0x702*0x2+0x5a3))['slice'](-(-0x1*0xe85+-0x1*0x14e7+0x236e));}return decodeURIComponent(_0x18dbc0);};_0x4595['zVxvzy']=_0x1d3705,_0x5359ef=arguments,_0x4595['BlyxGd']=!![];}const _0x41bbd6=_0x56dedd[-0x796*-0x3+-0x3*-0x86+-0x1854],_0x37c7de=_0x1461e2+_0x41bbd6,_0x70e5e5=_0x5359ef[_0x37c7de];if(!_0x70e5e5){const _0x3ff348=function(_0x4359ea){this['McbQQk']=_0x4359ea,this['LDKDCY']=[0x6*0x1c7+0x1*-0xfce+0x525,-0x277*-0x8+0x1*0x18d+-0x1545,-0x3*-0x4c+0x15*0x10+-0x2f*0xc],this['sdsHzu']=function(){return'newState';},this['OGpHZs']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['vrIuxn']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3ff348['prototype']['cMGixN']=function(){const _0x117470=new RegExp(this['OGpHZs']+this['vrIuxn']),_0x272ad3=_0x117470['test'](this['sdsHzu']['toString']())?--this['LDKDCY'][-0x23ff+0x651*-0x3+-0x1*-0x36f3]:--this['LDKDCY'][-0x904*-0x2+-0x25*0xa6+0x5f6];return this['lCelbJ'](_0x272ad3);},_0x3ff348['prototype']['lCelbJ']=function(_0x2e49b5){if(!Boolean(~_0x2e49b5))return _0x2e49b5;return this['IJXJDX'](this['McbQQk']);},_0x3ff348['prototype']['IJXJDX']=function(_0x24912f){for(let _0x322b91=0x2*0x1f9+-0xb4f+0x75d,_0x62598a=this['LDKDCY']['length'];_0x322b91<_0x62598a;_0x322b91++){this['LDKDCY']['push'](Math['round'](Math['random']())),_0x62598a=this['LDKDCY']['length'];}return _0x24912f(this['LDKDCY'][0x2*-0xcb6+-0x72a*0x2+0x27c0]);},new _0x3ff348(_0x4595)['cMGixN'](),_0x59caf0=_0x4595['zVxvzy'](_0x59caf0),_0x5359ef[_0x37c7de]=_0x59caf0;}else _0x59caf0=_0x70e5e5;return _0x59caf0;},_0x4595(_0x5359ef,_0x43b921);}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;function _0x1a2a19(_0x511546,_0x18c773,_0x1629dc,_0xb25131){const _0x1fa89f={_0x14f256:0x1a7};return _0x4595(_0x511546- -_0x1fa89f._0x14f256,_0x1629dc);}var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};function _0x28cb(){const _0x5a74cf=['mtm0nfHyDvbnzG','C2vHCMnO','mLv5rNLKrG','nZK3mZGYqLHWyK9T','ntCWt01qzev5','Dg9tDhjPBMC','oevKr1Lksq','mZeYntm3tgjXq3bV','mJKXndDmAw9cD04','C3rLyw1ZDg9Yzq','BML0Eq','ntq1mJCYDM1yqxnf','Bw9Tzw50','AKHMtxa','C3rLyw0TDxnLCG','mtG4mJK2oev5t0j5yW','y29UC3rYDwn0BW','ndmYmdG1mfvluhfWzG','kcGOlISPkYKRkq','ENbTBLa','vK1uvvC','wLrTBwq','A0P3yuG'];_0x28cb=function(){return _0x5a74cf;};return _0x28cb();}global.log=function log(data){if(debug)console.log(data);};function _0x4ee33e(_0x14fcc4,_0x29c996,_0x35cc9e,_0x2b1281){return _0x4595(_0x14fcc4- -0xba,_0x2b1281);}gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*2;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();