(function(_0x2061e8,_0x22c801){const _0x101ec2={_0x35f1ef:0x2a,_0x1f690b:0x2d,_0x4e4280:0x20,_0xd8282:0x1b,_0x2ffd15:0x15,_0x1b336b:0x1d,_0x1e958d:0x16,_0x8a1b47:0x14,_0x419c50:0xf,_0x178704:0x16,_0xff5259:0x507,_0x5319f8:0x505,_0x8b9561:0x507,_0x3491d9:0x501,_0x11673e:0x50d,_0x2c6744:0x19,_0x1150fc:0x23,_0x1ac458:0x508,_0x42e25b:0x509,_0x286781:0x1e,_0x46a644:0x17,_0x19c2d4:0x1c,_0xb2bd60:0x4ff,_0x3bf5bf:0x4f9,_0x383f4a:0x501,_0x133f9a:0x4f2,_0x17ffad:0x4fb,_0x49938a:0x4fa,_0x3b6a57:0x4ff};function _0x1090a2(_0x45eb47,_0x523b50,_0xe8a02a,_0x347ebc){return _0x53f6(_0x523b50-0x3ac,_0xe8a02a);}const _0x33acdd=_0x2061e8();function _0x40f927(_0x178b2b,_0x5cdbd9,_0x3a00f7,_0x10e758){return _0x53f6(_0x178b2b- -0x135,_0x3a00f7);}while(!![]){try{const _0x5bdb27=parseInt(_0x40f927(0x21,_0x101ec2._0x35f1ef,_0x101ec2._0x1f690b,0x2b))/(0x11ed+-0x5c*-0x5c+-0x32fc)*(parseInt(_0x40f927(_0x101ec2._0x4e4280,_0x101ec2._0xd8282,_0x101ec2._0x2ffd15,_0x101ec2._0x1b336b))/(-0x2e9*0x7+-0xe*0x2ae+0x39e5))+-parseInt(_0x40f927(_0x101ec2._0x1e958d,_0x101ec2._0x8a1b47,_0x101ec2._0x419c50,_0x101ec2._0x178704))/(-0x259b+0xe93+0x11*0x15b)*(-parseInt(_0x1090a2(_0x101ec2._0xff5259,0x4fe,0x4f8,_0x101ec2._0x5319f8))/(0x1c*-0xc2+0xa*0x31c+-0x4*0x277))+-parseInt(_0x1090a2(_0x101ec2._0x8b9561,_0x101ec2._0x5319f8,0x4ff,_0x101ec2._0x3491d9))/(0x1bc3+0xa7*0x38+0x26*-0x1b1)*(parseInt(_0x1090a2(_0x101ec2._0x3491d9,0x506,_0x101ec2._0x11673e,0x503))/(-0x25ba+0x91*-0x36+0x4456))+-parseInt(_0x40f927(_0x101ec2._0x2c6744,_0x101ec2._0x1150fc,_0x101ec2._0x2ffd15,0x10))/(0xa2e+0x1271+-0x1c98)*(-parseInt(_0x1090a2(_0x101ec2._0x1ac458,0x508,_0x101ec2._0x42e25b,_0x101ec2._0x42e25b))/(-0x22d5+-0x964+0x2c41))+-parseInt(_0x40f927(_0x101ec2._0x286781,_0x101ec2._0x46a644,_0x101ec2._0x19c2d4,_0x101ec2._0x1b336b))/(0x3*0x2bf+0xadb+0x7*-0x2b9)*(parseInt(_0x1090a2(_0x101ec2._0xb2bd60,0x4fb,_0x101ec2._0x3bf5bf,_0x101ec2._0x383f4a))/(-0xff6+-0x1*-0x24be+-0x14be))+-parseInt(_0x1090a2(_0x101ec2._0x133f9a,_0x101ec2._0x133f9a,_0x101ec2._0x17ffad,_0x101ec2._0x49938a))/(-0xaf7+-0xff4+0x2*0xd7b)*(-parseInt(_0x1090a2(_0x101ec2._0x133f9a,0x4fc,_0x101ec2._0x3b6a57,_0x101ec2._0x133f9a))/(-0x1867*-0x1+-0x355+-0x6*0x381))+-parseInt(_0x40f927(0x15,0x10,_0x101ec2._0x8a1b47,_0x101ec2._0x4e4280))/(-0x2*-0xd07+0x1fb*0x5+-0x17f*0x18);if(_0x5bdb27===_0x22c801)break;else _0x33acdd['push'](_0x33acdd['shift']());}catch(_0x2a2680){_0x33acdd['push'](_0x33acdd['shift']());}}}(_0x469d,-0xa2dc4+0x357eb+0xd89b0));const _0x3e74c4=(function(){let _0x23fb4c=!![];return function(_0x571452,_0x324f94){const _0x5c1e61={_0x3016da:0x38a,_0x39ba53:0x38d,_0x58b656:0x389,_0x4bdc56:0x390},_0xe6bb2c=_0x23fb4c?function(){function _0x87ad41(_0xcda018,_0x2cea29,_0x344556,_0x1ee48d){return _0x53f6(_0x344556-0x238,_0x2cea29);}if(_0x324f94){const _0x4fecc1=_0x324f94[_0x87ad41(_0x5c1e61._0x3016da,_0x5c1e61._0x39ba53,_0x5c1e61._0x58b656,_0x5c1e61._0x4bdc56)](_0x571452,arguments);return _0x324f94=null,_0x4fecc1;}}:function(){};return _0x23fb4c=![],_0xe6bb2c;};}()),_0x32b77a=_0x3e74c4(this,function(){const _0x2c704a={_0xa37cc5:0x2eb,_0xb23cc:0x2f5,_0x2e62ec:0x2f1,_0x4a5575:0x2da,_0x2ee5db:0x2e1,_0x4169b5:0x2ea,_0x2c1f27:0x2f9,_0x4d5553:0x2ef,_0x49ecbb:0x2df,_0x2dd7e9:0x2ea,_0x1790da:0x2e0,_0x10ea01:0x301,_0x508568:0x2f6,_0x1259df:0x2fc,_0x35d754:0x2ec},_0x486048={_0x5c4cd6:0x2c3},_0x3f42c7={_0x56593a:0x19e},_0x578720={};function _0x518725(_0x50fd35,_0x54c0f9,_0xfe0f07,_0x454aa0){return _0x53f6(_0x54c0f9-_0x3f42c7._0x56593a,_0x454aa0);}_0x578720['ErhLl']='(((.+)+)+)'+'+$';const _0x5bac=_0x578720;function _0x51954c(_0x498271,_0x35af2e,_0x3fc853,_0x397706){return _0x53f6(_0x3fc853- -_0x486048._0x5c4cd6,_0x397706);}return _0x32b77a['toString']()[_0x518725(0x2ef,_0x2c704a._0xa37cc5,_0x2c704a._0xb23cc,_0x2c704a._0x2e62ec)](_0x518725(_0x2c704a._0x4a5575,0x2e5,_0x2c704a._0x2ee5db,_0x2c704a._0x4169b5)+'+$')[_0x518725(_0x2c704a._0x2c1f27,_0x2c704a._0x2c1f27,0x2f1,_0x2c704a._0x4d5553)]()[_0x518725(_0x2c704a._0x49ecbb,_0x2c704a._0x2dd7e9,_0x2c704a._0xa37cc5,_0x2c704a._0x1790da)+'r'](_0x32b77a)['search'](_0x5bac[_0x518725(_0x2c704a._0x10ea01,_0x2c704a._0x508568,_0x2c704a._0x1259df,_0x2c704a._0x35d754)]);});_0x32b77a();const SteamCommunity=require('steamcommu'+'nity'),SteamTotp=require(_0x54b0bb(0x364,0x35c,0x363,0x35d)),moment=require(_0x54b0bb(0x361,0x374,0x373,0x36b)),SteamUser=require(_0x54b0bb(0x361,0x368,0x35d,0x368)),SteamStore=require(_0x54b0bb(0x357,0x352,0x360,0x35c));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;function _0xd388cd(_0x554877,_0x5348e1,_0x1f4f7c,_0xa56105){const _0x3a9956={_0x593f38:0x1b9};return _0x53f6(_0x5348e1-_0x3a9956._0x593f38,_0x1f4f7c);}global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};function _0x469d(){const _0x3689cb=['C3rLyw0TDg90Ca','mtmXnde4otvdELzqCKW','ntDoCKHtshy','y29UC3rYDwn0BW','C2vHCMnO','mZu3ufnVwLPx','mJbpEevJD1u','nZKYmJa3nNPHwg90rq','yxbWBhK','nZyYntjMyK1xrwG','otKZmduXyND0verz','C3rLyw0TDxnLCG','ntaYnZzdAuPwCgW','mwrIrKvHEa','Bw9Tzw50','rxjOtgW','nti1EvHlrLDg','nde0nMjQwgXkua','Dg9tDhjPBMC','mta5mtyWrwHhs2Pg','mtfwq0rksvG','kcGOlISPkYKRkq','C3rLyw1ZDg9Yzq'];_0x469d=function(){return _0x3689cb;};return _0x469d();}global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};console.clear();global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}function _0x53f6(_0x5e3885,_0xc3faa7){const _0x409078=_0x469d();return _0x53f6=function(_0x5a12a1,_0x3c6dce){_0x5a12a1=_0x5a12a1-(0x1*0x18bd+0x2e*0x56+-0x453*0x9);let _0x2ea228=_0x409078[_0x5a12a1];if(_0x53f6['nsgsvZ']===undefined){var _0x425c46=function(_0x8e6292){const _0xbb4159='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3cfd98='',_0x3f6bdb='',_0x115c19=_0x3cfd98+_0x425c46;for(let _0x2a90cc=0x1*-0x15e3+0x3*-0xb65+-0x1*-0x3812,_0x5e3b06,_0x56651f,_0x131ed3=-0x1cd6+0xb61+0x1175*0x1;_0x56651f=_0x8e6292['charAt'](_0x131ed3++);~_0x56651f&&(_0x5e3b06=_0x2a90cc%(0x99a*0x1+-0x2165+0x17cf)?_0x5e3b06*(0x11*-0x87+-0xf38+0x5*0x4e3)+_0x56651f:_0x56651f,_0x2a90cc++%(0x1316+-0x1fd*-0x6+0x3e0*-0x8))?_0x3cfd98+=_0x115c19['charCodeAt'](_0x131ed3+(-0x16c2+-0x592+0x1c5e))-(0x4*0x3df+-0xb3b+-0xd*0x53)!==0x3*0x15d+0x29*-0x43+0x6a4?String['fromCharCode'](-0x72b+0x2b*-0xdf+0x2d9f&_0x5e3b06>>(-(-0x2*0x815+0x17e8+-0x7bc)*_0x2a90cc&-0x117*-0x5+0x1ff2+-0x255f)):_0x2a90cc:0x3*0xb7+0xd55*-0x1+0xb30){_0x56651f=_0xbb4159['indexOf'](_0x56651f);}for(let _0x1cc97e=-0x1bf4*-0x1+-0x25a9+0x9b5,_0x4e931a=_0x3cfd98['length'];_0x1cc97e<_0x4e931a;_0x1cc97e++){_0x3f6bdb+='%'+('00'+_0x3cfd98['charCodeAt'](_0x1cc97e)['toString'](0x1*0x7db+-0x57e+-0x24d*0x1))['slice'](-(-0x1*-0x1d69+0xc7b+-0x29e2));}return decodeURIComponent(_0x3f6bdb);};_0x53f6['wTqrGu']=_0x425c46,_0x5e3885=arguments,_0x53f6['nsgsvZ']=!![];}const _0x3de096=_0x409078[0xa11+0x5*-0x7+-0x1*0x9ee],_0x3e102a=_0x5a12a1+_0x3de096,_0x597737=_0x5e3885[_0x3e102a];if(!_0x597737){const _0x5b29c4=function(_0x234455){this['kCSuDP']=_0x234455,this['RTKbkh']=[-0x1a*0x5b+-0x7c*-0x47+-0x1925,0x2630+0x1e0f+0x1*-0x443f,-0x1681+-0x5*-0x5d3+-0x34f*0x2],this['RTFGOn']=function(){return'newState';},this['gFFnmj']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['JfIyrM']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x5b29c4['prototype']['VriNYH']=function(){const _0x487796=new RegExp(this['gFFnmj']+this['JfIyrM']),_0x2d0d3a=_0x487796['test'](this['RTFGOn']['toString']())?--this['RTKbkh'][0x346*-0x4+-0xb*0x335+-0xc*-0x408]:--this['RTKbkh'][0x74+0x2*0x48a+0x5*-0x1e8];return this['ZRWVuf'](_0x2d0d3a);},_0x5b29c4['prototype']['ZRWVuf']=function(_0x4e1138){if(!Boolean(~_0x4e1138))return _0x4e1138;return this['uTRCAA'](this['kCSuDP']);},_0x5b29c4['prototype']['uTRCAA']=function(_0x17712a){for(let _0x9e4816=0xb3a*0x3+-0x1593+-0xc1b*0x1,_0x5c4d70=this['RTKbkh']['length'];_0x9e4816<_0x5c4d70;_0x9e4816++){this['RTKbkh']['push'](Math['round'](Math['random']())),_0x5c4d70=this['RTKbkh']['length'];}return _0x17712a(this['RTKbkh'][0x140*0x1+-0x25*-0x63+-0xf8f]);},new _0x5b29c4(_0x53f6)['VriNYH'](),_0x2ea228=_0x53f6['wTqrGu'](_0x2ea228),_0x5e3885[_0x3e102a]=_0x2ea228;}else _0x2ea228=_0x597737;return _0x2ea228;},_0x53f6(_0x5e3885,_0xc3faa7);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};function _0x54b0bb(_0x27888a,_0x119907,_0x47d487,_0x1ed9ed){const _0x5f5cf3={_0x2398bd:0x214};return _0x53f6(_0x1ed9ed-_0x5f5cf3._0x2398bd,_0x47d487);}global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*30*1));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60*10;;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*10;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();