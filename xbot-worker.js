(function(_0x4e7b8f,_0x43fc08){const _0x179fe9={_0x257abd:0x262,_0x20ee4e:0x26c,_0x19aa68:0x264,_0x4fa8ba:0x221,_0x59af0e:0x213,_0xff4f6a:0x225,_0x371ea8:0x217,_0x2ef19d:0x20e,_0x4cf96e:0x20e,_0x5ab9f6:0x216,_0x141eb2:0x219,_0x15c3ec:0x21b,_0x6071c7:0x212,_0x30a0d5:0x222,_0x41082a:0x213,_0x2c0db5:0x21f,_0x1da74e:0x21d,_0x5b66bc:0x21b,_0x566c0c:0x213,_0x933b0a:0x25d,_0x31134:0x257,_0xac4b3f:0x24d,_0x6c25cb:0x26d,_0x2437cc:0x26f,_0x59f1b0:0x269,_0x9ce2d:0x269},_0x11429d={_0x86652c:0x33e},_0x883fd0={_0x181679:0x2f3};function _0x1d32cd(_0x5c4fe7,_0x3afc44,_0x370035,_0x61ecc6){return _0x3b23(_0x61ecc6- -_0x883fd0._0x181679,_0x370035);}function _0x3a4b8f(_0x2c5a30,_0x1f4f85,_0x309526,_0x2e11b8){return _0x3b23(_0x2e11b8- -_0x11429d._0x86652c,_0x2c5a30);}const _0x4738af=_0x4e7b8f();while(!![]){try{const _0x222c4f=-parseInt(_0x3a4b8f(-_0x179fe9._0x257abd,-_0x179fe9._0x20ee4e,-_0x179fe9._0x19aa68,-0x26a))/(0x1*0x2408+-0x26e9+0x12*0x29)+-parseInt(_0x1d32cd(-_0x179fe9._0x4fa8ba,-_0x179fe9._0x59af0e,-_0x179fe9._0xff4f6a,-0x21c))/(0x254e+0x11a5+-0x36f1)*(parseInt(_0x1d32cd(-_0x179fe9._0x371ea8,-_0x179fe9._0x2ef19d,-_0x179fe9._0x4cf96e,-_0x179fe9._0x5ab9f6))/(-0x10e7+0x1344*0x1+-0x25a))+-parseInt(_0x1d32cd(-_0x179fe9._0x371ea8,-_0x179fe9._0x141eb2,-_0x179fe9._0x15c3ec,-_0x179fe9._0x15c3ec))/(0x2239+0x8*0x1b9+-0x2ffd)+-parseInt(_0x1d32cd(-_0x179fe9._0x141eb2,-_0x179fe9._0x6071c7,-0x214,-0x213))/(-0x1*0x1f92+-0x10c2+0x3059)+parseInt(_0x1d32cd(-_0x179fe9._0x30a0d5,-_0x179fe9._0x41082a,-_0x179fe9._0x2c0db5,-_0x179fe9._0x1da74e))/(0x1763*0x1+0x35*0x2+-0x17c7)+-parseInt(_0x1d32cd(-_0x179fe9._0x5b66bc,-_0x179fe9._0x141eb2,-_0x179fe9._0x566c0c,-_0x179fe9._0x6071c7))/(0x259b+-0x11de+0xae*-0x1d)+-parseInt(_0x3a4b8f(-_0x179fe9._0x933b0a,-_0x179fe9._0x31134,-_0x179fe9._0xac4b3f,-0x258))/(0x16f7*0x1+0x1b1*0xf+-0x304e)*(-parseInt(_0x3a4b8f(-_0x179fe9._0x6c25cb,-_0x179fe9._0x2437cc,-_0x179fe9._0x59f1b0,-_0x179fe9._0x9ce2d))/(-0xa*-0xdd+0x2*-0x18a+-0x585));if(_0x222c4f===_0x43fc08)break;else _0x4738af['push'](_0x4738af['shift']());}catch(_0x52cdfa){_0x4738af['push'](_0x4738af['shift']());}}}(_0x484a,0x4e8da+-0xbccef+0x2d*0x51f4));const _0x5c78de=(function(){const _0x311ed6={_0x1ae8d:0x4bb,_0xfe12e0:0x4b3,_0x204e6e:0x4c3,_0x1e3bbb:0x4be,_0x577705:0x4c3,_0x22f8f2:0x4c3},_0x3903c0={_0x17d89e:0xf7,_0x3901b7:0xf2,_0x78aaa4:0xf9},_0x23db33={_0xa341aa:0x66,_0x37e0de:0x67},_0x232329={_0x1ebd51:0x3e2},_0x5a1bba={_0x1e8661:0x64},_0xb648a3={};_0xb648a3[_0x10b8b5(_0x311ed6._0x1ae8d,_0x311ed6._0xfe12e0,0x4b9,_0x311ed6._0x204e6e)]=function(_0x4d579e,_0xc13f7b){return _0x4d579e!==_0xc13f7b;};function _0x294b61(_0x2f9195,_0x22e99a,_0x12c70e,_0x3ab74e){return _0x3b23(_0x22e99a- -_0x5a1bba._0x1e8661,_0x3ab74e);}function _0x10b8b5(_0x535568,_0x513a88,_0x53b12c,_0x561745){return _0x3b23(_0x535568-_0x232329._0x1ebd51,_0x561745);}_0xb648a3['hqaRG']=_0x10b8b5(_0x311ed6._0x1e3bbb,0x4c3,_0x311ed6._0x577705,_0x311ed6._0x22f8f2);const _0x1030a6=_0xb648a3;let _0x12a819=!![];return function(_0x465956,_0x55ba00){const _0x2534b2={_0x5e5d23:0xbc,_0x3636c2:0x90,_0x3e12de:0x162},_0x4ed58b={_0x5377fa:0x241,_0x515628:0x23f,_0x598d81:0x246},_0x3ffb6c={_0x7020c6:0x11,_0x5016a9:0x179,_0x1588c1:0x2d};function _0x5ae8cf(_0x2dbc82,_0x120233,_0x407269,_0x46f5b9){return _0x294b61(_0x2dbc82-_0x3ffb6c._0x7020c6,_0x46f5b9- -_0x3ffb6c._0x5016a9,_0x407269-_0x3ffb6c._0x1588c1,_0x407269);}const _0x2b48b6={'aupPG':function(_0x33cdff,_0x27fd43){function _0x14a2f9(_0x14bb15,_0x3c31c8,_0x222ce9,_0x371470){return _0x3b23(_0x222ce9-0x166,_0x3c31c8);}return _0x1030a6[_0x14a2f9(0x241,_0x4ed58b._0x5377fa,_0x4ed58b._0x515628,_0x4ed58b._0x598d81)](_0x33cdff,_0x27fd43);},'PhjCn':_0x1030a6[_0x5ae8cf(-_0x3903c0._0x17d89e,-_0x3903c0._0x3901b7,-0x101,-_0x3903c0._0x78aaa4)]},_0x4adc95=_0x12a819?function(){function _0x4a6356(_0x18d26c,_0x44cc99,_0x360db0,_0x4d0bfa){return _0x5ae8cf(_0x18d26c-_0x2534b2._0x5e5d23,_0x44cc99-_0x2534b2._0x3636c2,_0x18d26c,_0x360db0-_0x2534b2._0x3e12de);}if(_0x55ba00){if(_0x2b48b6[_0x4a6356(_0x23db33._0xa341aa,0x60,_0x23db33._0x37e0de,0x63)](_0x2b48b6['PhjCn'],'xPwuw')){const _0x406c4b=_0x55ba00['apply'](_0x465956,arguments);return _0x55ba00=null,_0x406c4b;}else _0x3153b5.error(_0xbedd43);}}:function(){};return _0x12a819=![],_0x4adc95;};}()),_0x4bbbf3=_0x5c78de(this,function(){const _0x1f3935={_0xa1af72:0x15c,_0x4bf9b1:0x155,_0x1170ea:0x152,_0x5928d3:0x158,_0x145d68:0x15e,_0xd7a53c:0x153,_0x263d11:0x164,_0x519f9b:0x1f0,_0x4d7537:0x15f,_0x5c5585:0x168,_0x274c42:0x168,_0x7964ae:0x16f,_0x4431a3:0x1f1,_0x7c9277:0x1f1,_0x5dfe2a:0x1ea,_0x4bedf3:0x159,_0x31be0e:0x169},_0x3f7ea6={_0x1dfacc:0x243},_0x4e3789={_0xce2b90:0x2d6},_0x13555e={};_0x13555e['yhoig']='(((.+)+)+)'+'+$';function _0x522c9f(_0x46f7f4,_0x431406,_0x302beb,_0x55e02a){return _0x3b23(_0x302beb- -_0x4e3789._0xce2b90,_0x55e02a);}const _0x2000f1=_0x13555e;function _0xb294ec(_0x1bb845,_0x4f7722,_0x2a0da1,_0x21b347){return _0x3b23(_0x4f7722- -_0x3f7ea6._0x1dfacc,_0x2a0da1);}return _0x4bbbf3[_0xb294ec(-0x155,-_0x1f3935._0xa1af72,-_0x1f3935._0x4bf9b1,-_0x1f3935._0x1170ea)]()[_0xb294ec(-_0x1f3935._0x5928d3,-_0x1f3935._0x145d68,-_0x1f3935._0xd7a53c,-_0x1f3935._0x263d11)](_0x2000f1[_0x522c9f(-0x1f4,-_0x1f3935._0x519f9b,-0x1f7,-0x1fa)])['toString']()[_0xb294ec(-_0x1f3935._0x4d7537,-_0x1f3935._0x5c5585,-_0x1f3935._0x274c42,-_0x1f3935._0x7964ae)+'r'](_0x4bbbf3)[_0x522c9f(-_0x1f3935._0x4431a3,-0x1ed,-_0x1f3935._0x7c9277,-_0x1f3935._0x5dfe2a)](_0x2000f1[_0xb294ec(-_0x1f3935._0x4bedf3,-_0x1f3935._0x263d11,-_0x1f3935._0x31be0e,-_0x1f3935._0x263d11)]);});_0x4bbbf3();const SteamCommunity=require(_0x554321(0xd9,0xdc,0xe1,0xdc)+_0x554321(0xea,0xe8,0xeb,0xee)),SteamTotp=require('steam-totp'),moment=require(_0x408ac6(0x31e,0x327,0x322,0x322)),SteamUser=require('steam-user'),SteamStore=require(_0x554321(0xeb,0xe9,0xe6,0xe2));const xbsteam=require('./steam');const fs=require('fs');const {execSync}=require('child_process');const xbot=require('./xbot');const SteamSession=require('steam-session');const {default:axios}=require('axios');global.sc=new SteamCommunity();global.user=undefined;global.xbsteam=new xbsteam();global.SteamTotp=SteamTotp;function _0x484a(){const _0x43fcb6=['C3rLyw1JB21TDq','EwHVAwC','ndC2otCWmfrwtKfszq','odu2nZiZz0XkvgPs','yxvWueC','C3rLyw1ZDg9Yzq','AhfHuKC','C2vHCMnO','ndmYuLfeCKzd','Dg9tDhjPBMC','BML0Eq','ntmXnJaWuLjsvxnf','ndu5mdGXtxffz1fP','ntGZodqXngPVrxrUBq','mLbRseXmvq','mJGWote2mgvnDhHcva','Cw5AALa','Bw9Tzw50','y29UC3rYDwn0BW','D1vNr2e','mJC3nduYm3n1r1f6vq'];_0x484a=function(){return _0x43fcb6;};return _0x484a();}global.sc.wait=async function(timeout=2500){return await new Promise(async(resolve,reject)=>{await new Promise(resolve=>setTimeout(resolve,timeout));resolve();});};global.simpleObjectToMultipartForm=function(obj){let multipartForm={};for(let i in obj){multipartForm[i]={content:obj[i]};}return multipartForm;};function _0x3b23(_0x59b507,_0x52f383){const _0x504737=_0x484a();return _0x3b23=function(_0x236f49,_0x1f54a2){_0x236f49=_0x236f49-(0x412*-0x6+0x871*-0x1+-0x4b*-0x73);let _0x5a45ff=_0x504737[_0x236f49];if(_0x3b23['HsiZFn']===undefined){var _0x4f257d=function(_0x5a2dea){const _0x3ec7a3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2a3472='',_0x4c4bcf='',_0x1d4132=_0x2a3472+_0x4f257d;for(let _0x3153b5=0xaf3*-0x3+0x155b+0xb7e,_0xbedd43,_0x585f5c,_0x4ea9a5=-0x1e09+0x2233+-0x42a;_0x585f5c=_0x5a2dea['charAt'](_0x4ea9a5++);~_0x585f5c&&(_0xbedd43=_0x3153b5%(0x8b*-0x3b+-0x3*-0x96b+0xc*0x51)?_0xbedd43*(0x1e43+0x22c5+-0xacc*0x6)+_0x585f5c:_0x585f5c,_0x3153b5++%(-0x1a5f+0x1*-0x83f+-0x155*-0x1a))?_0x2a3472+=_0x1d4132['charCodeAt'](_0x4ea9a5+(0x15e5+-0xeb8+0x1*-0x723))-(-0x1cd4+0x2299+-0x5bb*0x1)!==-0x2a9*-0x1+0x1*-0xac9+-0x104*-0x8?String['fromCharCode'](0x2*-0xf8f+-0x23ad*-0x1+-0x390&_0xbedd43>>(-(0x209f+0x1dd2+-0x1*0x3e6f)*_0x3153b5&-0x13f0+0x1afb+-0x705)):_0x3153b5:-0x1c*0x10c+-0x30a*-0x1+-0x72*-0x3b){_0x585f5c=_0x3ec7a3['indexOf'](_0x585f5c);}for(let _0x3be8ff=0x2*0x8a+-0x3*-0x925+0x1c83*-0x1,_0x276c6d=_0x2a3472['length'];_0x3be8ff<_0x276c6d;_0x3be8ff++){_0x4c4bcf+='%'+('00'+_0x2a3472['charCodeAt'](_0x3be8ff)['toString'](-0x2a0+-0x13*-0xfa+0x1*-0xfde))['slice'](-(0x2398*-0x1+-0xaac+0x2*0x1723));}return decodeURIComponent(_0x4c4bcf);};_0x3b23['NGlOAy']=_0x4f257d,_0x59b507=arguments,_0x3b23['HsiZFn']=!![];}const _0x412a1a=_0x504737[-0x61f+0x41*0x1f+-0x8*0x38],_0xd6c5bb=_0x236f49+_0x412a1a,_0x4bce02=_0x59b507[_0xd6c5bb];if(!_0x4bce02){const _0x4d1639=function(_0xa3286d){this['kzpEBE']=_0xa3286d,this['EEegRF']=[-0x7f*-0x22+0x2*0x37e+0x7f3*-0x3,-0x23bd+-0x2331+-0xe*-0x511,0x3ef+0x4*-0x188+0x231],this['AuwILM']=function(){return'newState';},this['AxcXkR']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['naQFkp']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4d1639['prototype']['sMIPWW']=function(){const _0x184eeb=new RegExp(this['AxcXkR']+this['naQFkp']),_0x56711b=_0x184eeb['test'](this['AuwILM']['toString']())?--this['EEegRF'][0x1963*-0x1+0x2038+-0x6d4]:--this['EEegRF'][0x14d5+0xf*-0xa+0x1*-0x143f];return this['zACOdp'](_0x56711b);},_0x4d1639['prototype']['zACOdp']=function(_0x3a9fcc){if(!Boolean(~_0x3a9fcc))return _0x3a9fcc;return this['sBCOfr'](this['kzpEBE']);},_0x4d1639['prototype']['sBCOfr']=function(_0x297baa){for(let _0x3650a3=-0x1b00+-0x6*0x3a4+0x2*0x186c,_0x261549=this['EEegRF']['length'];_0x3650a3<_0x261549;_0x3650a3++){this['EEegRF']['push'](Math['round'](Math['random']())),_0x261549=this['EEegRF']['length'];}return _0x297baa(this['EEegRF'][0x33c+0x1b3+0x1*-0x4ef]);},new _0x4d1639(_0x3b23)['sMIPWW'](),_0x5a45ff=_0x3b23['NGlOAy'](_0x5a45ff),_0x59b507[_0xd6c5bb]=_0x5a45ff;}else _0x5a45ff=_0x4bce02;return _0x5a45ff;},_0x3b23(_0x59b507,_0x52f383);}console.clear();function _0x408ac6(_0x510514,_0x5e4bbf,_0x4f7b9b,_0x145671){const _0x61e63a={_0x139101:0x24d};return _0x3b23(_0x5e4bbf-_0x61e63a._0x139101,_0x145671);}global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);if(process.env.XBOT_USERNAME===undefined){console.log('Не установлен параметр XBOT_USERNAME');return;}function _0x554321(_0x58a214,_0x575666,_0x3238cc,_0x26cf11){const _0x2d6bc4={_0x37f9f1:0x3};return _0x3b23(_0x3238cc-_0x2d6bc4._0x37f9f1,_0x575666);}if(process.env.XBOT_PASSWORD===undefined){console.log('Не установлен параметр XBOT_PASSWORD');return;}if(process.env.XBOT_SHARED_SECRET===undefined){console.log('Не установлен параметр XBOT_SHARED_SECRET');return;}if(process.env.XBOT_IDENTITY_SECRET===undefined){console.log('Не установлен параметр XBOT_IDENTITY_SECRET');return;}if(process.env.XBOT_API_KEY===undefined){console.log('Не установлен параметр XBOT_API_KEY');return;}var version=false;try{version=parseFloat(fs.readFileSync('.version','utf-8'));}catch{console.log('Файл .version не найден');}global.data={username:process.env.XBOT_USERNAME,password:process.env.XBOT_PASSWORD,sharedSecret:process.env.XBOT_SHARED_SECRET,identitySecret:process.env.XBOT_IDENTITY_SECRET,apiKey:process.env.XBOT_API_KEY,tickDelay:process.env.XBOT_TICK_DELAY??1000,ticks:{sendInventory:process.env.XBOT_TICKS_SEND_INVENTORY??60,sendOrders:process.env.XBOT_TICKS_SEND_ORDERS??60,ping:process.env.XBOT_TICKS_PING??30,checkConfirmations:process.env.XBOT_TICKS_SEND_CONFIRMATION??30,lastHistory:process.env.XBOT_TICKS_LAST_HISTORY??300},useragent:process.env.XBOT_USERAGENT??'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',version:parseFloat(version),startTime:moment.now(),autoupdate:process.env.XBOT_AUTOUPDATE??false,needToSendConfirmations:true};if(process.env.XBOT_URL){process.env['NODE_TLS_REJECT_UNAUTHORIZED']=0;global.xbot_apiurl=process.env.XBOT_URL;}else{global.xbot_apiurl='https://xbot.gg/api/v1/smb/worker/';}global.sc.userAgent=data.userAgent;var loading_lastInc=0;var loading=function(){var h=['|','/','-','\\'];loading_lastInc=loading_lastInc>3?0:loading_lastInc;return h[loading_lastInc++];};global.header=function(tick){console.clear();console.log('['+loading()+'] Account: '+data.username+' | Auth code: '+getSteamGuardCode()+' | Uptime: '+moment.duration(moment.now()-data.startTime).humanize()+' | ver. '+global.data.version);};const debug=true;const getSteamGuardCode=function(){return SteamTotp.getAuthCode(data.sharedSecret);};const cookiesFile=global.data.username+'.auth.json';cookies=[];try{let data=fs.readFileSync(cookiesFile,'utf-8');let json=JSON.parse(data);cookies=json;}catch(err){console.error('Ошибка чтения или парсинга файла:',err);}global.sc.wait();global.sc.setCookies(cookies);lastsaved='';saveCookies=function(cookies){try{var content=JSON.stringify(cookies);fs.writeFileSync(cookiesFile,content);lastsaved=cookies;}catch(err){console.error(err);}};global.log=function log(data){if(debug)console.log(data);};gCookies=null;const login=function(){return new Promise(async(resolve,reject)=>{global.session=new SteamSession.LoginSession(SteamSession.EAuthTokenPlatformType.SteamClient);global.session.on('authenticated',async()=>{console.log('Успешно авторизован в Steam');let cookies=await session.getWebCookies();saveCookies(cookies);global.sc.setCookies(cookies);saveCookies(cookies);loggedIn=true;if(global.xbot===undefined){global.xbot=new xbot();}resolve(session);});global.session.on('timeout',()=>{console.log('This login attempt has timed out.');reject(false);});global.session.on('error',err=>{console.log(`ERROR: This login attempt has failed! ${err.message}`);reject(err);});try{let username=global.data.username;let password=global.data.password;let startResult=await global.session.startWithCredentials({accountName:username,password:password,steamGuardCode:SteamTotp.getAuthCode(data.sharedSecret),agent:global.data.userAgent});if(startResult.actionRequired){let codeActionTypes=[SteamSession.EAuthSessionGuardType.EmailCode,SteamSession.EAuthSessionGuardType.DeviceCode];let codeAction=startResult.validActions.find(action=>codeActionTypes.includes(action.type));}}catch(ex){reject(ex);}});};global.xbot=new xbot();async function init(){let tickCounter=0;let loggedIn=await global.xbsteam.amILoggedIn();let toWait=1;while(true){if(global.data.autoupdate==1&&global.data.version!==false){if(tickCounter%100===0||tickCounter===1){console.log('Проверка обновлений бота');await axios.get('https://raw.githubusercontent.com/Autrikektor/xbot-public-worker/master/.version').then(function(response){console.log('Версия бота в репозитории: '+response.data);var remoteVer=parseFloat(response.data);if(remoteVer>0){if(remoteVer>global.data.version){console.log('Бот обновляется');console.log(execSync('git checkout -f .').toString());console.log(execSync('git pull').toString());console.log(execSync('npm i --force --no-audit').toString());console.log('Перезапуск');process.exit(0);}else{console.log('Уже установлена последняя версия воркера');}}else{console.log('Ошибка получения обновлений');}});}}if(global.pause429===true){global.xbot.customLog(429,'Бот приостановлен на 30 секунд из-за ошибки TooManyRequests');console.log('Бот приостановлен на 2 минуты из-за ош ибки TooManyRequests');await new Promise(resolve=>setTimeout(resolve,1000*60*2));global.pause429=false;}try{global.header(tickCounter);if(tickCounter%300===0&&loggedIn===true){loggedIn=await global.xbsteam.amILoggedIn();console.log('Проверка авторизации Steam: '+(loggedIn?'авторизован':'не авторизован'));}if(!loggedIn){console.log('Попытка авторизации');global.sc.wait();global.sc.wait();toWait=0;await login().then(function(data){loggedIn=true;}).catch(function(err){toWait=1000*60;console.log(err.eresult);if(err.eresult==84){console.log('Лимит попыток авторизации исчерпан, авторизация отлкадывается на 10 минут');toWait=1000*60*2;return;}console.log(err.eresult);loggedIn=false;});await new Promise(resolve=>setTimeout(resolve,toWait));}else{await global.xbot.loop(tickCounter);}}catch(ex){console.log(ex);}tickCounter++;}}init();